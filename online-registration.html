<!doctype html>
<html lang="en">

<head>
  <!-- Meta -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>GoLearn School</title>
  <meta name=description content="GoLearn School&trade; is Malaysia #1 learning platform to manage tuition lessons for you and your children. Start now for Free!">
  <meta property=og:title content="GoLearn School">
  <meta property=og:site_name content="GoLearn School">
  <meta property=og:type content=website>
  <meta property=og:url content=https://app.golearn.com.my/client/about.html >
  <meta property=og:image content=https://app.golearn.com.my/assets/img/icon-apple-touch-180x180.png>
  <meta property=og:description content="GoLearn School&trade; is Malaysia #1 learning platform to manage tuition lessons for you and your children. Start now for Free!">
  <link rel=apple-touch-icon sizes=180x180 href=https://app.golearn.com.my/assets/img/icon-apple-touch-180x180.png>
  <link rel=icon type=image/png sizes=32x32 href=https://app.golearn.com.my/assets/img/icon-32x32.png>
  <link rel=icon type=image/png sizes=16x16 href=https://app.golearn.com.my/assets/img/icon-16x16.png>
  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <script src="https://kit.fontawesome.com/2bdd669e92.js" crossorigin="anonymous"></script>
  <!-- Material Kit CSS -->
  <link href="assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet"/>
  <!-- Users Portal specific CSS -->
  <link href="assets/css/tutor-portal.css" rel="stylesheet" />
  <!-- Firebase Init -->
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-firestore.js"></script>
  <script src="assets/js/firebase.js"></script>
  <link href="assets/css/multistepform.css" rel="stylesheet" />
  <link href="assets/css/mc-calendar.min.css" rel="stylesheet"/>
  <link href="assets/css/star-rating.css" media="all" rel="stylesheet" type="text/css"/>
  <link  href="assets/css/intlTelInput.css" rel="stylesheet">

  <style>
    .centered {
      position: fixed;
      top: 50%;
      left: 50%;
      /* bring your own prefixes */
      transform: translate(-50%, -50%);
    }
    .loader {
      border: 16px solid #f3f3f3; /* Light grey */
      border-top: 16px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 120px;
      height: 120px;
      animation: spin 2s linear infinite;
      position: absolute;
      z-index: 1500;
      top: 50%;
      left: 40%;
      /* transform: translate(-50%, -50%); */

    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

  </style>
</head>

<body>


  <div class="wrapper">
    <div class="sidebar" data-color="transparent" data-background-color="transparent" data-image="../../assets/img/sidebar-3.jpg" style="background: transparent">
      <div class="logo">
        <a href="#" class="simple-text logo-mini">
			    <img src="https://app.golearn.com.my/assets/img/golearn-school-logo.svg" style="width: 216px; height: auto;" alt=""></img>
        </a>

      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">

        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <a class="navbar-brand" href="javascript:;" style="white-space: nowrap!important; overflow: hidden!important; text-overflow: ellipsis!important; display: block!important;">Online Registration</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end">
            <form class="navbar-form">
            </form>

            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="navbar-brand" href="javascript:;">
                   Hi <span id="user"></span> !
                </a>
              </li>
              <li class="nav-item" id="activationNavItem">
                <a href="https://app.golearn.com.my/client/" class="btn btn-primary btn-round btn-sm" style="color: white;">Go to my profile </a>
              </li>
              <!-- <li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownNotification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i> Notifications
                </a>
								<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
									<p style="padding: 1em;" >No notification</p>
                </div>
              </li>

			  			<li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">person</i>
                  <p class="d-lg-none d-md-block">
                    Account
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
                  <a class="dropdown-item" href="./edit-profile.html">Edit Profile</a>
                  <a id="navPublicProfile" class="dropdown-item" href="#">My Public Profile</a>
									<a class="display:block; dropdown-item" href="./about.html">About</a>
									<div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="javascript:;" onclick="signOutFunction()" id="btn-logout">Log out</a>
									<div class="dropdown-divider"></div>
									<a style="font-weight: 500 ;padding: 0.5em ;text-align: center; width: 200px; background-color: #428dd4 ;display: block; color: #fff;" href="https://golearn.com.my/pricing/" target="_blank" id="btnUpgradeToPro">Upgrade to Pro</a>

                </div>
              </li> -->
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->

			<!-- Modal Start -->

      <!-- Save Student modal -->
      <div class="row">
        <div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="saveModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="saveLabel">Save & Close</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnSaveModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="saveModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnSaveModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSaveModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sign-out modal -->
      <div class="row">
        <div class="modal fade" id="signOutModal" tabindex="-1" role="dialog" aria-labelledby="signOutModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="signOutLabel">Logging Out</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnSignOutModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="signOutModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnSignOutModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSignOutModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Saving Modal -->
      <div class="row">
        <div class="modal fade" tabindex="-1" role="dialog" id="registerWaitModal" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered text-center" role="document">
            <div class="row">
              <span class="fa fa-spinner fa-spin fa-5x w-100" style="color: #fff ;"></span>
              <div class="col align-self-center">
                <h5 class="modal-title" id="" style="color: white;">We are completing your registration.</h5>
                <h5 class="modal-title" id="" style="color: white;"> Please do not close this window.</h5>

              </div>

            </div>

          </div>
        </div>
      </div>

      <div class="content">

        <div class="row text-center" style=" padding-bottom: 20px;">
          <div class="col-md-12">
            <span id="classFullName" style="font-weight: 400;"></span>
          </div>

        </div>


        <div class="container overflow-hidden">


          <div class="row" >

            <!-- Invalid screen -->
            <div class="col-md-12" id="invalid-screen" style="display: none; padding-left: 0; padding-right: 0;">
              <div class="row text-center">
                <div class="col-md-12">
                  <h2 id="invalidScreenTitle">Invalid Registration Link...</h2>
                  <p id="invalidScreenDescription">Error 1000. Please contact the class owner to fix this for you.</p>
                </div>
              </div>

            </div>

            <!-- Invalid screen -->
            <div class="col-md-12" id="registration-complete-screen" style="display: none; padding-left: 0; padding-right: 0;">
              <h2>You have completed your registration!</h2>
              <p>You will see your class after the class owner approves your enrollment. </p>
              <a href="https://app.golearn.com.my/client/" class="btn btn-outline-primary btn-round" id="btnBack">Go to my profile <i class="material-icons" style="color: #2e74b6; margin-right: 0.5em;">east</i></a>

            </div>


            <!-- Main content -->
            <div class="col-md-12" id="multisteps-form" style="padding-left: 0; padding-right: 0;">
              <!--multisteps-form navbar-->
              <div class="row" >
                <div class="col-12 col-lg-12 ml-auto mr-auto mb-4">
                  <div class="multisteps-form__progress">
                    <button class="multisteps-form__progress-btn js-active" type="button" title="Login">Login</button>
                    <button class="multisteps-form__progress-btn" type="button" title="Student Info">Select Profile</button>
                    <button class="multisteps-form__progress-btn" type="button" title="Student Info">Student Info</button>
                    <button class="multisteps-form__progress-btn" type="button" title="Guardian Info">Guardian Info</button>
                    <!-- <button class="multisteps-form__progress-btn" type="button" title="Student Info">Student Profile</button> -->

                  </div>
                </div>
              </div>

              <!--multisteps-form-->
              <div class="multisteps-form" >
                <!--form panels-->
                <div class="row">

                  <div class="col-12">
                    <form class="multisteps-form__form">

                      <!-- Login form panel-->
                      <div class="multisteps-form__panel shadow p-4 rounded bg-white js-active" data-animation="scaleIn">
                        <h4 class="multisteps-form__title">Login</h4>

                        <div class="multisteps-form__content">
                          <!-- <div class="row">
                            <div class="col-md-6">
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Full Name*</span>
                                <input type="text" class="form-control" id="inStuName" data-compulsory="true" oninput="this.className = 'form-control'">
                              </div>
                            </div>
                          </div> -->

                          <div class="row">
                            <div class="col-md-12">

                              <div class="social">

                                <h4><span> <button class="btn btn-just-icon btn-round btn-primary">
                                  <p>1</p>
                                  </button></span> Enter Your Contact Number</h4>
                              </div>
                              <div class="card-body"  style="padding-left: 0; padding-right: 0;">
                                <div class="form-group  d-flex justify-content-center">
                                  <div class="input-group">
                                    <input id="phone" name="phone" type="tel"  class="form-control">
                                    <span id="valid-msg" class="hide" style="color: #42ba96;">✓ Valid</span>
                                    <span id="error-msg" class="hide" style="color: #F32013;"></span>
                                  </div>
                                </div>
                                <div class="form-group">
                                  <div class="input-group">
                                    <div id="recaptcha-container"></div>
                                  </div>
                                </div>
                                <div class="form-group">
                                  <div class="input-group">
                                    <button id="btnVerify" class="btn btn-primary btn-round" type="button" disabled>Verify</button>
                                  </div>
                                </div>
                              </div>
                              <div class="social">
                                <h4 ><span> <button class="btn btn-just-icon btn-round btn-primary">
                                  <p>2</p>
                                  </button></span> Verification </h4>
                                <p>Enter the 6-digit verification code from your SMS.</p>
                              </div>
                              <div class="card-body" style="padding-left: 0; padding-right: 0;">
                                <div class="form-group">
                                  <div class="input-group">
                                    <div id="divOuter" style="width: 230px; overflow: hidden;">
                                      <div id="divInner" style="left: 0; position: sticky;">
                                        <input style="background-color: transparent; border: 0; width: 280px; overflow: hidden; letter-spacing: 30px;  padding-left: 10px; margin-left:0em; background-position-x: 25px!important;  background-repeat: repeat-x; background-size: 40px 1px;  background-position: bottom; background-image: linear-gradient(to left, black 70%, rgba(255, 255, 255, 0) 0%);" type="text" id="verificationCode" maxlength="6" placeholder="">
                                      </div>
                                    </div>
                                    <!-- <div id="divOuter" style="width: 250px; ">
                                      <div id="divInner" style="left: 0; position: sticky;">
                                        <input style="background-color: transparent; border: 0; width: 280px; letter-spacing: 31px;  padding-left: 20px; margin-left:0em; background-position-x: 0;  background-repeat: repeat-x;background-size: 40px 1px;  background-position: bottom; background-image: linear-gradient(to left, black 70%, rgba(255, 255, 255, 0) 0%);" type="text" id="verificationCode" maxlength="6" placeholder="">
                                      </div>
                                    </div> -->
                                  </div>
                                </div>
                                <div class="form-group">
                                  <div class="input-group">
                                    <button href="#" class="btn btn-primary btn-round" id="btnLogin" type="button" disabled>Confirm and Login</button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>

                      <!-- Choose A Dependant panel-->
                      <div class="multisteps-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                        <h4 class="multisteps-form__title">Select Profile</h4>
                        <div class="multisteps-form__content">
                          <div class="row">
                            <div class="col-md-12">
                              <div class="social">

                                <h4><span> <button class="btn btn-just-icon btn-round btn-primary">
                                  <p>1</p>
                                  </button></span> I am Parent / Guardian</h4>
                              </div>
                            </div>

                          </div>
                          <div class="row">
                            <div class="col-md-12">
                              <p>I register for my dependant (child / student)</p>
                            </div>
                          </div>

                          <div class="row" id="card-all-students">
                            <!-- Header -->
                            <div class="col-md-12 card-student">
                              <div class="row" >
                                <div class="col-md-10" style="padding: 0;">
                                  <div class="row" style="margin: 0;">
                                    <div class="col-md-3">
                                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Name</h6>
                                    </div>
                                    <div class="col-md-2">
                                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Gender</h6>
                                    </div>
                                    <div class="col-md-3">
                                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Contact No.</h6>
                                    </div>
                                    <div class="col-md-4">
                                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">School</h6>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <!-- Dependant list here -->
                            <!-- <div class="col-md-12 card-student-item">
                              <div class="row">
                                <div class="col-md-11" style="padding: 0;">
                                  <div class="row" style="margin: 0;">
                                    <div class="col-md-3">
                                      <p>Alric Liew</p>
                                    </div>
                                    <div class="col-md-2">
                                      <p>Male</p>
                                    </div>
                                    <div class="col-md-3">
                                      <p>+60138252818</p>
                                    </div>
                                    <div class="col-md-4">
                                      <p>SMK Bau</p>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-1">
                                  <button class="btn btn-primary ml-auto" type="button" title="Next">Select</button>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-12 card-student-item">
                              <div class="row">
                                <div class="col-md-11" style="padding: 0;">
                                  <div class="row" style="margin: 0;">
                                    <div class="col-md-3">
                                      <p>Alric Liew</p>
                                    </div>
                                    <div class="col-md-2">
                                      <p>Male</p>
                                    </div>
                                    <div class="col-md-3">
                                      <p>+60138252818</p>
                                    </div>
                                    <div class="col-md-4">
                                      <p>SMK Bau</p>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-1">
                                  <button class="btn btn-primary ml-auto" type="button" title="Next">Select</button>
                                </div>
                              </div>
                            </div> -->

                            <!-- No dependant warning message -->
                            <div class="col-md-12" id="card-no-dependant" style="display: none;">
                              <div class="row">
                                <div class="col-md-12" style="margin-top: 1rem;">
                                  <p>No dependant found.</p>
                                </div>
                              </div>
                            </div>

                            <!-- Add dependant btn -->
                            <div class="col-md-12" id="card-add-dependant-btn">
                              <div class="row">
                                <div class="col-md-12">
                                  <button class="btn btn-primary ml-auto btn-round js-btn-next" type="button" title="Next" id="btnAddNewDependant">Add New Dependant</button>
                                </div>
                              </div>
                            </div>
                          </div>


                          <div class="row" style="margin-top: 2rem;">
                            <div class="col-md-12">
                              <p>I register for my-self</p>
                              <button class="btn btn-primary ml-auto btn-round js-btn-next" type="button" title="Next" id="btnEnrollMyself">Enroll Myself</button>

                            </div>
                          </div>

                          <div class="row" style="margin-top: 3rem;">
                            <div class="col-md-12">
                              <div class="social">

                                <h4><span> <button class="btn btn-just-icon btn-round btn-primary">
                                  <p>2</p>
                                  </button></span> I am Student</h4>
                              </div>
                            </div>
                          </div>

                          <div class="row">
                            <div class="col-md-12">
                              <!-- <p>I register for my-self</p> -->
                              <button class="btn btn-primary ml-auto btn-round js-btn-next" type="button" title="Next" id="btnEnrollNow">Enroll Now</button>

                            </div>
                          </div>
                          <!-- 1. I am student, Myself
                          Or
                          2. I am parent. Choose a dependant
                          OR
                          3. I am parent. Create a dependant -->

                          <div class="button-row d-flex mt-4">
                            <!-- <button class="btn btn-primary js-btn-prev" type="button" title="Prev">Prev</button> -->
                            <!-- <button class="btn btn-primary ml-auto js-btn-next" type="button" title="Next">Next</button> -->
                          </div>

                        </div>
                      </div>

                      <!-- Student form panel-->
                      <div class="multisteps-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                        <h4 class="multisteps-form__title">Student Info</h4>
                        <div class="multisteps-form__content">
                          <div class="row">
                              <!-- Name -->
                            <div class="col-md-6">
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Full Name*</span>
                                <input type="text" class="form-control" id="inStuName" data-compulsory="true" oninput="this.className = 'form-control'">
                              </div>
                            </div>

                            <!-- Phone -->
                            <div class="col-md-6">
                              <div class="form-group" style="padding-bottom: 0;">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Phone</span>
                              </div>
                              <div class="form-group" style="margin-top: 0;">
                                <!-- <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Phone*</span>  -->
                                <!-- <i style="margin-right: 1rem;" class="material-icons">smartphone</i> -->
                                <input id="phoneStudent" name="phone" type="tel" class="form-control"  oninput="this.className = 'form-control'">
                                <span id="valid-msgStudent" class="hide" style="color: #42ba96;">✓ Valid</span>
                                <span id="error-msgStudent" class="hide" style="color: #F32013;"></span>
                              </div>
                            </div>
                          </div>

                          <div class="row">
                            <!-- Email -->
                            <div class="col-md-6">
                              <div class="form-group" >
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Email</span>
                                <input type="text" class="form-control" id="inStuEmail" data-compulsory="false">
                              </div>
                            </div>

                            <!-- Gender -->
                            <div class="col-md-6">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;" >Gender</span>
                              <div class="form-group" >
                                <div class="form-check form-check-radio form-check-inline">
                                  <label class="form-check-label">
                                    <input class="form-check-input" type="radio" name="StudentGender" id="inStuMaleChecked" value="option1" data-compulsory="false" checked>
                                    Male
                                    <span class="circle">
                                      <span class="check"></span>
                                    </span>
                                  </label>
                                </div>
                                <div class="form-check form-check-radio form-check-inline">
                                  <label class="form-check-label">
                                    <input class="form-check-input" type="radio" name="StudentGender" id="inStuFemaleChecked" value="option2" data-compulsory="false">
                                    Female
                                    <span class="circle">
                                      <span class="check"></span>
                                    </span>
                                  </label>
                                </div>
                              </div>
                            </div>

                          </div>

                          <div class="row">
                            <!-- School -->
                            <div class="col-md-12">
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">School</span>
                                <input type="text" class="form-control" id="inStuSchool" data-compulsory="false">
                              </div>
                            </div>
                          </div>

                          <div class="button-row d-flex mt-4">
                            <button class="btn btn-primary js-btn-prev" type="button" title="Prev">Prev</button>
                            <button class="btn btn-primary ml-auto js-btn-next" type="button" title="Next">Next</button>
                          </div>

                        </div>
                      </div>

                      <!-- Guardian form panel-->
                      <div class="multisteps-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn" >
                        <h4 class="multisteps-form__title">Guardian Info</h4>
                        <div class="multisteps-form__content">
                          <div class="row">
                              <!-- Name -->
                            <div class="col-md-6">
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Name*</span>
                                <input type="text" class="form-control" id="inGurName" data-compulsory="true" oninput="this.className = 'form-control'" >
                              </div>
                            </div>

                            <!-- Phone -->
                            <div class="col-md-6">
                              <div class="form-group" style="padding-bottom: 0;">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Phone*</span>
                              </div>
                              <div class="form-group" style="margin-top: 0;">
                                <!-- <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Phone*</span>  -->
                                <!-- <i style="margin-right: 1rem;" class="material-icons">smartphone</i> -->
                                <input id="phoneGuardian" name="phone" type="tel" class="form-control" data-compulsory="true" oninput="this.className = 'form-control'">
                                <span id="valid-msgGuardian" class="hide" style="color: #42ba96;">✓ Valid</span>
                                <span id="error-msgGuardian" class="hide" style="color: #F32013;"></span>
                              </div>
                            </div>


                          </div>

                          <div class="row">
                            <!-- Email -->
                            <div class="col-md-6">
                              <div class="form-group" >
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Email</span>
                                <input type="text" class="form-control" id="inGurEmail" data-compulsory="false">
                              </div>
                            </div>

                            <!-- Gender -->
                            <div class="col-md-6">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;" >Gender</span>
                              <div class="form-group" >
                                <div class="form-check form-check-radio form-check-inline">
                                  <label class="form-check-label">
                                    <input class="form-check-input" type="radio" name="GurdianGender" id="inGurMaleChecked" value="option1" data-compulsory="false" checked>
                                    Male
                                    <span class="circle">
                                      <span class="check"></span>
                                    </span>
                                  </label>
                                </div>
                                <div class="form-check form-check-radio form-check-inline">
                                  <label class="form-check-label">
                                    <input class="form-check-input" type="radio" name="GurdianGender" id="inGurFemaleChecked" value="option2" data-compulsory="false">
                                    Female
                                    <span class="circle">
                                      <span class="check"></span>
                                    </span>
                                  </label>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="row">
                            <!-- Relationship -->
                            <div class="col-md-12">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;" >Relationship</span>
                              <div class="form-group" >
                                <div class="form-check form-check-radio form-check-inline">
                                  <label class="form-check-label">
                                    <input class="form-check-input" type="radio" name="GuardianRelationship" id="inRelParentsChecked" value="option1" data-compulsory="false" checked>
                                      Parents
                                    <span class="circle">
                                      <span class="check"></span>
                                    </span>
                                  </label>
                                </div>
                                <div class="form-check form-check-radio form-check-inline">
                                  <label class="form-check-label">
                                    <input class="form-check-input" type="radio" name="GuardianRelationship" id="inRelGuardianChecked" value="option2" data-compulsory="false">
                                      Legal Guardian
                                    <span class="circle">
                                      <span class="check"></span>
                                    </span>
                                  </label>
                                </div>
                                <div class="form-check form-check-radio form-check-inline">
                                  <label class="form-check-label">
                                    <input class="form-check-input" type="radio" name="GuardianRelationship" id="inRelMyselfChecked" value="option2" data-compulsory="false">
                                      Myself
                                    <span class="circle">
                                      <span class="check"></span>
                                    </span>
                                  </label>
                                </div>
                              </div>
                            </div>

                            <!-- Address -->
                            <div class="col-md-12">
                              <div class="form-group" style="margin-top: 1.5rem;" >
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Address</span>
                                <textarea class="form-control" maxlength="511" rows="3" id="inGurAddress" data-compulsory="false" placeholder="Write something ..."></textarea>
                              </div>
                            </div>
                          </div>

                          <div class="row" style="margin-top: 0.5rem;">
                            <div class="col-md-6">
                                <!-- State -->
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray;">State</span>
                                <select class="form-control" name="tutor_course[]" id="state_drop" data-compulsory="false">
                                  <option value="">Select state</option>

                                </select>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <!-- Area -->
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray;" >Area</span>
                                <select class="form-control" name="tutor_course[]" id="area_drop" data-compulsory="false">
                                  <option value="">Select area</option>
                                </select>
                              </div>
                            </div>
                          </div>

                          <div class="button-row d-flex mt-4">
                            <button class="btn btn-primary js-btn-prev" type="button" title="Prev">Prev</button>
                            <button class="btn btn-success ml-auto js-btn-send" type="button" title="Send" id="btnRegister">Register & Close</button>
                          </div>


                        </div>
                      </div>

                    </form>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <footer class="footer">
        <div class="container-fluid">

        </div>
      </footer>
    </div>

  </div>

  <!-- Loading screen -->
  <div class="" style="height: 100%; background-color: #e4e4e463; position: fixed; overflow: hidden; z-index: 1700;top: 0;left: 0; ">
    <!-- <p>hihih</p> -->
    <div class="loader"></div>
  </div>


  <script src="assets/js/core/jquery.min.js"></script>
  <script src="assets/js/core/popper.min.js"></script>
  <script src="assets/js/core/bootstrap-material-design.min.js"></script>
  <script src="assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!-- Plugin for the momentJs  -->
  <script src="assets/js/plugins/moment.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="assets/js/material-dashboard.js?v=2.1.2" type="text/javascript"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ" crossorigin="anonymous"></script> -->
  <!-- Common constants -->
  <script src="assets/js/common.js" type="text/javascript"></script>
  <!-- General Info -->
  <script src="assets/js/const.js" type="text/javascript"></script>
  <!-- Global Var -->
  <script src="assets/js/client-globalvar.js" type="text/javascript"></script>
  <!-- Core Client Js -->
  <script src="assets/js/client-core.js" type="text/javascript"></script>
  <!-- Core Client Js -->
  <script src="assets/js/org-core.js" type="text/javascript"></script>
  <!-- Datepicker -->
  <script src="assets/js/mc-calendar.min.js" type="text/javascript"></script>
  <!-- ClockPicker -->
  <script src="assets/js/bootstrap-clockpicker.min.js" type="text/javascript"></script>
  <script src="assets/js/star-rating.js" type="text/javascript"></script>
  <script src="assets/js/star-rating-theme.js" type="text/javascript"></script>
  <!-- International Telephone Input -->
  <script src="assets/js/plugins/intlTelInput/intlTelInput.js"></script>
  <!-- Login specific -->
  <!-- <script src="js/tutor-portal-auth.js" type="text/javascript"></script> -->

  <script>
    // Global Variables
    var userId;
    var current_name, current_email, current_phone, current_imgUri, current_nric,
      current_address1, current_address2, current_addressPostCode, current_addressState, current_address;
    // // Global Variables for Admin
    // var ent_name, admin_email, ent_phone, ent_imgUrl,
    //   admin_address1, admin_address2, admin_addressPostCode, admin_addressState, ent_addr;
    // Global Variables for Entity
    var ent_id;
    var ent_url, ent_orgId, ent_accIdArr, ent_oid,  ent_aid, ent_type, ent_lastOnline, ent_rating, ent_ratingTimes, ent_ratingFinal,
      ent_accountStatus, ent_name, ent_phone, ent_email, ent_addr, ent_areaId, ent_stateId, ent_imgUrl, ent_coverImgUrl, ent_oneLiner, ent_intro,
      ent_lan, ent_timeSlotArr, ent_preferredSubArr, ent_corp, ent_corpId, ent_adminStatus;

    var currentObj = null; // Session Storage for Dependant Module
    var action; // Action: JOINSTUDENT(enroll as student), JOINSTUDENTNCLASS (enroll as student and class)

    const JOIN_AS_STUDENT = 'joinAsStudent';
    const JOIN_AS_STUDENT_AND_CLASS = 'joinAsStudentNClass';
    const JOIN_AS_STUDENT_AND_ADD_DEPENDANT = 'joinAsStudentNAddDependant';
    const JOIN_AS_STUDENT_CLASS_AND_ADD_DEPENDANT = 'joinAsStudentClassNAddDependant';
    const JOIN_AS_STUDENT_WITH_DEPID = 'joinAsStudentWithDepId'; // User selected a dependant
    const JOIN_AS_STUDENT_AND_CLASS_WITH_DEPID = 'joinAsStudentNClassWithDepId';

    var db = firebase.firestore();
		db.settings({ timestampsInSnapshots: true });

    // Check URL
    var url_string = window.location.href;
    var url = new URL(url_string);

    const adminId = url.searchParams.get("aid");
    const classId = url.searchParams.get("cid");


		firebase.auth().onAuthStateChanged(function(user){

      if(!user){
        // Return to login if user does not exist.
      }else{
        // if the displayName is null, it means user register using Phone
        if (firebase.auth().currentUser.displayName == null ){
            userId = firebase.auth().currentUser.phoneNumber;
        }else
            userId = firebase.auth().currentUser.email.replace("[^a-zA-Z0-9]", "_").toLowerCase();

        loadUserInfo(userId);

        loadAllDependantInfo(userId);

        loadAdminAndClass()
      }

    });

    // ?aid=%2B60138252818&cid=asdadadadasad

    function loadAdminAndClass() {
      if (adminId === "" || adminId == null){
        //  Error: Invalid class
        console.log('Invalid Url params');
        invalidatePage(
          "Invalid Registration Link...",
          "Error 1010. Please contact the class owner to fix this for you."
        );
      }
      // Enrol only
      else if (classId === "" || classId === null){

        // Step 1: Check if the Admin exists
        var docRefDate = db.collection("org").doc('v1').collection('org').doc(adminId);
        docRefDate.get().then((doc) => {
          if (doc.exists) {

            // Only Register students
            ent_name = (doc.data()[ORG_ORG_NAME] == null || doc.data()[ORG_ORG_NAME] == "")? "New Tutor" : doc.data()[ORG_ORG_NAME];
            ent_email = (doc.data()[ORG_ORG_EMAIL]  == null)? "" : doc.data()[ORG_ORG_EMAIL] ;
            ent_phone= (doc.data()[ORG_ORG_PHONE]  == null)? "" : doc.data()[ORG_ORG_PHONE] ;
            ent_imgUrl = (doc.data()[ORG_ORG_IMG_URL]  == null)? "https://org.golearn.com.my/assets/img/hello.gif" : doc.data()[ORG_ORG_IMG_URL] ;
            ent_accountStatus = doc.data()[ORG_ORG_STATUS]  == "" ? DEACTIVATED_ACCOUNT_STATUS_KEY : doc.data()[ORG_ORG_STATUS];
            ent_addr= (doc.data()[ORG_ORG_ADDRESS]  == null)? '' : doc.data()[ORG_ORG_ADDRESS];
            ent_url = doc.data()[ORG_ORG_ADDRESS];

            action = JOIN_AS_STUDENT;

            document.getElementById("classFullName").textContent = ent_name;

            $('#registerWaitModal').modal('hide');

            // If admin is suspended. Invalidate page
            if (ent_accountStatus == SUSPENDED_ACCOUNT_STATUS_KEY){
              console.log("Owner is suspended.");
              invalidatePage(
                "Class is Not Available",
                "Error 2100. "+ent_name+"'s account is no longer active.");
            }

          }
          else {
            //  Error: Invalid Tutor/ organization
            console.log("No such admin Id!");
            invalidatePage(
              "Invalid Registration Link...",
              "Error 2020. Please contact the class owner to fix this for you."
            );
          }
        }).catch((error) => {
          // Error: Invalid Tutor/ organization
          console.log("Error getting document:", error);
          invalidatePage(
            "Invalid Registration Link...",
            "Error 2010. Please contact the class owner to fix this for you."
          );

        });

      }
      // Enrol & Join a Class
      else{

        // Step 1: Check if the Admin exists
        var docRefAdmin = db.collection("org").doc("v1").collection("org").doc(adminId);
        var docRefClass = db.collection("Class").doc("v1").collection("Class").doc(classId);
        var promiseAll = [];

        promiseAll.push(docRefAdmin.get());
        promiseAll.push(docRefClass.get());

        Promise.all(promiseAll)
        .then((snapshots) => {

          if (snapshots[0].exists) {
            let dataAdmin = snapshots[0].data()
            ent_name = (dataAdmin[ORG_ORG_NAME] == null || dataAdmin[ORG_ORG_NAME] == "")? "New Tutor" : dataAdmin[ORG_ORG_NAME];
            ent_email = (dataAdmin[ORG_ORG_EMAIL]  == null)? "" : dataAdmin[ORG_ORG_EMAIL] ;
            ent_phone= (dataAdmin[ORG_ORG_PHONE]  == null)? "" : dataAdmin[ORG_ORG_PHONE] ;
            ent_imgUrl = (dataAdmin[ORG_ORG_IMG_URL]  == null)? "https://org.golearn.com.my/assets/img/hello.gif" : dataAdmin[ORG_ORG_IMG_URL] ;
            ent_accountStatus = dataAdmin[ORG_ORG_STATUS]  == "" ? DEACTIVATED_ACCOUNT_STATUS_KEY : dataAdmin[ORG_ORG_STATUS];
            ent_addr= (dataAdmin[ORG_ORG_ADDRESS]  == null)? '' : dataAdmin[ORG_ORG_ADDRESS];
            ent_url = dataAdmin[ORG_ORG_ADDRESS];

            // If admin is suspended. Invalidate page
            if (ent_accountStatus == SUSPENDED_ACCOUNT_STATUS_KEY){
              console.log("Owner is suspended.");
              invalidatePage(
                "Class is Not Available",
                "Error 3100. "+ent_name+"'s account is no longer active.");
            }

          }
          else {
            //  Error: Invalid Tutor/ organization
            console.log("No such admin Id!");
            invalidatePage(
                "Invalid Registration Link...",
                "Error 3020. Please retry using the correct link."
            );
          }

          // Step 2: Check if the class exists
          if (snapshots[1].exists) {
            // Register students and join class.
            action = JOIN_AS_STUDENT_AND_CLASS;

            document.getElementById("classFullName").textContent = snapshots[1].data()[CLASS_NAME];

            $('#registerWaitModal').modal('hide');

            if(snapshots[1].data()[CLASS_STATUS] === CLASS_STATUS_INACTIVE){
              invalidatePage(
                "Class is Not Available",
                "Error 3220. "+snapshots[1].data()[CLASS_NAME]+" is no longer accepting new students");
            }


          }
          else{

            // Error: Invalid Tutor/ organization
            console.log("Admin found, but no such class Id!");
            action = JOIN_AS_STUDENT;
            func.showNotification('top','center', 'warning', 'error_outline', "Warning: The class that you are trying to join is currently not available. However, you may still proceed with registration." );

            document.getElementById("classFullName").textContent = "Invalid class. Continue to enroll as student: "+ent_name;

            $('#registerWaitModal').modal('hide');
          }

        })
        .catch((error) => {
          // Error: Error getting doc

          console.log("Error getting document:", error);
          invalidatePage(
                "Invalid Registration Link...",
                "Error 3010. Please contact the class owner to fix this for you."
            );

        });

      }

    }

    function invalidatePage(title, desc){
      let multisteps = document.getElementById("multisteps-form");
      multisteps.setAttribute('style', 'display: none; ');
      let invalid_screen = document.getElementById("invalid-screen");
      invalid_screen.className = 'centered';
      invalid_screen.setAttribute('style', 'padding-left: 0; padding-right: 0;');

      let invalidScreenTitle = document.getElementById("invalidScreenTitle");
      invalidScreenTitle.textContent = (title == null || title == "") ? "Invalid Registration Link..." : title;
      let invalidScreenDescription = document.getElementById("invalidScreenDescription");
      invalidScreenDescription.textContent = (desc == null || desc == "") ? "Error 1000. Please contact the class owner to fix this for you." : desc;

      let funcText = (title == null || title == "" || desc == null || desc == "") ?
        "Invalid Link: Please contact your class owner to fix this for you." :
        title + ": " + desc;

      func.showNotification('top','center', 'danger', 'error_outline', funcText );
    }

    function registrationCompletePage(){
      let multisteps = document.getElementById("multisteps-form");
      multisteps.setAttribute('style', 'display: none;');
      let invalid_screen = document.getElementById("registration-complete-screen");
      invalid_screen.className = 'centered';
      invalid_screen.setAttribute('style', 'display: inline; padding-left: 0; padding-right: 0;');
      // func.showNotification('top','center', 'danger', 'error_outline', "Congratulation! Your registration is completed." );
    }

    // Tutor Specific
    async function loadUserInfo(userId){

      var docRef = db.collection("Users").doc(userId)
      .get()
      .then((doc) => {
      // docRef.onSnapshot((doc) => {

        if (doc.exists) {
          // console.log("Document data:", doc.data());

          current_name = (doc.data().name == null || doc.data().name == "")? "New User" : doc.data().name;
          current_email = (doc.data().email == null || doc.data().email == "")? "" : doc.data().email;
          current_phone= (doc.data().phone == null || doc.data().phone == "")? "" : doc.data().phone;
          current_age = (doc.data().age == null || doc.data().age == "")? "18" : doc.data().age;
          current_gender= (doc.data().gender == 0)? "Male" : "Female";
          current_imgUri = (doc.data().imgUrl == null || doc.data().imgUrl == "")? "https://org.golearn.com.my/assets/img/hello.gif" : doc.data().imgUrl;
          current_accountStatus = doc.data().accountStatus;
          current_address1= (doc.data().address1 == null || doc.data().address1 == "")? '' : doc.data().address1 + ', ';
          current_address2= (doc.data().address2 == null || doc.data().address2 == "")? '' : doc.data().address2 + ', ';
          current_addressPostCode= (doc.data().addressPostCode == null || doc.data().addressPostCode == "")? '' : doc.data().addressPostCode + ', ';
          current_addressState= (doc.data().addressState == null || doc.data().addressState == "")? '' : doc.data().addressState;
          current_address = current_address1 + current_address2 + current_addressPostCode + current_addressState;

          document.getElementById("user").textContent = doc.data().name;

          // User exist. Move to Step 2.
          console.log("User logged in, profile exist")

          setActiveStep(1);
          setActivePanel(1);

        } else {
          console.log("User logged in, but profile do not exist")
          //  Error: Invalid user
        }
      });

      await docRef;

    };

    // Tutor Specific
    function loadAllDependantInfo(userId){
      // Tutor Id must be a phone with +60, no spacing or other chars
      var docRef = db.collection("Class")
          .doc("v1")
          .collection("Dependant")
          .where("userId", "==", userId)
          .where("status", "==", true)

      docRef
      .get()
      .then((querySnapshot) => {
        // Session Storage data
        let docsObj = [];
        if(querySnapshot.empty){
          const card_no_dependant = document.getElementById("card-no-dependant");
          card_no_dependant.setAttribute('style', 'display: inline;')
        }else{
        querySnapshot.forEach((doc) => {
          const card_no_dependant = document.getElementById("card-no-dependant");
          card_no_dependant.setAttribute('style', 'display: none;')
          // console.log(doc.data())
          docsObj.push(doc.data());
          renderAllDependant(doc, false)
        });

        // Store all docs data to sessionStorage
        sessionStorage.setItem(SESSION_STORAGE_DEPENDANT_ALL_DOCS_KEY, JSON.stringify(docsObj));
        sessionStorage.setItem(SESSION_STORAGE_DEPENDANT_CURRENT_DOC_KEY, null);
        }

      });

    };

    // Render all dependant
    function renderAllDependant(doc, renderNull){
      // Name
      let stuName_p = document.createElement('p');
      stuName_p.textContent = doc.data().childName;
      stuName_p.setAttribute("style", "font-weight:400; font-size:1rem")
      let stuName_div = document.createElement('div');
      stuName_div.className = "col-md-3";
      stuName_div.appendChild(stuName_p);
      // Gender
      let gender_p = document.createElement('p');
      gender_p.textContent = (doc.data().childGender === 0) ? 'Male' : 'Female';
      let gender_div = document.createElement('div');
      gender_div.className = "col-md-2";
      gender_div.appendChild(gender_p);
      // Phone
      let phone_p = document.createElement('p');
      phone_p.textContent = doc.data().childPhone;
      let phone_div = document.createElement('div');
      phone_div.className = "col-md-3";
      phone_div.appendChild(phone_p);
      // Email
      // let email_p = document.createElement('p');
      // email_p.textContent = doc.data().childEmail;
      // let email_div = document.createElement('div');
      // email_div.className = "col-md-2";
      // email_div.appendChild(email_p);
      // School
      let school_p = document.createElement('p');
      school_p.textContent = doc.data().childSchool;
      let school_div = document.createElement('div');
      school_div.className = "col-md-4";
      school_div.appendChild(school_p);

      // Dependant Detail
      let detail_div = document.createElement('div');
      detail_div.className = 'row';
      detail_div.setAttribute("style","margin: 0;");
      detail_div.appendChild(stuName_div);
      detail_div.appendChild(gender_div);
      detail_div.appendChild(phone_div);
      // detail_div.appendChild(email_div);
      detail_div.appendChild(school_div);
      let detail_top_div = document.createElement('div');
      detail_top_div.className = "col-md-10 align-self-center";
      detail_top_div.setAttribute("style","padding: 0;");
      // detail_top_div.setAttribute("onclick","editDependantFunction(this)");
      // detail_top_div.setAttribute("data-id", doc.data().id);
      detail_top_div.appendChild(detail_div);

      //Del btn
      // let blogsHtml_btn = '';
      // blogsHtml_btn += "<i class='material-icons' style='color: red;''>remove</i>";
      let btn_a = document.createElement('button');
      // btn_a.innerHTML = blogsHtml_btn;
      btn_a.className = "btn btn-primary btn-sm btn-round ml-auto js-btn-next";
      btn_a.textContent = "Select";
      btn_a.setAttribute("type","button");
      // btn_a.setAttribute("id","btnDelStudent");
      // btn_a.setAttribute("href","javascript:;");
      // btn_a.setAttribute("style","margin: 0; padding: 0.3em;");
      // btn_a.setAttribute("data-toggle","modal");
      // btn_a.setAttribute("data-target","#delStuModal");
      btn_a.setAttribute("data-id", doc.data().id);
      // btn_a.setAttribute("data-studentname",  doc.data().childName);
      btn_a.setAttribute("onclick","useThisDependant(this)");
      let btn_div = document.createElement('div');
      btn_div.className = "col-md-2";
      btn_div.appendChild(btn_a);

      // Student Top
      let card_div = document.createElement('div');
      card_div.className = "row"
      card_div.appendChild(detail_top_div);
      card_div.appendChild(btn_div);

      // Card top
      let card_top_div = document.createElement('div');
      card_top_div.className = "col-md-12 card-student-item"
      card_top_div.appendChild(card_div);

      const card_all_students = document.getElementById("card-all-students");
      // card_all_students.appendChild(card_top_div);
      card_all_students.insertBefore(card_top_div, card_all_students.children[1])
    }


    function useThisDependant(elem) {
      // Get attribute
      if (JSON.parse(sessionStorage.getItem(SESSION_STORAGE_DEPENDANT_ALL_DOCS_KEY)) == null ){
        console.log("Error: Impossible to reach this state");
        // Because this func only trigger when there's active class loaded
        return;
      }else{

        let Obj = null;
        let allList = null;
        // Set the fields
        allList = JSON.parse(sessionStorage.getItem(SESSION_STORAGE_DEPENDANT_ALL_DOCS_KEY));
        allList.forEach((item) => {
          if (item.id === elem.getAttribute('data-id')){
            sessionStorage.setItem(SESSION_STORAGE_DEPENDANT_CURRENT_DOC_KEY, JSON.stringify(item));

            currentObj = JSON.parse(sessionStorage.getItem(SESSION_STORAGE_DEPENDANT_CURRENT_DOC_KEY));

            // Clear the fields in Student and Guardian panel first
            resetStudentGuardianPanel();

            // TODO: Fixed the stu and guardian phone, relationship checkbox
            console.log('dependant clicked');
            document.getElementById("inStuName").value = currentObj[DEP_CHILD_NAME];
            document.getElementById("inStuName").setAttribute('readonly','readonly');
            // document.getElementById("phoneStudent").value = currentObj[DEP_CHILD_PHONE];
            itiStudent.setNumber(currentObj[DEP_CHILD_PHONE]);
            document.getElementById("phoneStudent").setAttribute('readonly','readonly');
            document.getElementById("inStuEmail").value = currentObj[DEP_CHILD_EMAIL];
            document.getElementById("inStuEmail").setAttribute('readonly','readonly');
            document.getElementById("inStuMaleChecked").checked = currentObj[DEP_CHILD_GENDER] === 0 ? true : false;
            document.getElementById("inStuMaleChecked").disabled = true;
            document.getElementById("inStuFemaleChecked").checked = currentObj[DEP_CHILD_GENDER] === 1 ? true : false;
            document.getElementById("inStuFemaleChecked").disabled = true;
            document.getElementById("inStuSchool").value = currentObj[DEP_CHILD_SCHOOL];
            document.getElementById("inStuSchool").setAttribute('readonly','readonly');

            // Guardian Profile Panel
            document.getElementById("inGurName").value = currentObj[DEP_GUR_NAME];
            document.getElementById("inGurName").setAttribute('readonly','readonly');
            // document.getElementById("phoneGuardian").value = currentObj[DEP_GUR_PHONE];
            itiGuardian.setNumber(currentObj[DEP_GUR_PHONE]);
            document.getElementById("phoneGuardian").setAttribute('readonly','readonly');
            document.getElementById("inGurEmail").value = currentObj[DEP_GUR_EMAIL];
            document.getElementById("inGurEmail").setAttribute('readonly','readonly');
            document.getElementById("inGurMaleChecked").checked = currentObj[DEP_GUR_GENDER] === 0 ? true : false;
            document.getElementById("inGurMaleChecked").disabled = true;
            document.getElementById("inGurFemaleChecked").checked = currentObj[DEP_GUR_GENDER] === 1 ? true : false;
            document.getElementById("inGurFemaleChecked").disabled = true;
            document.getElementById("inRelParentsChecked").checked = currentObj[DEP_GUR_RELATIONSHIP] === DEP_GUR_RELATIONSHIP_PARENTS ? true : false;
            document.getElementById("inRelParentsChecked").disabled = true;
            document.getElementById("inRelGuardianChecked").checked = currentObj[DEP_GUR_RELATIONSHIP] === DEP_GUR_RELATIONSHIP_GUARDIAN ? true : false;
            document.getElementById("inRelGuardianChecked").disabled = true;
            document.getElementById("inRelMyselfChecked").checked = false;
            document.getElementById("inRelMyselfChecked").disabled = true;
            document.getElementById("inGurAddress").value = currentObj[DEP_GUR_ADDR];
            document.getElementById("inGurAddress").setAttribute('readonly','readonly');
            document.getElementById("state_drop").setAttribute('style','background-color: #e9ecef');
            document.getElementById("state_drop").disabled = true;
            document.getElementById("area_drop").setAttribute('style','background-color: #e9ecef');
            document.getElementById("area_drop").disabled = true;

            // ------State Dropdown start------- //
            gState =currentObj[DEP_GUR_STATE_ID];
            gArea =currentObj[DEP_GUR_AREA_ID];
            let state_select = document.getElementById("state_drop");
            let state = MYAllState;
            let stateId = MYAllStateId;
            for(i=1; i <= 100; i++){
              state_select.remove(1);
            }
            for (let i = 0; i < MYAllState.length; i++) {
              let el = document.createElement("option");
              el.textContent = MYAllState[i];
              el.value = MYAllStateId[i];
              // Update State
              if (stateId[i] === currentObj[DEP_GUR_STATE_ID]) {
                el.selected = true;
              }
              state_select.appendChild(el);
            }

            // ------Area Dropdown start------- //
            let select_area = document.getElementById("area_drop");
            for(i=1; i <= 100; i++){
                select_area.remove(1);
            }
            if (!(currentObj[DEP_GUR_STATE_ID] == null || currentObj[DEP_GUR_STATE_ID] =='')){
              let cityInfo = selectCityListBasedOnStateId(currentObj[DEP_GUR_STATE_ID]);
              let cityName = cityInfo[0];
              let cityId = cityInfo[1];
              for (let i = 0; i < cityName.length; i++) {
                  let el = document.createElement("option");
                  el.textContent = cityName[i];
                  el.value = cityId[i];
                  // Default selection based on existing class
                  if (cityId[i] === currentObj[DEP_GUR_AREA_ID]) {
                    el.selected = true;
                  }
                  select_area.appendChild(el);
              }
            }

            // Reassign action
            if (action === JOIN_AS_STUDENT){
              action = JOIN_AS_STUDENT_WITH_DEPID
            }else if (action === JOIN_AS_STUDENT_AND_CLASS){
              action = JOIN_AS_STUDENT_AND_CLASS_WITH_DEPID
            }else if (action === JOIN_AS_STUDENT_AND_ADD_DEPENDANT){
              action = JOIN_AS_STUDENT_WITH_DEPID
            }else if (action === JOIN_AS_STUDENT_CLASS_AND_ADD_DEPENDANT){
              action = JOIN_AS_STUDENT_AND_CLASS_WITH_DEPID
            }else{
              // Remain action
            }

          }
          else{}

        });

      }
    }

    // Reset Fields in Student and Guardian Panels
    function resetStudentGuardianPanel(){
      document.getElementById("inStuName").value = '';
      document.getElementById("inStuName").removeAttribute('readonly');
      // document.getElementById("phoneStudent").value = '';
      itiStudent.setNumber("");
      document.getElementById("phoneStudent").removeAttribute('readonly');
      document.getElementById("inStuEmail").value = '';
      document.getElementById("inStuEmail").removeAttribute('readonly');
      document.getElementById("inStuMaleChecked").checked = true;
      document.getElementById("inStuMaleChecked").disabled = false;
      document.getElementById("inStuFemaleChecked").checked = false;
      document.getElementById("inStuFemaleChecked").disabled = false;
      document.getElementById("inStuSchool").value = '';
      document.getElementById("inStuSchool").removeAttribute('readonly');

      // Guardian Profile Panel
      document.getElementById("inGurName").value = '';
      document.getElementById("inGurName").removeAttribute('readonly');
      // document.getElementById("phoneGuardian").value = '';
      itiGuardian.setNumber("");
      document.getElementById("phoneGuardian").removeAttribute('readonly');
      document.getElementById("inGurEmail").value = '';
      document.getElementById("inGurEmail").removeAttribute('readonly');
      document.getElementById("inGurMaleChecked").checked = true ;
      document.getElementById("inGurMaleChecked").disabled = false;
      document.getElementById("inGurFemaleChecked").checked = false;
      document.getElementById("inGurFemaleChecked").disabled = false;
      document.getElementById("inRelParentsChecked").checked = true;
      document.getElementById("inRelParentsChecked").disabled = false;
      document.getElementById("inRelGuardianChecked").checked = false;
      document.getElementById("inRelGuardianChecked").disabled = false;
      document.getElementById("inRelMyselfChecked").checked = false;
      document.getElementById("inRelMyselfChecked").disabled = false;
      document.getElementById("inGurAddress").value = '';
      document.getElementById("inGurAddress").removeAttribute('readonly');
      document.getElementById("state_drop").setAttribute('style','background-color: #fff');
      document.getElementById("state_drop").disabled = false;
      document.getElementById("area_drop").setAttribute('style','background-color: #fff');
      document.getElementById("area_drop").disabled = false;

      // ------Area & State Dropdown Reset------- //
      let state_select = document.getElementById("state_drop");
      for(i=1; i <= 100; i++){
        state_select.remove(1);
      }
      for (let i = 0; i < MYAllState.length; i++) {
        let el = document.createElement("option");
        el.textContent = MYAllState[i];
        el.value = MYAllStateId[i];
        state_select.appendChild(el);
      }

      let select_area = document.getElementById("area_drop");
      for(i=1; i <= 100; i++){
        select_area.remove(1);
      }

    }

    async function ValidateStudentInStudentDB(depId, addStuToClass = false){
      // console.log('DEPENDANT ID: '+currentObj[DEP_ID])
      // If currentObj is not null, means user selected a dependant.
      // Check if the depId & adminId match. If exist, it means the dependent is already a user of admin,
      // do not add the student to admin student pool.
      console.log('ValidateStudentInStudentDB: ',depId, addStuToClass );
      console.log('currentObj: ', currentObj );
      if (!(currentObj === null)){
        let docRef = db.collection("Class")
          .doc("v1")
          .collection("Student")
          .where("depId", "==", currentObj[DEP_ID])
          .where("adminId", "==", adminId)
          .where("statusAdmin", "==", true);

        await docRef
          .get()
          .then((querySnapshot) => {
            if(querySnapshot.empty){
              // CREATE NEW STUDENT
              Promise.resolve( AddStudentToStudentDB(currentObj[DEP_ID], addStuToClass)) ;
            }else{
              // depId & adminId match. Skipped
              console.log('exited')
              func.showNotification('top','center', 'warning', 'error_outline', "Student already exist. Skipped." );

              // Skip adding student to Student Module. Check if add Student To Class_Student Module is needed.
              if (addStuToClass){
                return Promise.resolve(ValidateStudentInClassDB(currentObj[DEP_ID]))
              }else{
                registrationCompletePage();
              }
            }
          });
      }
      // currentObj is null, so create a new student.
      else{

        await AddStudentToStudentDB(depId, addStuToClass);
      }
    }

    // Add New Student to Student Module
    async function AddStudentToStudentDB(dependantId, addStuToClass= false){
      // Tutor Id must be a phone with +60, no spacing or other chars
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Student")
          .doc();

      let data = {
        [STU_ID]: docRef.id,
        // [STU_USER_ID]: '', Unused because this is equal to viewer ID
        [STU_ADMIN_ID]: adminId,
        [STU_DEPENDENT_ID]: dependantId,
        [STU_VIEWER_ID]: [itiGuardian.getNumber(),itiStudent.getNumber()],
        [STU_DATE_ADD]: new Date(),
        [STU_DATE_EDIT]: '',
        [STU_DATE_DEL]: '',
        [STU_ENROLLMENT_STATUS]: STU_ENROLLMENT_STATUS_PENDING,
        [STU_STATUS]: true,
        [STU_STATUS_ADMIN]: true,
        [STU_STATUS_USER]: true,
        [STU_ADMIN_NAME]: ent_name,
        [STU_ADMIN_PHONE]: ent_phone,
        [STU_ADMIN_ADDR]: ent_addr,
        [STU_ADMIN_IMG_URL]: ent_imgUrl,
        [STU_GUR_ID]: itiGuardian.getNumber(),
        [STU_GUR_RELATIONSHIP]: document.getElementById("inRelParentsChecked").checked ? STU_GUR_RELATIONSHIP_PARENTS : (document.getElementById("inRelGuardianChecked").checked ? STU_GUR_RELATIONSHIP_GUARDIAN : STU_GUR_RELATIONSHIP_MYSELF),
        [STU_GUR_NAME]: document.getElementById("inGurName").value,
        [STU_GUR_PHONE]: itiGuardian.getNumber(),
        [STU_GUR_GENDER]: document.getElementById("inGurMaleChecked").checked ? 0 : 1,
        [STU_GUR_EMAIL]: document.getElementById("inGurEmail").value,
        [STU_GUR_ADDR]: document.getElementById("inGurAddress").value,
        [STU_GUR_STATE_ID]: gState,
        [STU_GUR_AREA_ID]: gArea,
        [STU_CHILD_ID]: itiStudent.getNumber(),
        [STU_CHILD_NAME]: document.getElementById("inStuName").value,
        [STU_CHILD_PHONE]: itiStudent.getNumber(),
        [STU_CHILD_GENDER]: document.getElementById("inStuMaleChecked").checked ? 0 : 1,
        [STU_CHILD_EMAIL]: document.getElementById("inStuEmail").value,
        [STU_CHILD_SCHOOL]: document.getElementById("inStuSchool").value,

      }
      console.log('Student Module')
      console.log(data);
      await docRef.set(data , { merge: true })
      .then(() => {
        // window.location = "./student.html";
        func.showNotification('top','center', 'success', 'error_outline', "Added new student!" );


        // check if add Stu To Class is needed.
        if (addStuToClass){
          return Promise.resolve( ValidateStudentInClassDB(dependantId) );
        }else{
          registrationCompletePage();
        }


      }).catch((error) => {
        console.log("Error getting document:", error);
        func.showNotification('top','center', 'error', 'error_outline', "Creating new student failed! Please inform your class owner to fix it." );
      });

      // Update student number in Report > v1 > General
      await Promise.resolve( updateGeneralReportNum(adminId, NUM_TYPE_STUDENT, 'asc', 1) )


    }


    async function ValidateStudentInClassDB(dependantId){
      // console.log('DEPENDANT ID: '+currentObj[DEP_ID])
      // If currentObj is not null, means user selected a dependant. Check if the depId & adminId match
      // currentObj is Session Storage for Dependant list selected.
      if (!(currentObj === null)){
        let docRef = db.collection("Class")
          .doc("v1")
          .collection("Class_Student")
          .where(CLASS_STUDENT_DEPENDENT_ID, "==", currentObj[DEP_ID])
          .where(CLASS_STUDENT_CLASS_ID, "==", classId)
          .where("status", "==", true);

        await docRef
          .get()
          .then((querySnapshot) => {
            if(querySnapshot.empty){
              // CREATE NEW STUDENT
              return Promise.resolve( AddStudentToClassDB(currentObj[DEP_ID])) ;
            }else{
              // depId & adminId match. Skipped
              registrationCompletePage();
              func.showNotification('top','center', 'warning', 'error_outline', "Student already exist. Skipped." );
            }
          });
      }
      // currentObj is null, so create a new student in Student Module
      else{
        await AddStudentToClassDB(dependantId);
      }
    }

    // Add New Student to Class_Student Module
    async function AddStudentToClassDB(depId){
      // depId is passed all the way from create dependant.

      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Class_Student")
          .doc();

      let data = {
        [CLASS_STUDENT_ID]: docRef.id,
        // Get from Dependant Module
        [CLASS_STUDENT_CLASS_ID]: classId,
        [CLASS_STUDENT_ADMIN_ID]: adminId,
        [CLASS_STUDENT_STATUS]: true,
        [CLASS_STUDENT_DATE_ADD]: new Date(),
        [CLASS_STUDENT_DATE_EDIT]: '',
        [CLASS_STUDENT_DATE_DEL]: '',
        [CLASS_STUDENT_ENROLLMENT_STATUS]: CLASS_STUDENT_ENROLLMENT_STATUS_PENDING,
        [CLASS_STUDENT_FEEDBACK]: '',
        // Get from Dependant Module
        [CLASS_STUDENT_DEPENDENT_ID]: depId,
        [CLASS_STUDENT_STU_ID]: itiStudent.getNumber(),
        [CLASS_STUDENT_STU_NAME]: document.getElementById("inStuName").value,
        [CLASS_STUDENT_STU_PHONE]: itiStudent.getNumber(),
        [CLASS_STUDENT_STU_GENDER]: document.getElementById("inStuMaleChecked").checked ? 0 : 1,
        [CLASS_STUDENT_STU_EMAIL]: document.getElementById("inStuEmail").value,
        [CLASS_STUDENT_GUR_ID]: itiGuardian.getNumber(),
        [CLASS_STUDENT_GUR_NAME]: document.getElementById("inGurName").value,
        [CLASS_STUDENT_GUR_PHONE]: itiGuardian.getNumber(),
        [CLASS_STUDENT_GUR_EMAIL]: document.getElementById("inGurEmail").value,
        [CLASS_STUDENT_GUR_ADDR]: document.getElementById("inGurAddress").value,

      }
      console.log('AddStudentToClassDB()');
      console.log(data);

      await docRef.set(data , { merge: true })
        .then(() => {
          registrationCompletePage();
          func.showNotification('top','center', 'success', 'error_outline', "Added to Class." );
        }).catch((error) => {
          func.showNotification('top','center', 'error', 'error_outline', "Registration failed! Please inform your class owner to fix it." );
          console.log("Error getting document:", error);
        });

    }

   // Add Student Info as Dependant
   function AddDependantToDB(addStuToClass = false){
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Dependant")
          .doc();

      let data = {
        [DEP_ID]: docRef.id,
        [DEP_USER_ID]: userId,
        [DEP_DATE_ADD]: new Date(),
        [DEP_DATE_EDIT]: '',
        [DEP_DATE_DEL]: '',
        [DEP_STATUS]: true,

        [DEP_GUR_ID]: userId,
        [DEP_GUR_RELATIONSHIP]: document.getElementById("inRelParentsChecked").checked ? DEP_GUR_RELATIONSHIP_PARENTS : DEP_GUR_RELATIONSHIP_GUARDIAN,
        [DEP_GUR_NAME]: document.getElementById("inGurName").value,
        [DEP_GUR_PHONE]: current_phone,
        [DEP_GUR_GENDER]: document.getElementById("inGurMaleChecked").checked ? 0 : 1,
        [DEP_GUR_EMAIL]: document.getElementById("inGurEmail").value,
        [DEP_GUR_ADDR]: document.getElementById("inGurAddress").value,
        [DEP_GUR_STATE_ID]: gState,
        [DEP_GUR_AREA_ID]: gArea,

        [DEP_CHILD_ID]: itiStudent.getNumber(),
        [DEP_CHILD_NAME]: document.getElementById("inStuName").value,
        [DEP_CHILD_PHONE]: itiStudent.getNumber(),
        [DEP_CHILD_GENDER]: document.getElementById("inStuMaleChecked").checked ? 0 : 1,
        [DEP_CHILD_EMAIL]: document.getElementById("inStuEmail").value,
        [DEP_CHILD_SCHOOL]: document.getElementById("inStuSchool").value,
      }

      console.log('Dependant Module')
      console.log(data)
      let docRefWithMerge = docRef.set(data, { merge: true })
      .then(() => {
        // window.location.href='./'
        // Once complete adding dependant, pass the depId and bool(addStuToClass) to the next action

        ValidateStudentInStudentDB(data.id, addStuToClass);
        func.showNotification('top','center', 'success', 'error_outline', "Successfully created new dependant!" );

      });

    }

    // Sign out
    function signOutFunction(){
      $('#signOutModal').modal('show');
      $("#signOutModal").appendTo("body");
    }


  </script>

  <script>

    // Global var
    var gState ='';
    var gArea ='';
    var gStateName='';
    var gAreaName ='';

    $( document ).ready(function() {

      $('#registerWaitModal').modal('hide');
      //------------- Login Panel -----------//

      $('#btnVerify').on('click', function(){
        // let number = itiPhone.getNumber();
        // console.log(number);
        phoneAuth();

        // document.getElementById("phone").setAttribute("style", "background-color: #c1c1c1");
        document.getElementById("phone").disabled = true;
      });


      $('#btnLogin').on('click', function(){
        codeverify();
      });


      //------------- Select Profile Panel -----------//
      $('#btnAddNewDependant').on('click', function(){
        // Clear the fields in Student and Guardian panel first
        resetStudentGuardianPanel();

        // Clear sessionStorage for Dependant
        currentObj = null;

        // Student Profile Panel
        document.getElementById("inStuName").value = '';
        // document.getElementById("phoneStudent").value = '';
        itiStudent.setNumber("");
        document.getElementById("inStuEmail").value = '';
        document.getElementById("inStuMaleChecked").checked = true;
        document.getElementById("inStuFemaleChecked").checked = false;
        document.getElementById("inStuSchool").value = '';

        // Guardian Profile Panel
        document.getElementById("inGurName").value = current_name;
        // document.getElementById("phoneGuardian").value = current_phone;
        itiGuardian.setNumber(current_phone);
        document.getElementById("phoneGuardian").setAttribute('readonly','readonly');
        document.getElementById("inGurEmail").value = current_email;
        document.getElementById("inGurMaleChecked").checked = true ;
        document.getElementById("inGurFemaleChecked").checked = false;
        document.getElementById("inRelParentsChecked").checked = true;
        document.getElementById("inRelGuardianChecked").checked = false;
        document.getElementById("inRelMyselfChecked").checked = false;
        document.getElementById("inRelMyselfChecked").disabled = true;
        document.getElementById("inGurAddress").value = current_address;

        // Reassign action if add new dependant is selected
        if (action === JOIN_AS_STUDENT){
          action = JOIN_AS_STUDENT_AND_ADD_DEPENDANT
        }else if (action === JOIN_AS_STUDENT_AND_CLASS){
          action = JOIN_AS_STUDENT_CLASS_AND_ADD_DEPENDANT
        }else{
          // Remain action
        }


      });

      $('#btnEnrollMyself').on('click', function(){
        // Clear the fields in Student and Guardian panel first
        resetStudentGuardianPanel();

        // Clear sessionStorage for Dependant
        currentObj = null;

        // Student Profile Panel
        document.getElementById("inStuName").value = current_name;
        // document.getElementById("phoneStudent").value = current_phone;
        itiStudent.setNumber(current_phone);
        document.getElementById("phoneStudent").setAttribute('readonly','readonly');
        document.getElementById("inStuEmail").value = current_email;
        document.getElementById("inStuMaleChecked").checked = true;
        document.getElementById("inStuFemaleChecked").checked = false;
        document.getElementById("inStuSchool").value = '';

        // Guardian Profile Panel
        document.getElementById("inGurName").value = current_name;
        // document.getElementById("phoneGuardian").value = current_phone;
        itiGuardian.setNumber(current_phone);
        document.getElementById("phoneGuardian").setAttribute('readonly','readonly');
        document.getElementById("inGurEmail").value = current_email;
        document.getElementById("inGurMaleChecked").checked = true ;
        document.getElementById("inGurFemaleChecked").checked = false;
        document.getElementById("inRelParentsChecked").checked = false;
        document.getElementById("inRelParentsChecked").disabled = true;
        document.getElementById("inRelGuardianChecked").checked = false;
        document.getElementById("inRelGuardianChecked").disabled = true;
        document.getElementById("inRelMyselfChecked").checked = true;
        document.getElementById("inGurAddress").value = current_address;

      // Reassign action
        if (action === JOIN_AS_STUDENT_AND_ADD_DEPENDANT){
          action = JOIN_AS_STUDENT
        }else if (action === JOIN_AS_STUDENT_CLASS_AND_ADD_DEPENDANT){
          action = JOIN_AS_STUDENT_AND_CLASS
        }else{
          // Remain action
        }
      });

      $('#btnEnrollNow').on('click', function(){
        // Clear the fields in Student and Guardian panel first
        resetStudentGuardianPanel();

        // Clear sessionStorage for Dependant
        currentObj = null;

        // Student Profile Panel
        document.getElementById("inStuName").value = current_name;
        // document.getElementById("phoneStudent").value = current_phone;
        document.getElementById("phoneStudent").setAttribute('readonly','readonly');
        itiStudent.setNumber(current_phone);
        document.getElementById("inStuEmail").value = current_email;
        document.getElementById("inStuMaleChecked").checked = true;
        document.getElementById("inStuFemaleChecked").checked = false;
        document.getElementById("inStuSchool").value = '';

        // Guardian Profile Panel
        document.getElementById("inGurName").value = '';
        // document.getElementById("phoneGuardian").value = '';
        itiGuardian.setNumber("");
        document.getElementById("inGurEmail").value = '';
        document.getElementById("inGurMaleChecked").checked = true ;
        document.getElementById("inGurFemaleChecked").checked = false;
        document.getElementById("inRelParentsChecked").checked = true;
        document.getElementById("inRelGuardianChecked").checked = false;
        document.getElementById("inRelMyselfChecked").checked = false;
        document.getElementById("inRelMyselfChecked").disabled = true;
        document.getElementById("inGurAddress").value = '';

        // Reassign action
        if (action === JOIN_AS_STUDENT_AND_ADD_DEPENDANT){
          action = JOIN_AS_STUDENT
        }else if (action === JOIN_AS_STUDENT_CLASS_AND_ADD_DEPENDANT){
          action = JOIN_AS_STUDENT_AND_CLASS
        }else{
          // Remain action
        }
      });


      // ------State Dropdown start------- //
      let state_select = document.getElementById("state_drop");
      for (let i = 0; i < MYAllState.length; i++) {
        let el = document.createElement("option");
        el.textContent = MYAllState[i];
        el.value = MYAllStateId[i];
        state_select.appendChild(el);
      }

      // Populate Area based on selected State
      $('#state_drop').on('change', function(){
          // Initialization
          // Reasign area after the statre change. It suppose to be defaulted to "Select area"
          gArea = '';
          gAreaName = '';

          // Get the val and txt of the selected state
          let StateId = $(this).val();
          let StateName = $(this).find("option:selected").text();
          gState = StateId;
          gStateName = StateName

          let select_area = document.getElementById("area_drop");
          // Clear the area option first, except the first one. 100 is just a magic number
          for(i=1; i <= 100; i++){
              select_area.remove(1);
          }

          // Generate all cities based on stateId
          if  (!(StateId == "" || StateId == null )){
            let stateInfo = selectCityListBasedOnStateId (gState);
            for (let i = 0; i < stateInfo[0].length; i++) {
              let el = document.createElement("option");
              el.textContent = stateInfo[0][i];
              el.value = stateInfo[1][i];;
              select_area.appendChild(el);
            }
          }
      });
      // ------Area Dropdown Start------- //
      $('#area_drop').on('change', function(){
          gArea = $(this).val()
          gAreaName = $(this).find("option:selected").text();
      });

      // Active Register Class Modal
      $('#registerWaitModal').modal({
        backdrop:'static',
        keyboard:false,
        show: false
      });

      // Create and Register Modal
      // $('#btnRegister').on('click', function (e) {
      //   e.preventDefault();
      //   let fieldsValid = validateForm(3); // Validate guardian pannel
      //   let phoneValid = ValidatePhone('phoneGuardian');
      //   $('#registerWaitModal').modal('show');
      //   $('#registerWaitModal').modal('hide');
      // });

      $("#registerWaitModal").on('show.bs.modal', function (e) {
      //   e.preventDefault();
      })

      // $('#registerWaitModal').on('shown.bs.modal', function () {
      //   setTimeout(function(){
      //     $('#registerWaitModal').modal('hide');}, 1500);
      // })

      $('#registerWaitModal').on('hide.bs.modal', function (e) {
        // Function does not run on first call
        // alert('HIIIIIII')
        // $(".alert.alert-success").show();
        // getSessions();
      })


      $('#btnSaveModalUpdate').on('click', function (e) {
        AddStudentToDB();
      });

      $('#btnSaveModalClose1').on('click', function (e) {
        $('#saveModal').modal('hide');
      });

      $('#btnSaveModalClose2').on('click', function (e) {
        $('#saveModal').modal('hide');
      });

      $('#btnSignOutModalUpdate').on('click', function (e) {
        firebase.auth().signOut().then(() => {
            // Sign-out successful.
          }).catch((error) => {
            func.showNotification('top','center', 'danger', 'error_outline', "Logging out failed." );
          });
      });
    });

  </script>


  <!-- Multiform-specific script -->
  <script>
    //DOM elements
    const DOMstrings = {
      stepsBtnClass: 'multisteps-form__progress-btn',
      stepsBtns: document.querySelectorAll(`.multisteps-form__progress-btn`),
      stepsBar: document.querySelector('.multisteps-form__progress'),
      stepsForm: document.querySelector('.multisteps-form__form'),
      stepsFormTextareas: document.querySelectorAll('.multisteps-form__textarea'),
      stepFormPanelClass: 'multisteps-form__panel',
      stepFormPanels: document.querySelectorAll('.multisteps-form__panel'),
      stepPrevBtnClass: 'js-btn-prev',
      stepNextBtnClass: 'js-btn-next',
      stepSendBtnClass: 'js-btn-send' };


    //remove class from a set of items
    const removeClasses = (elemSet, className) => {

      elemSet.forEach(elem => {

        elem.classList.remove(className);

      });

    };

    //return exect parent node of the element
    const findParent = (elem, parentClass) => {

      let currentNode = elem;

      while (!currentNode.classList.contains(parentClass)) {
        currentNode = currentNode.parentNode;
      }

      return currentNode;

    };

    //get active button step number
    const getActiveStep = elem => {
      return Array.from(DOMstrings.stepsBtns).indexOf(elem);
    };

    //set all steps before clicked (and clicked too) to active
    const setActiveStep = activeStepNum => {

      //remove active state from all the state
      removeClasses(DOMstrings.stepsBtns, 'js-active');

      //set picked items to active
      DOMstrings.stepsBtns.forEach((elem, index) => {

        if (index <= activeStepNum) {
          elem.classList.add('js-active');
        }

      });
    };

    //get active panel
    const getActivePanel = () => {

      let activePanel;

      DOMstrings.stepFormPanels.forEach(elem => {

        if (elem.classList.contains('js-active')) {

          activePanel = elem;

        }

      });

      return activePanel;

    };

    //open active panel (and close unactive panels)
    const setActivePanel = activePanelNum => {

      //remove active class from all the panels
      removeClasses(DOMstrings.stepFormPanels, 'js-active');

      //show active panel
      DOMstrings.stepFormPanels.forEach((elem, index) => {
        if (index === activePanelNum) {

          elem.classList.add('js-active');

          setFormHeight(elem);

        }
      });

    };

    //set form height equal to current panel height
    const formHeight = activePanel => {

      const activePanelHeight = activePanel.offsetHeight;

      DOMstrings.stepsForm.style.height = `${activePanelHeight}px`;

    };

    const setFormHeight = () => {
      const activePanel = getActivePanel();

      formHeight(activePanel);
    };

    //STEPS BAR CLICK FUNCTION
    DOMstrings.stepsBar.addEventListener('click', e => {

      //check if click target is a step button
      const eventTarget = e.target;

      if (!eventTarget.classList.contains(`${DOMstrings.stepsBtnClass}`)) {
        return;
      }

      //get active button step number
      const activeStep = getActiveStep(eventTarget);

      //set all steps before clicked (and clicked too) to active
      // setActiveStep(activeStep);

      // //open active panel
      // setActivePanel(activeStep);

    });

    //PREV/NEXT BTNS CLICK
    DOMstrings.stepsForm.addEventListener('click', e => {
      const eventTarget = e.target;

      //find active panel
      const activePanel = findParent(eventTarget, `${DOMstrings.stepFormPanelClass}`);

      let activePanelNum = Array.from(DOMstrings.stepFormPanels).indexOf(activePanel);
      // console.log(action);
      // console.log(currentObj);
      //check if we clicked on `PREV` or NEXT` buttons
      if (eventTarget.classList.contains(`${DOMstrings.stepSendBtnClass}`))
      {
        // $('#registerWaitModal').modal('show');
        validateForm(activePanelNum);
        ValidatePhone('phoneGuardian');
        console.log(itiGuardian.getNumber())
        console.log(validateForm(activePanelNum), ValidatePhone('phoneGuardian'))


        if (validateForm(activePanelNum) && ValidatePhone('phoneGuardian')){

          // Disable the submit button
          document.getElementById("btnRegister").setAttribute('disabled', 'disabled');

          // Change the "Submit" text
          document.getElementById("btnRegister").textContent = 'Please wait...';

          // Dependant > Student > Class_Student
          if (action === JOIN_AS_STUDENT){
            // User join themselves or join as student

            ValidateStudentInStudentDB('', false)


          }else if (action === JOIN_AS_STUDENT_AND_CLASS){
            // User join themselves or join as student. Add student to class.

            ValidateStudentInStudentDB('', true);
            // ValidateStudentInClassDB();
          }
          else if (action === JOIN_AS_STUDENT_AND_ADD_DEPENDANT){
            // User create a new dependant to join

            AddDependantToDB(false);

          }
          else if (action === JOIN_AS_STUDENT_CLASS_AND_ADD_DEPENDANT){
            // User create a new dependant to join. Add student to class.

            AddDependantToDB(true);
            // ValidateStudentInClassDB();
          }
          else if (action === JOIN_AS_STUDENT_WITH_DEPID){
            // User selected a dependant to join

            ValidateStudentInStudentDB(currentObj[DEP_ID], false)

          }
          else if (action === JOIN_AS_STUDENT_AND_CLASS_WITH_DEPID){
            // User selected a dependant to join. Add student to class.

            ValidateStudentInStudentDB(currentObj[DEP_ID], true)
            // ValidateStudentInClassDB();
          }
          else{


          }
          console.log('All guardian fields are valid');
          // $('#registerWaitModal').modal('hide');
        }else{
          // If the compulsory fields is not filled up, return and do not proceed to add student
          return;
        }

      }
      else if (eventTarget.classList.contains(`${DOMstrings.stepPrevBtnClass}`)) {
        activePanelNum--;
        setActiveStep(activePanelNum);
        setActivePanel(activePanelNum);
      }
      else if (eventTarget.classList.contains(`${DOMstrings.stepNextBtnClass}`)) {
        // console.log('ACTION: '+action)
        let inputPhonePage1Valid = itiPhone.isValidNumber() && inputPhone.value.length > 4;
        let inputPhonePage2StudentInfoValid = itiStudent.isValidNumber() || inputStudent.value.length <= 4;
        let activePanelAllFilled = validateForm(activePanelNum);
        // console.log(inputPhonePage1Valid,inputPhonePage2StudentInfoValid, activePanelAllFilled, activePanelNum );
        if ( activePanelNum === 0)
        {
          // Check Login panel Phone. If user enter an invalid number of do not enter anything, set invalid.
          if (itiPhone.isValidNumber() || inputPhone.value.length > 4)
          {
            if (activePanelAllFilled && inputPhonePage1Valid)
            {
              activePanelNum++;
              setActiveStep(activePanelNum);
              setActivePanel(activePanelNum);
            }
            else{
              inputPhone.className += " invalid";
            }
          }
          else
          {
            inputPhone.className += " invalid";
          }
        }
        else if (activePanelNum === 1)
        {
          activePanelNum++;
          setActiveStep(activePanelNum);
          setActivePanel(activePanelNum);
        }
        else if (activePanelNum === 2)
        {
          // Check student Info panel Phone. If user enter an invalid number by do not enter anything, set invalid.
          // if (itiStudent.isValidNumber() || inputStudent.value.length > 4)
          // {
            if (activePanelAllFilled && inputPhonePage2StudentInfoValid)
            {
              activePanelNum++;
              setActiveStep(activePanelNum);
              setActivePanel(activePanelNum);
            }
            else{
              // inputStudent.className += " invalid";
            }
          // }
          // else
          // {
          //   inputStudent.className += " invalid";
          // }


        }
        else{
          // activePanelNum++;
          // setActiveStep(activePanelNum);
          // setActivePanel(activePanelNum);
        }
      }
      else{
        // Do nothing and return
        return;

      }

      // setActiveStep(activePanelNum);
      // setActivePanel(activePanelNum);
    });

    //SETTING PROPER FORM HEIGHT ONLOAD
    window.addEventListener('load', setFormHeight, false);

    //SETTING PROPER FORM HEIGHT ONRESIZE
    window.addEventListener('resize', setFormHeight, false);

    //changing animation via animation select !!!YOU DON'T NEED THIS CODE (if you want to change animation type, just change form panels data-attr)

    const setAnimationType = newType => {
      DOMstrings.stepFormPanels.forEach(elem => {
        elem.dataset.animation = newType;
      });
    };

    function validateForm(activePanelNum) {
      // This function deals with validation of the form fields with data-compulsory = 'true'
      var x, y, i, valid = true;
      x = document.getElementsByClassName("multisteps-form__panel");
      // y = x[activePanelNum].getElementsByTagName("input") && x[activePanelNum].querySelectorAll('[type="text"]');
      y =x[activePanelNum].querySelectorAll('[data-compulsory="true"]');

      // A loop that checks every input field in the current tab:
      for (i = 0; i < y.length; i++) {
        // console.log(y[i].value)
        // If a field is empty...
        if (y[i].value == "") {
          // add an "invalid" class to the field:
          y[i].className += " invalid";
          // and set the current valid status to false:
          valid = false;
        }
      }
      // If the valid status is true, mark the step as finished and valid:
      if (valid) {
        // document.getElementsByClassName("step")[activePanelNum].className += " finish";
      }
      return valid; // return the valid status
    }

  </script>

  <!-- Tel input script -->
  <script>
    // Phone
    var inputPhone = document.querySelector("#phone");
    var inputStudent = document.querySelector("#phoneStudent");
    var inputGuardian = document.querySelector("#phoneGuardian");
    var itiPhone = intlTelInput(inputPhone,{
      autoHideDialCode: false,
      nationalMode: false,
      // onlyCountries: ['MY', 'SG', 'TH', 'ID', 'VN', 'PH', 'BN', 'US', 'GB', 'SA'],
      preferredCountries: ['MY', 'SG'],
      separateDialCode: true,
      utilsScript: "https://golearn.com.my/assets/js/plugins/intlTelInput/utils.js",
    });

    var itiStudent = intlTelInput(inputStudent,{
      // allowDropdown: false,
      autoHideDialCode: false,
      // autoPlaceholder: "off",
      // dropdownContainer: document.body,
      // excludeCountries: ["my"],
      // formatOnDisplay: true,
      // geoIpLookup: function(callback) {
      //   $.get("http://ipinfo.io", function() {}, "jsonp").always(function(resp) {
      //     var countryCode = (resp && resp.country) ? resp.country : "";
      //     callback(countryCode);
      //   });
      // },
      // hiddenInput: "full_number",
      // initialCountry: "auto",
      // localizedCountries: { 'de': 'Deutschland' },
      nationalMode: false,
      // onlyCountries: ['my'],
      // onlyCountries: ['MY', 'SG', 'TH', 'ID', 'VN', 'PH', 'BN', 'US', 'GB', 'SA'],
      preferredCountries: ['MY', 'SG'],
      // placeholderNumberType: "MOBILE",
      separateDialCode: true,
      utilsScript: "https://golearn.com.my/assets/js/plugins/intlTelInput/utils.js",
      });

    var itiGuardian = intlTelInput(inputGuardian,{
      autoHideDialCode: false,
      nationalMode: false,
      // onlyCountries: ['MY', 'SG', 'TH', 'ID', 'VN', 'PH', 'BN', 'US', 'GB', 'SA'],
      preferredCountries: ['MY', 'SG'],
      separateDialCode: true,
      utilsScript: "https://golearn.com.my/assets/js/plugins/intlTelInput/utils.js",
    });

    var errorMsg = document.querySelector("#error-msg");
    var validMsg = document.querySelector("#valid-msg");
    var errorMsgStudent = document.querySelector("#error-msgStudent");
    var validMsgStudent = document.querySelector("#valid-msgStudent");
    var errorMsgGuardian = document.querySelector("#error-msgGuardian");
    var validMsgGuardian = document.querySelector("#valid-msgGuardian");

    // here, the index maps to the error code returned from getValidationError - see readme
    var errorMap = ["Invalid number", "Invalid country code", "Too short", "Too long", "Invalid number"];

    var reset = function() {
      inputPhone.classList.remove("error");
      errorMsg.innerHTML = "";
      errorMsg.classList.add("hide");
      validMsg.classList.add("hide");
    };
    var resetStudent = function() {
      inputStudent.classList.remove("error");
      errorMsgStudent.innerHTML = "";
      errorMsgStudent.classList.add("hide");
      validMsgStudent.classList.add("hide");
    };
    var resetGuardian = function() {
      inputGuardian.classList.remove("error");
      errorMsgGuardian.innerHTML = "";
      errorMsgGuardian.classList.add("hide");
      validMsgGuardian.classList.add("hide");
    };

    // on blur: validate

    inputPhone.addEventListener('blur', function() {
      reset();

      if (inputPhone.value.trim()) {
        if (itiPhone.isValidNumber()) {
          validMsg.classList.remove("hide");
        } else {
          inputPhone.classList.add("error");
          var errorCode = itiPhone.getValidationError();
          errorMsg.innerHTML = errorMap[errorCode];
          errorMsg.classList.remove("hide");
        }
      }
    });
    inputStudent.addEventListener('blur', function() {
      resetStudent();
      if (inputStudent.value.trim()) {
        if (itiStudent.isValidNumber()) {
          validMsgStudent.classList.remove("hide");
        } else {
          inputStudent.classList.add("error");
          var errorCode = itiStudent.getValidationError();
          errorMsgStudent.innerHTML = errorMap[errorCode];
          errorMsgStudent.classList.remove("hide");
        }
      }
    });
    inputGuardian.addEventListener('blur', function() {
      resetGuardian();
      if (inputGuardian.value.trim()) {
        if (itiGuardian.isValidNumber()) {
          validMsgGuardian.classList.remove("hide");
        } else {
          inputGuardian.classList.add("error");
          var errorCode = itiGuardian.getValidationError();
          errorMsgGuardian.innerHTML = errorMap[errorCode];
          errorMsgGuardian.classList.remove("hide");
        }
      }
    });

    // on keyup / change flag: reset
    inputPhone.addEventListener('change', reset);
    inputPhone.addEventListener('keyup', reset);
    inputStudent.addEventListener('change', resetStudent);
    inputStudent.addEventListener('keyup', resetStudent);
    inputGuardian.addEventListener('change', resetGuardian);
    inputGuardian.addEventListener('keyup', resetGuardian);

    // Validate fields in based on parents.
    function ValidateFields(parentId){
      // This function deals with validation of the form fields with data-compulsory = 'true'
      var x, y, i, valid = true;
      x = document.getElementById(parentId);

      y =x.querySelectorAll('[data-compulsory="true"]');

      // A loop that checks every input field in the current tab:
      for (i = 0; i < y.length; i++) {
        // console.log(y[i].value)
        // If a field is empty...
        if (y[i].value == "") {
          // add an "invalid" class to the field:
          y[i].className += " invalid";
          // and set the current valid status to false:
          valid = false;
        }
      }
      return valid; // return the valid status
    }

    // Validate fields - Phone Input specific.
    function ValidatePhone(phoneId){
      var valid = true;
      let inPhone = document.querySelector("#"+phoneId);
      // console.log(inPhone.value)
      if (inPhone.value.trim()) {
        if (itiGuardian.isValidNumber()) {
          // Do nothing
        } else {
          inPhone.className += " invalid";
          valid = false;
        }
      }
      return valid; // return the valid status
    }
  </script>

  <!-- Authentification -->
  <script>
    var coderesult;

    window.onload=function () {
      render();
    };
    function render() {
        // window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');
        // recaptchaVerifier.render();

        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
          // 'size': 'normal',
          'callback': (response) => {
              // reCAPTCHA solved, allow signInWithPhoneNumber.
              // ...
              // Enable the step1 verify button
              document.getElementById("btnVerify").removeAttribute("disabled");

          },
          'expired-callback': () => {
              // Response expired. Ask user to solve reCAPTCHA again.
              // ...
          }
      });
        recaptchaVerifier.render();

    }
    function phoneAuth() {
      //get the number
      // let number = document.getElementById('phone').value;
      let number = itiPhone.getNumber();
      console.log(number)
      //phone number authentication function of firebase
      //it takes two parameter first one is number,,,second one is recaptcha
      firebase.auth().signInWithPhoneNumber(number,window.recaptchaVerifier).then(function (confirmationResult) {
          //s is in lowercase
        window.confirmationResult=confirmationResult;
        coderesult=confirmationResult;

        // Disable step 1 button
        document.getElementById("btnVerify").setAttribute("disabled", true);

        // Enable the step2 button
        document.getElementById("btnLogin").removeAttribute("disabled");

        func.showNotification('top','center', 'success', 'check_circle', "We just sent a 6-digit verification code to "+document.getElementById('phone').value );

        console.log(coderesult);

      }).catch(function (error) {

        document.getElementById("phone").setAttribute("style", "background-color: #fff;");
        document.getElementById("phone").disabled = false;

        //Disable the step 1 button
        document.getElementById("btnVerify").setAttribute("disabled", true);


        console.log("Phone Verification Failed Error Code: "+ error);
        func.showNotification('top','center', 'danger', 'error_outline', "Phone Verification Failed. Please make sure you enter a valid phone number." );

      });
    }
    function codeverify() {

      let code=document.getElementById('verificationCode').value;
      coderesult.confirm(code)
      // Layer 1: Get User
      .then(function (result) {
        console.log('Layer: 1')
        // alert("Successfully registered");
        let user=result.user;


        if (user.displayName == null ){
          userId = user.phoneNumber;
        }else
          userId = user.email.replace("[^a-zA-Z0-9]", "_").toLowerCase();

        const userRef = db.collection('Users').doc(userId);

        return Promise.resolve(userRef.get())

      })
      // Layer 2: If user doesn't existed, create a new user
      .then((docSnapshot) => {
        console.log('Layer: 2 ')
        var promiseAll = [];

        if (docSnapshot.exists) {
          // User exist. Move to next stage.
          console.log('Layer: 2 ' + docSnapshot.exists)
        }
        // User does not exist. Register a new user.
        else {
          console.log("USer does not exist! Create a new one: "+ userId );
          var docData = {
            [TOKEN_KEY]: null,    //main
            [NAME_KEY] : 'New User',    //main
            [EMAIL_KEY]  : "", //main
            [PHONE_KEY]  : itiPhone.getNumber(), //main
            [ADDRESS_1_KEY]  : "",
            [ADDRESS_2_KEY]  : "",
            [ADDRESS_POSTCODE_KEY]  : "",
            [ADDRESS_STATE_KEY]  : "",
            [IMAGE_KEY]  : "",
            [NRIC_KEY]  : "",
            [SYSTEM_LAST_ONLINE_KEY]  : firebase.firestore.Timestamp.fromDate(new Date())
          }

          var userRef = db.collection("Users").doc(userId)

          promiseAll.push( userRef.set(docData, {merge: true}))

        }

        return Promise.all(promiseAll)
      })

      // Layer 3: Load User info
      .then(() => {
        console.log('Layer: 3')
        console.log("Profile created. Reloading")
        return Promise.resolve ( loadUserInfo(userId))
      })
      .catch(function (error) {
        func.showNotification('top','center', 'danger', 'error_outline', "Phone Verification Failed. Please make sure you enter a valid 6-digit verification code." );
        console.log("Phone Verification Failed. Please make sure you enter a valid 6-digit verification code."+  error.message);
      });
    }

    // Use this after signin
    // Source: https://firebase.google.com/docs/auth/admin/verify-id-tokens#android
    function getToken(){
      firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
        // Send token to your backend via HTTPS
        userToken = idToken;
        }).catch(function(error) {
          // Handle error

        });
    }

  </script>
</body>

</html>