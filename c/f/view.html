<!doctype html>
<html lang="en">

<head>
  <!-- Meta -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>GoLearn School</title>
  <meta name=description content="GoLearn School&trade; is Malaysia #1 teaching platform to run your tuition business and manage your lessons. Start now for Free!">
  <meta property=og:title content="GoLearn School">
  <meta property=og:site_name content="GoLearn School">
  <meta property=og:type content=website>
  <meta property=og:url content=https://app.golearn.com.my/c/f/view.html>
  <meta property=og:image content=https://app.golearn.com.my/assets/img/icon-apple-touch-180x180.png>
  <meta property=og:description content="GoLearn School&trade; is Malaysia #1 teaching platform to run your tuition business and manage your lessons. Start now for Free!">
  <link rel=apple-touch-icon sizes=180x180 href=https://app.golearn.com.my/assets/img/icon-apple-touch-180x180.png>
  <link rel=icon type=image/png sizes=32x32 href=https://app.golearn.com.my/assets/img/icon-32x32.png>
  <link rel=icon type=image/png sizes=16x16 href=https://app.golearn.com.my/assets/img/icon-16x16.png>
  <!-- Fonts and icons -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" rel="stylesheet" type="text/css" />
  <script src="https://kit.fontawesome.com/2bdd669e92.js" crossorigin="anonymous"></script>
  <!-- Material Kit CSS -->
  <link href="../../assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet" />
  <!-- Firebase Init -->
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-firestore.js"></script>
  <script src="../../assets/js/firebase.js"></script>
  <!-- Tutor Portal specific CSS -->
  <!-- <link href="../../assets/css/tutor-portal.css" rel="stylesheet" /> -->
  <!-- TinyMce -->
  <script src="../../assets/js/plugins/tinymce/tinymce.min.js" type="text/javascript"></script>
  <!-- Tinymce init -->
  <script>
    tinymce.init({
      mode : "exact",
      selector:'#invNotes',
      plugins: "link",
      max_chars: 400,
      setup: function (ed) {
        var allowedKeys = [8, 13, 16, 17, 18, 20, 33, 34, 35, 36, 37, 38, 39, 40, 46];
        ed.on('keydown', function (e) {
          console.log(tinymce_getContentLength());
          invNotesOnChangeHandler();
          if (allowedKeys.indexOf(e.keyCode) != -1){
            return true;
          }
          if (tinymce_getContentLength() + 1 > this.settings.max_chars) {
            func.showNotification('top','center', 'warning', 'error_outline', 'You have reach maximum allowed number of ' + ed.settings.max_chars + ' characters.' );
            e.preventDefault();
            e.stopPropagation();
            return false;
          }
          return true;
        });
      },

      init_instance_callback: function () { // initialize counter div
        $('#' + this.id).prev().append('<div class="char_count" style="text-align:right"></div>');
        tinymce_updateCharCounter(this, tinymce_getContentLength());
      },
      paste_preprocess: function (plugin, args) {
        var editor = tinymce.get(tinymce.activeEditor.id);
        var len = editor.contentDocument.body.innerText.length;
        var text = $(args.content).text();
        if (len + text.length > editor.settings.max_chars) {
            func.showNotification('top','center', 'warning', 'error_outline', 'Pasting this exceeds the maximum allowed number of ' + editor.settings.max_chars + ' characters.' );
            args.content = '';
        } else {
            tinymce_updateCharCounter(editor, len + text.length);
        }
      }

    });
    tinymce.init({
      mode : "exact",
      selector:'#invFooterNotes',
      plugins: "link",
      max_chars: 200,
      setup: function (ed) {
        var allowedKeys = [8, 13, 16, 17, 18, 20, 33, 34, 35, 36, 37, 38, 39, 40, 46];

        ed.on('keydown', function (e) {
          console.log(tinymce_getContentLength());
          invFooterNotesOnChangeHandler();
          if (allowedKeys.indexOf(e.keyCode) != -1){
            return true;
          }
          if (tinymce_getContentLength() + 1 > this.settings.max_chars) {
            func.showNotification('top','center', 'warning', 'error_outline', 'You have reach maximum allowed number of ' + ed.settings.max_chars + ' characters.' );
            e.preventDefault();
            e.stopPropagation();
            return false;
          }
          return true;
        });

      },

      init_instance_callback: function () { // initialize counter div
        $('#' + this.id).prev().append('<div class="char_count" style="text-align:right"></div>');
        tinymce_updateCharCounter(this, tinymce_getContentLength());
      },
      paste_preprocess: function (plugin, args) {
        var editor = tinymce.get(tinymce.activeEditor.id);
        var len = editor.contentDocument.body.innerText.length;
        var text = $(args.content).text();
        if (len + text.length > editor.settings.max_chars) {
            func.showNotification('top','center', 'warning', 'error_outline', 'Pasting this exceeds the maximum allowed number of ' + editor.settings.max_chars + ' characters.' );
            args.content = '';
        } else {
            tinymce_updateCharCounter(editor, len + text.length);
        }
      },
    });

    function tinymce_updateCharCounter(el, len) {
      $('#' + el.id).prev().find('.char_count').text(len + '/' + el.settings.max_chars);
    }

    function tinymce_getContentLength() {
      return tinymce.get(tinymce.activeEditor.id).contentDocument.body.innerText.length;
    }
  </script>


  <style>
    .table {
        border: 1px solid #ccc;
        border-collapse: collapse;
    }
    .table th,
    .table td {
        border: 1px solid #ccc;
    }
    .table th,
    .table td {
        padding: 0.5rem;
    }
    .draggable {
        cursor: move;
        user-select: none;
    }
    .placeholder {
        background-color: #edf2f7;
        border: 2px dashed #cbd5e0;
    }
    .clone-list {
        border-top: 1px solid #ccc;
    }
    .clone-table {
        border-collapse: collapse;
        border: none;
    }
    .clone-table th{
        border: 1px solid #ccc;
        border-top: none;
        padding: 0.5rem;
        font-size: 1.2em;
        font-weight: 300;
    }

    .clone-table td {
        border: 1px solid #ccc;
        border-top: none;
        padding: 0.5rem;

        font-weight: 300;
    }
    .dragging {
        background: #fff;
        border-top: 1px solid #ccc;
        z-index: 999;
    }

    /* page view for A4  */
    page {
      background: white;
      display: block;
      margin: 0 auto;
      /* margin-bottom: 0.5cm; */
      box-shadow: 0 0 0.5cm rgba(0,0,0,0.5);
    }
    page[size="A4"] {
      width: 21cm;
      height: auto;
      min-height: 29.65cm;
      /* Use a  height value slightly lower than 29.7 to avoid page break  */
      /* height: 29.7cm;  */
    }
    page[size="A4"][layout="landscape"] {
      width: 29.7cm;
      height: 21cm;
    }


    /* .card-body footer1 {
        position: fixed;
    }

    .card-body footer1 {
        bottom: 0;
    } */
    .textarea1 {
      display: block;
      width: 100%;
      overflow: hidden;
      resize: both;
      min-height: 40px;
      line-height: 20px;
    }

    .textarea[contenteditable]:empty::before {
      content: "Placeholder still possible";
      color: gray;
    }
  </style>
</head>

<body>

  <div class="wrapper">
    <!-- <div class="sidebar" data-color="purple" data-background-color="white" data-image="../../assets/img/sidebar-3.jpg">
      <div class="logo">
        <a href="../" class="simple-text logo-mini">
			    <img src="../../assets/img/logo.png" style="width: 216px; height: auto;" alt=""></img>
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav" style="margin-bottom: 50px;">
          <li class="nav-item">
            <a class="nav-link" href="../">
              <i class="far fa-chart-bar fa-fw nav-icon"></i>
              <p>Dashboard</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../report/">
              <i class="far fa-lightbulb fa-fw nav-icon"></i>
              <p>Insight</p>
            </a>
          </li>
          <li class="nav-item">
            <h4 class="nav-link" style="margin-left: 1rem;">Teaching</h4>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../class/">
              <i class="fas fa-chalkboard fa-fw nav-icon"></i>
              <p>Classes</p>
            </a>
          </li>
		  		<li class="nav-item">
            <a class="nav-link" href="../student/">
              <i class="fas fa-user-graduate fa-fw nav-icon"></i>
              <p>Students</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="../teacher/">
              <i class="fas fa-chalkboard-teacher fa-fw nav-icon"></i>
              <p>Teachers</p>
            </a>
          </li>
          <li class="nav-item">
            <h4 class="nav-link" style="margin-left: 1rem;">Financial</h4>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="./">
              <i class="fas fa-file-invoice-dollar fa-fw nav-icon"></i>
              <p>Invoices</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../salary/">
              <i class="fas fa-money-bill-wave fa-fw nav-icon"></i>
              <p>Salaries</p>
            </a>
          </li>
          <li class="nav-item" id="navPayroll" style="display: none;">
            <a class="nav-link" href="../payroll/">
              <i class="fas fa-hand-holding-usd fa-fw nav-icon"></i>
              <p>Payroll <span style="visibility: hidden;">PRO</span></p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="../transaction/">
              <i class="fas fa-exchange-alt fa-fw nav-icon"></i>
              <p>Transactions</p>
            </a>
          </li>
          <li class="nav-item">
            <h4 class="nav-link" style="margin-left: 1rem;">Public</h4>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../course/">
              <i class="fas fa-book-open fa-fw nav-icon"></i>
              <p>My Public Courses
                <span style="background-color: #2e74b6;padding: 0.2em 0.5em 0.2em 0.5em;color: white;border-radius: 3px;font-size: x-small;">New</span>
              </p>
            </a>
          </li>
		  		<li class="nav-item">
            <a class="nav-link" href="../job/">
              <i class="fas fa-briefcase fa-fw nav-icon"></i>
              <p>Tuition Jobs</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="../settings/">
              <i class="fas fa-user-cog fa-fw nav-icon"></i>
              <p>Update Information</p>
            </a>
          </li>
        </ul>
      </div>
    </div> -->
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <!-- <a class="navbar-brand" href="javascript:;">Login  |  Create Account</a> -->
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>

        </div>
      </nav>
      <!-- End Navbar -->

			<!-- Modal Start -->
      <!-- Loading Modal -->
      <div class="row">
        <div class="modal fade" tabindex="-1" role="dialog" id="loadingModal" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered text-center" role="document">
            <div class="container-fluid">
              <div class="row d-flex">
                <span class="fa fa-spinner fa-spin fa-5x w-100" style="color: #fff ;"></span>
                <div class="col align-self-center">
                  <!-- <h5 class="modal-title" style="color: white;">Generating invoice in progress. </h5> -->
                  <!-- <h5 class="modal-title" style="color: white;"> Please do not close this window.</h5> -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sign-out modal -->
      <div class="row">
        <div class="modal fade" id="signOutModal" tabindex="-1" role="dialog" aria-labelledby="signOutModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="signOutLabel">Logging Out</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="signOutModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSignOutModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main content -->
      <div class="content">
        <div class="container-fluid">
          <!-- Main panel -->

          <div class="row">

            <div class="col-md-9 text-center" id="noInvFound" style="display: none; margin: 1rem auto 2rem 0;">
              <h3>Invoice Not Found</h3>
              <h4>Please check again with your school or teacher. </h4>
            </div>
            <div class="col-md-9 text-center">
              <a href="javascript:;" class="btn btn-outline-primary btn-round" onclick="generatePDFeKoopmans('invTemplate')" id="btnDownloadAsPDF" style="color: #fff; background-color: #2e74b6; text-transform: none; display: none; "> Download as PDF <i class="material-icons" style="color: #fff; margin-left: 0.5em; padding-bottom: 0.2em;">download</i></a>
              <a href="https://app.golearn.com.my/client/" class="btn btn-outline-primary btn-round" id="btnGoToProfile" style=" text-transform: none;"> Go to my profile <i class="material-icons" style="color: #2e74b6; margin-left: 0.5em; padding-bottom: 0.2em;">east</i></a>
            </div>
          </div>
          <!-- Preview -->
          <div class="row">
            <div class="col-md-9" style="overflow-x:auto; padding: 1rem;" >
              <page size="A4" id="invTemplate" style="position: relative;">

                <div class="card-body" >
                  <div class="row">
                    <div class="col-4 text-center">

                      <div class="form-group">
                        <!-- <canvas id="myCanvas" style="height: 150px;width: 225px; object-fit: cover;" ></canvas> -->
                        <div style="height: 115px;width: auto; display: inline-block; position: relative; overflow: hidden; cursor: pointer;">
                          <img id="previewTutorImgUrl" style="height: 100%; width: auto; " src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D" crossorigin="anonymous" alt = ""/>
                          <!-- <canvas id="myCanvas" ></canvas> -->
                        </div>
                      </div>
                    </div>

                    <div class="col-2">
                      <!--  Do nothing -->
                    </div>

                    <div class="col-6 text-right">
                      <h4 style="font-size: xx-large;margin-top: 1rem;">INVOICE</h4>
                      <h5 id="previewInvTitle"  style="font-weight: 500;"></h5>
                      <h4 id="previewInvBizName" style="font-weight: 500;">Your Name</h4>
                      <h6 id="previewInvBizDetails" style="text-transform: none; font-weight: 300;"></p>
                    </div>

                  </div>

                </div>

                <hr style="margin: 0rem">
                <!-- style="position: relative; bottom: 35px; width: 100%; margin-top: 2rem;" -->
                <div class="card-body" style="position: relative; bottom: 35px; width: 100%; margin-top: 2rem;">
                  <div class="row">
                    <div class="col-4">
                      <h6>Billed To:</h6>
                      <h4 id="previewInvClientName" style="font-weight: 500;"></h4>
                      <h6 id="previewInvClientDetails"  style="text-transform: none; font-weight: 300;"></h6>
                    </div>

                    <div class="col-4"></div>
                    <div class="col-4">
                      <div class="row">
                        <div class="col-6 text-right" style="padding-right: 0;">
                          <h6>Invoice No</h6>
                          <h6>Invoice Date</h6>
                          <h6 style="color: red;">Payment Due</h6>
                          <h6>Status</h6>

                          <!-- <p style="margin: 0.3rem; font-weight: bold;">Invoice No</p>
                          <p style="margin: 0.3rem; font-weight: bold;">Invoice Date</p>
                          <p style="margin: 0.3rem; font-weight: bold;">Payment Due</p>
                          <p style="margin: 0.3rem; font-weight: bold;">Status</p> -->
                        </div>
                        <div class="col-6 text-right">
                          <h6 id="previewInvNum" style="font-weight: normal; text-transform: none;"> - </h6>
                          <h6 id="previewInvIssueDate"style="font-weight: normal; text-transform: none;"> - </h6>
                          <h6 id="previewInvPaymentDue" style="color: red; font-weight: normal; text-transform: none;"> - </h6>
                          <h6 id="previewInvStatus" style="font-weight: normal; text-transform: none;"> New </h6>
                         </div>
                      </div>
                    </div>
                  </div>

                  <div style="margin-top: 1rem;"></div>

                  <div class="row">
                    <div class="col-12"  style="overflow-x:auto;">
                      <span class="" style="font-size: x-small; font-weight: 300; color: gray; margin-bottom: 0;">Note*: Quantity - Number of hour of lessons conducted, number of classes, or relevant other items</span>
                      <table id="tablePreview" class="table-light table-sm" cellspacing="0" width="100%" >
                        <thead style="background-color: grey; color: white;">
                          <tr>
                            <th style="min-width: 200px; font-size: small;">Items</th>
                            <th style="width: 100px; min-width: 100px;text-align: right; font-size: small;">Quantity</th>
                            <th style="width: 100px; min-width: 100px;text-align: right; font-size: small;">Price</th>
                            <th style="width: 100px; min-width: 100px;text-align: right; font-size: small;">Amount</th>
                          </tr>
                        </thead>
                        <tbody id="previewItemBody">

                          <!-- <tr class="item">
                            <td style="font-size: small;">Primary class</td>
                            <td style="text-align: right; font-size: small;">1</td>
                            <td style="text-align: right; font-size: small;">25</td>
                            <td style="text-align: right; font-size: small;">RM25.00</td>
                          </tr>
                          <tr class="item">
                            <td style="font-size: small;"> - Lesson 1</td>
                            <td style="text-align: right; font-size: small;">1</td>
                            <td style="text-align: right; font-size: small;">25</td>
                            <td style="text-align: right; font-size: small;">RM25.00</td>
                          </tr>

                          <tr class="subtotal" style="border-bottom: solid #eeeeee thin;">
                            <td></td>
                            <td></td>
                            <td style="text-align: right; font-weight: 500; font-size: small;">Subtotal</td>
                            <td style="text-align: right; font-weight: 500; font-size: small;" id="previewSubtotalItem">RM50.00</td>
                          </tr>
                          <tr class="item">
                            <td style="font-size: small;">Primary class</td>
                            <td style="text-align: right; font-size: small;">1</td>
                            <td style="text-align: right; font-size: small;">25</td>
                            <td style="text-align: right; font-size: small;">RM25.00</td>
                          </tr>
                          <tr class="subtotal" id='previewItemSubtotal' style="border-bottom: solid #eeeeee thin;">
                            <td></td>
                            <td></td>
                            <td style="text-align: right; font-weight: 500; font-size: small;">Subtotal</td>
                            <td style="text-align: right; font-weight: 500; font-size: small;" id="previewSubtotalItem">RM50.00</td>
                          </tr> -->
                        </tbody>
                      </table>

                      <table id="tableAdditionalItemPreview" class="table-light table-sm" cellspacing="0" width="100%">
                        <thead style="visibility: collapse;">
                          <tr>
                            <th style="min-width: 200px;">Items</th>
                            <th style="width: 100px; min-width: 100px;text-align: right;">Quantity</th>
                            <th style="width: 100px; min-width: 100px;text-align: right;">Price</th>
                            <th style="width: 100px; min-width: 100px;text-align: right;">Amount</th>
                          </tr>
                        </thead>
                        <tbody id="previewAdditionalItemBody">
                          <!-- <tr class="additional">
                            <td></td>
                            <td></td>
                            <td style="text-align: right; font-size: small;">Tax(20%)</td>
                            <td style="text-align: right; font-size: small;">RM203.00</td>
                          </tr> -->
                        </tbody>
                      </table>
                    </div>

                    <div class="col-12">
                      <h4 style="text-align: right; font-weight: 500;">Total <span style="margin-left: 2rem;" id="previewGrandTotal">RM0.00</span></h4>
                    </div>

                    <div class="col-12">
                      <!-- <p><strong>Solution with JS (only deals with line breaks): </strong> <textarea class="textarea resize-ta"></textarea></p> -->

                      <!-- <div class="form-group"> -->
                        <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin: 0;">Notes</span>
                        <span  id="previewInvNotes"></span>
                        <!-- <textarea class="form-control" maxlength="250" rows='3' oninput="console.log(this.scrollHeight); this.style.height = (this.scrollHeight) + 'px';// this.setAttribute('rows', 12)" style="height: 4300px; max-height: max-content; overflow: hidden;" id="previewInvNotes" data-compulsory="false" placeholder="Enter notes that are visible to your client. (e.g payment guidelines) " ></textarea> -->

                      <!-- </div> -->
                    </div>
                  </div>
                </div>

                <div class="card-body" id="preview-footer" style="padding-top: 0; margin-top: 0; position: absolute; bottom: 0; width: 100%;">
                  <p id="previewInvFooterNotes" ></p>
                </div>

              </page>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-9 text-center">
            <p>Powered by
              <span>
                <a href="https://golearn.com.my/" class="simple-text logo-mini">
                  <img src="../../assets/img/golearn-plain.svg" style="width: 108px; height: auto; " alt=""></img>
                </a>
              </span>
            </p>

          </div>
        </div>

        <footer class="footer">
          <div class="container-fluid">
            <nav class="float-left">
            <ul>
              <!-- <li>
              <a href="https://golearn.com.my/join-us" target="_blank">
                Visit GoLearn Tutor
              </a>
              </li> -->
            </ul>
            </nav>
          </div>
        </footer>
      </div>
    </div>

  </div>

  <script src="../../assets/js/core/jquery.min.js"></script>
  <script src="../../assets/js/core/popper.min.js"></script>
  <script src="../../assets/js/core/bootstrap-material-design.min.js"></script>
  <script src="../../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="../../assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../../assets/js/material-dashboard.js?v=2.1.2" type="text/javascript"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ"  crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>

  <!-- Common constants -->
  <script src="../../assets/js/common.js" type="text/javascript"></script>
  <!-- International Telephone Input -->
  <script src="../../assets/js/plugins/intlTelInput/intlTelInput.js"></script>

  <script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>

	<script>
    // Check URL
    var url_string = window.location.href;
    var url = new URL(url_string);

    const iid = url.searchParams.get("iid");


    // Check validity of URL params
    if (iid === "" || iid == null){
      console.log("Invalid invoice")
      invalidatePage();
    }
    else{
      loadInvoice(iid);
    }
    var allItemsArr = [];

    var invId, transId; // Global variable for selected invoice and transaction id

    // DOM const
    const btnDownloadAsPDF = document.getElementById("btnDownloadAsPDF");

    const tablePreview = document.getElementById('tablePreview');
    const tableAdditionalItemPreview = document.getElementById('tableAdditionalItemPreview');

		// var db = firebase.firestore();
		// db.settings({ timestampsInSnapshots: true });

    var batch = db.batch();
    var batchUpdate = db.batch();
    var batchUpdateNew = db.batch();
    // Check the current Invoice in session Storage - Valid only if user come from class.html
    var currentInvoiceObj = null;

    // Load invoice
    function loadInvoice(iid){
      let docRef = db.collection("Financial")
          .doc("v1")
          .collection("Invoice")
          .doc(iid);

      docRef
      .get()
      .then((doc) => {

        if (doc.exists){
          // console.log("Doc found")
          // console.log(doc.data())



          currentInvoiceObj = doc.data();

          getInvoiceObject(doc.data());


        }else{
          console.log("Doc not found")
          invalidatePage();
        }

      });

    }

    function getInvoiceObject(invData){

      // enable download
      // document.getElementById("btnDownloadAsPDF").removeAttribute("")
      $("#btnDownloadAsPDF").css("display", "");
      // document.getElementById("invTemplate").style.display = "none";


      // Check if there are valid class data in session storage.
      if (invData == null || invData == '' ){
        // Return to class.html if invalid class obj
        func.showNotification('top','center', 'danger', 'error_outline', "Error: No invoice selected." );
        // window.location.href='./';

      }else{
        // Set the fields
        // currentInvoiceObj = JSON.parse(sessionStorage.getItem(SESSION_STORAGE_INVOICE_CURRENT_DOC_KEY));
        currentInvoiceObj = invData;

        // console.log(currentInvoiceObj);
        invId = currentInvoiceObj[INV_ID]

        console.log(currentInvoiceObj)
        updatePageContent(currentInvoiceObj);

      }

    }


    function updatePageContent(invObj){

      // Preview
      let imgtxt = invObj[INV_SENDER_IMG_URL] == null || invObj[INV_SENDER_IMG_URL] == '' ?
      'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D' :
      'https://golearn.com.my/proxy.php?csurl='+invObj[INV_SENDER_IMG_URL];

      if (invObj[INV_SENDER_IMG_URL] == null || invObj[INV_SENDER_IMG_URL] == "" || invObj[INV_SENDER_IMG_URL] == "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D"){
        document.getElementById("previewTutorImgUrl").style.display = 'none';
        document.getElementById("previewTutorImgUrl").src = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";
      }
      else {
        // toDataURL(
        //   // https://murmuring-headland-66106.herokuapp.com/ is a proxy server
        //   invObj[INV_SENDER_IMG_URL] == null || invObj[INV_SENDER_IMG_URL] == '' ?  'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D' : 'https://murmuring-headland-66106.herokuapp.com/'+invObj[INV_SENDER_IMG_URL],
        //   function(dataUrl) {
        //     // console.log('RESULT:', dataUrl)
        //   },
        // );
        // NOTE: NEW
        toDataURLNew(
          imgtxt,
          function(dataUrl) {
            var imgTarget = document.getElementById("previewTutorImgUrl");
            imgTarget.src = dataUrl;
          },
          function(e) {
            var imgTarget = document.getElementById("previewTutorImgUrl");
            imgTarget.src = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D';
            console.log(e)
          }
        )

      }
      function toDataURLNew(url, callback, error) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function() {
          var reader = new FileReader();
          reader.onloadend = function() {
            callback(reader.result);
          }
          reader.readAsDataURL(xhr.response);
        };
        xhr.onerror= function(){
          error('Image loading error')
        };
        xhr.open('GET', url);
        xhr.responseType = 'blob';
        xhr.send();
      }
      document.getElementById("previewInvTitle").textContent = invObj[INV_TITLE];
      document.getElementById("previewInvTitle").textContent = invObj[INV_TITLE];

      document.getElementById("previewInvBizName").textContent = invObj[INV_SENDER_NAME];
      document.getElementById("previewInvBizDetails").innerHTML = invObj[INV_SENDER_DETAILS];
      document.getElementById("previewInvClientName").textContent = invObj[INV_RECEIVER_NAME];
      document.getElementById("previewInvClientDetails").innerHTML = invObj[INV_RECEIVER_DETAILS];

      document.getElementById("previewInvNum").textContent = invObj[INV_NUMBER];
      document.getElementById("previewInvIssueDate").textContent = new Date(invObj[INV_ISSUE_DATE].seconds*1000).toLocaleDateString("en-GB");
      document.getElementById("previewInvPaymentDue").textContent = new Date(invObj[INV_DUE_DATE].seconds*1000).toLocaleDateString("en-GB");
      // Status
      if (invObj[INV_INV_STATUS] === INV_STATUS_DRAFT){
        document.getElementById("previewInvStatus").textContent = 'Draft';
      }else if (invObj[INV_INV_STATUS] === INV_STATUS_NEW){
        document.getElementById("previewInvStatus").textContent = 'Unpaid';
      }else if (invObj[INV_INV_STATUS] === INV_STATUS_PAID){
        document.getElementById("previewInvStatus").textContent = 'Paid';
      }

      document.getElementById("previewInvNotes").innerHTML = invObj[INV_NOTES];
      document.getElementById("previewInvFooterNotes").innerHTML = invObj[INV_FOOTER_NOTES];

      // Print items
      printPreview(invObj[INV_ITEMS_ARR]);

      // // Generate Predefined message
      // let line1 = "Hi, "+ invObj[INV_RECEIVER_NAME]+ " ";
      // let line2 = "Here's the invoice for the tuition fee this month. Click on the link below to view. You are welcome to download a copy as your reference. ";
      // let line3 = "https://api.golearn.com.my/c/f/view?iid="+invObj[INV_ID]+ " ";
      // let line4 = "Thank you! ";
      // let finalline=line1 + line2 + line3 + line4
      // document.getElementById("inPredefinedMessage").innerHTML = finalline ;

    }


    // Get Data Url using proxy server
    function toDataURL(src, callback, outputFormat) {
      var img = new Image();
      // var img = document.getElementById("tutorImgUrl");
      var dataURL;
      img.crossOrigin = 'Anonymous';
      img.src = src;
      img.onload = function() {
        var canvas = document.createElement('CANVAS');
        var ctx = canvas.getContext('2d');

        canvas.height = this.naturalHeight;
        canvas.width = this.naturalWidth;
        ctx.drawImage(this, 0, 0);
        dataURL = canvas.toDataURL(outputFormat);
        // img.src = dataURL;
        // console.log(dataURL)
        var imgTarget = document.getElementById("previewTutorImgUrl");
        imgTarget.src = dataURL;
        callback(dataURL);
      };
      // img.src = src;
      // img.src = dataURL;
      if (img.complete || img.complete === undefined) {
        img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
        img.src = src;
      }
    }

    // // Tutor Specific
    function printItem(desc, quantity, price, amount){
      // <tr class="item">
      //   <td style="font-size: small;"></td>
      //   <td style="text-align: right; font-size: small;"></td>
      //   <td style="text-align: right; font-size: small;"></td>
      //   <td style="text-align: right; font-size: small;"></td>
      // </tr>

      let td1 = document.createElement('td');
      td1.setAttribute('style', "font-size: small;");
      td1.textContent = desc

      let td2 = document.createElement('td');
      td2.setAttribute('style', "text-align: right; font-size: small;");
      td2.textContent = quantity

      let td3 = document.createElement('td');
      td3.setAttribute('style', "text-align: right; font-size: small;");
      td3.textContent = price

      let td4 = document.createElement('td');
      td4.setAttribute('style', "text-align: right; font-size: small;");
      td4.textContent = amount

      // Tr top
      let tr = document.createElement('tr');
      tr.className = 'item';
      tr.appendChild(td1);
      tr.appendChild(td2);
      tr.appendChild(td3);
      tr.appendChild(td4);

      const previewItemBody = document.getElementById('previewItemBody');
      const previewItemSubtotal = document.getElementById('previewItemSubtotal');
      previewItemBody.insertBefore(tr, previewItemSubtotal)
      // previewItemBody.insertBefore('#previewItemBody tr:nth-last-child(2)')
      // $( "#previewItemBody tr:nth-last-child(2)" ).append(tr);

      // previewItemBody.appendChild(tr);
    }


    function printAdditionalItem(additionalItem, amount){
    // <tr class="additional">
    //   <td></td>
    //   <td></td>
    //   <td style="text-align: right; font-size: small;"></td>
    //   <td style="text-align: right; font-size: small;"></td>
    // </tr>

      let td1 = document.createElement('td');
      let td2 = document.createElement('td');
      let td3 = document.createElement('td');
      td3.setAttribute('style', "text-align: right; font-size: small;");
      td3.textContent = additionalItem

      let td4 = document.createElement('td');
      td4.setAttribute('style', "text-align: right; font-size: small;");
      td4.textContent = amount

      // Tr top
      let tr = document.createElement('tr');
      tr.className = 'additional';
      tr.appendChild(td1);
      tr.appendChild(td2);
      tr.appendChild(td3);
      tr.appendChild(td4);

      const previewAdditionalItemBody = document.getElementById('previewAdditionalItemBody');
      // const previewItemSubtotal = document.getElementById('previewItemSubtotal');
      previewAdditionalItemBody.appendChild(tr);
    }

    // Print Subtotal
    function printItemSubtotal(amount){
      // <td></td>
      // <td></td>
      // <td style="text-align: right; font-weight: 500; font-size: small;">Subtotal</td>
      // <td style="text-align: right; font-weight: 500; font-size: small;" id="previewSubtotalItem">RM50.00</td>

      let td1 = document.createElement('td');

      let td2 = document.createElement('td');

      let td3 = document.createElement('td');
      td3.setAttribute('style', "text-align: right; font-weight: 500; font-size: small;");
      td3.textContent = 'Subtotal'

      let td4 = document.createElement('td');
      td4.setAttribute('style', "text-align: right; font-weight: 500; font-size: small;");
      let amountText = (amount >= 0) ? 'RM'+amount.toFixed(2) : '- RM'+ Math.abs(amount).toFixed(2)
      td4.textContent = amountText;

      // Tr top
      let tr = document.createElement('tr');
      tr.className = 'subtotal';
      tr.setAttribute("style", "border-bottom: solid #eeeeee thin;");
      tr.appendChild(td1);
      tr.appendChild(td2);
      tr.appendChild(td3);
      tr.appendChild(td4);

      const previewItemBody = document.getElementById('previewItemBody');
      previewItemBody.appendChild(tr);
    }



    // Print Preview
    function printPreview(invData){

      // init the preview template size
      document.getElementById('invTemplate').style.height = 'auto';

      // clear all spaces details in preview
      // let totalPreviewItem = tablePreview.querySelectorAll('.item').length;
      // console.log('totalPreviewItem ' + totalPreviewItem);
      tablePreview.querySelectorAll('.item').forEach(function (row, index) {
        row.remove();
      });

      tablePreview.querySelectorAll('.subtotal').forEach(function (row, index) {
        row.remove();
      });

      // let totalAdditionalItemPreview = tableAdditionalItemPreview.querySelectorAll('.additional').length;
      // console.log('totalPreviewItem ' + totalPreviewItem);
      tableAdditionalItemPreview.querySelectorAll('.additional').forEach(function (row, index) {
        row.remove();
      });

      // document.getElementById('previewSubtotalItem').textContent='';
      document.getElementById('previewGrandTotal').textContent='';


      // Get the inv data
      // let invData = getAllItems2();
      console.log('invData')
      console.log(invData)


      // Step 2: Print Items & Additional Items
      let itemStartIndex= invData.indexOf('ITEMLIST');
      let itemIndex= invData.indexOf('ITEM');
      let additionalItemStartIndex= invData.indexOf('ADDITIONAL_ITEM');
      let totalStartIndex= invData.indexOf('TOTAL');

      // console.log(itemStartIndex, additionalItemStartIndex, subtotalStartIndex, totalStartIndex)

      // let type = payslipDataArr[0];
      let itemList = invData.slice(itemStartIndex+1, additionalItemStartIndex); //+1 to ignore the first indentifier, ITEMLIST
      // let subTotal = payslipDataArr[subtotalStartIndex+1];
      let additionalItem = invData.slice(additionalItemStartIndex+1, totalStartIndex); //+1 to ignore the first indentifier
      let total = invData[totalStartIndex+1];

      var itemIndexArr = [];
      itemList.filter(function(item, index) {
      if(item === 'ITEM'){
        itemIndexArr.push(index)
      }
      });
      // console.log(itemIndexArr)



      // console.log(itemList)
      // console.log(itemIndex)
      console.log(additionalItem)
      // console.log(total)

      // Loop through each 'ITEM' index
      itemIndexArr.forEach((item, index) => {
        // Get the printable row. Skip the unused rows.
        // +1 is the header identifier, 'ITEM'
        // +4 is the name, refId, cat and tag rows
        let itemSingleList = itemList.slice(item + 1 + 4, itemIndexArr[index+1]);
        // console.log(itemSingleList);

        let subtotalItem = 0;
        let component = [];
        itemSingleList.forEach((item, index) => {

          component = item.split(";; ")
          printItem(component[0], component[1], component[2], component[3]);

          subtotalItem = isNaN(component[1] * component[2]) ? subtotalItem+ 0 : subtotalItem + component[1] * component[2];

        });

        printItemSubtotal(subtotalItem);

      })

      // Print Items
      // Print Additional Items
      additionalItem.forEach((item) => {
        console.log(item)
        let component = item.split(";; ")

        let additionalSelector = component[0];
        let additionalItem = component[1];
        let additionalItemValue = component[2];
        let amount = component[3];

        if (additionalSelector === 'Select one'){
          // Do nothing
        }
        else if (additionalSelector === 'Discount ( - )'){
          console.log(additionalItem, amount);
          printAdditionalItem(additionalItem, amount);
        }
        else if (additionalSelector === 'Tax Rate (%)'){
          console.log(additionalItem+' ('+additionalItemValue +'%)', amount);
          printAdditionalItem(additionalItem+' ('+additionalItemValue +'%)', amount);
        }
        else
        {
          // Do nothing
        }
      });

      // Print Total
      let totalText = '';
      if (isNaN(total) ){
        totalText = 'INVALID';
        // console.log(totalText)
        document.getElementById('previewGrandTotal').textContent = totalText;
      }else {
        totalText = (total >= 0) ? 'RM'+total.toFixed(2) : '- RM'+ Math.abs(total).toFixed(2)
        // console.log(totalText)
        document.getElementById("previewGrandTotal").textContent = totalText;
      }

      // document.getElementById('previewSubtotalItem').textContent = document.getElementById('subtotalItem').textContent;
      // document.getElementById('previewGrandTotal').textContent = document.getElementById('grandTotal').textContent;

      let bounderies = document.getElementById('invTemplate').getBoundingClientRect();
      // console.log('item dim (h x w): '+ bounderies.height, bounderies.width );

      let width = document.getElementById('invTemplate').offsetWidth;
      let height = document.getElementById('invTemplate').offsetHeight;
      // console.log('item dim in cm (h x w): '+ height*0.02645833, width*0.02645833 );

      if ( height*0.02645833 >= 29.7 && height*0.02645833 < 59.4){
        document.getElementById('invTemplate').style.height = '59.35cm'; // Slightly smaller than 59.4 - 2page
      }
      else if ( height*0.02645833 >= 59.4 && height*0.02645833 < 89.1){
        document.getElementById('invTemplate').style.height = '89.05cm';
      }
      else if ( height*0.02645833 >= 89.1 && height*0.02645833 < 118.8){
        document.getElementById('invTemplate').style.height = '118.75cm';
      }
      else if ( height*0.02645833 >= 118.8 && height*0.02645833 < 148.5){
        document.getElementById('invTemplate').style.height = '148.45cm';
      }
      else{
        // document.getElementById('invTemplate').style.height = 'auto';
      }


    }

    // Generate PDF
    // https://ekoopmans.github.io/html2pdf.js/
    function generatePDFeKoopmans(id){

      element = document.getElementById(id);

      var opt = {
        margin:       [0, 0, 0, 0],
        filename:     'invoice.pdf',
        pagebreak:    { before: '.beforeClass', after: ['#after1', '#after2'], avoid: 'img' },
        image:        { type: 'jpeg', quality: 0.95 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };

      html2pdf().set(opt).from(element).save();
    }

    function reload(){
      var invdocRef = db.collection("Financial")
        .doc("v1")
        .collection("Invoice")
        .doc(invId);

      invdocRef
      .get()
      .then((doc) => {
        // Hide loading modal
        $('#loadingModal').modal('hide');

        if (doc.exists) {
          // console.log(doc.data())
          sessionStorage.setItem(SESSION_STORAGE_INVOICE_CURRENT_DOC_KEY, JSON.stringify(doc.data()));
          currentInvoiceObj = JSON.parse(sessionStorage.getItem(SESSION_STORAGE_INVOICE_CURRENT_DOC_KEY));
          updatePageContent(currentInvoiceObj)

        }
        else {
          console.log("No such document!");
        }
      })
      .catch((error) => {
        console.log("Error getting document:", error);
      });


      var transDocRef = db.collection("Financial")
        .doc("v1")
        .collection("Transaction")
        .doc(transId);

      transDocRef
      .get()
      .then((doc) => {

        if (doc.exists) {
          // console.log(doc.data())
          sessionStorage.setItem(SESSION_STORAGE_TRANSACTION_CURRENT_DOC_KEY, JSON.stringify(doc.data()));

        }
        else {
          console.log("No such document!");
        }
      })
      .catch((error) => {
        console.log("Error getting document:", error);
      });

  }


    // Get json arrays of report items
    function getReportList2(allItemsArr){

      // Get the 'Revenue' array of json
      // [
      //   { "name": "<className1> / tagname1" , "refId": "<classId1> / uncategorized"   , "type": "cat / tag / org"   , "total": 100 },
      //   { "name": "Std 6 Math"    , "refId": "pdiejsawafasw"   , "type": "cat"   , "total": 300 },
      //   { "name": "Uncategorized" , "refId": "uncategorized"   , "type": "cat"   , "total": 300 },
      //   { "name": "Tax"           , "refId": "tax"             , "type": "cat"   , "total": 20.352s },
      //   { "name": "Others"        , "refId": "other"           , "type": "cat"   , "total": 100 },

      //   { "name": "selangor"      , "refId": ""                , "type": "tag"   , "total": 300 },
      //   { "name": "bm"            , "refId": ""                , "type": "tag"   , "total": 320 },
      //   ...
      // ]


      // Items & Additional Items
      let itemStartIndex= allItemsArr.indexOf('ITEMLIST');
      // let itemIndex= allItemsArr.indexOf('ITEM');
      let additionalItemStartIndex= allItemsArr.indexOf('ADDITIONAL_ITEM');
      let totalStartIndex= allItemsArr.indexOf('TOTAL');

      // console.log(itemStartIndex, additionalItemStartIndex, subtotalStartIndex, totalStartIndex)

      // let type = payslipDataArr[0];
      let itemList = allItemsArr.slice(itemStartIndex+1, additionalItemStartIndex); //+1 to ignore the first indentifier, ITEMLIST
      // let subTotal = payslipDataArr[subtotalStartIndex+1];
      let additionalItem = allItemsArr.slice(additionalItemStartIndex+1, totalStartIndex); //+1 to ignore the first indentifier
      let total = allItemsArr[totalStartIndex+1];

      var itemIndexArr = [];
      itemList.filter(function(item, index) {
      if(item === 'ITEM'){
        itemIndexArr.push(index)
      }
      });
      // console.log(itemIndexArr)
      // console.log(itemList)
      // console.log(itemIndex)
      // console.log(additionalItem)
      // console.log(total)

      let ReportList = [];

      // let title = tableItem.querySelectorAll("span[class=table-title]")[0].textContent;

      let subTotal = 0; // Used to get the subtotal.
      // Loop through each 'ITEM' index
      itemIndexArr.forEach((item, index) =>
      {
        // Calculate the subtotal of each item.
        // Get the printable row. Skip the unused rows.
        // +1 is the header identifier, 'ITEM'
        // +3 is the refId, cat and tag rows
        let itemSingleList = itemList.slice(item + 1 + 4, itemIndexArr[index+1]);
        // console.log(itemSingleList);

        let subtotalItem = 0;
        let component = [];
        itemSingleList.forEach((item, index) => {

          component = item.split(";; ")
          subtotalItem = isNaN(component[1] * component[2]) ? subtotalItem+ 0 : subtotalItem + component[1] * component[2];

        });

        // Get the refId, tag and cat
        let className = itemList.slice(item + 1, item + 2)[0];
        let refId = itemList.slice(item + 2, item + 3)[0];
        let cat = itemList.slice(item + 3, item + 4)[0];
        let tag_temp = itemList.slice(item + 4, item + 5)[0];
        console.log(className, refId, cat, tag_temp)
        // let tag = (tag_temp == null || tag_temp == "") ? "" : tag_temp;
        let tagArray = (tag_temp == null || tag_temp == "") ? [] : tag_temp.split(",");

        let itemCatJson = {};
        if (refId === 'uncategorized') // New item
        itemCatJson = {
            "name": className, //"Uncategorized",
            "refId": refId,
            "type": "cat",
            "total": subtotalItem
          };
        else if (refId != 'tax' && refId != 'other')
          itemCatJson = {
            "name": className,
            "refId": refId,
            "type": "cat",
            "total": subtotalItem
          };
        else{
          // Not suppose to have tax or other category here. They will be done later
          // Do nothing
        }

        ReportList.push(itemCatJson);

        let itemTagJson = {};
        if (tagArray.length >= 1){
          tagArray.forEach((item) => {
            itemTagJson = {
              "name": item,
              "refId": item,
              "type": "tag",
              "total": subtotalItem
            };
            ReportList.push(itemTagJson)

          });
        }
        else {
          // No tag found.
        }

        subTotal = subTotal + subtotalItem;

      });

      // console.log(ReportList);

      // Get Additional Items
      let addItemOtherTotal = 0;
      let addItemTaxTotal = 0;

      let temp_amount = 0;
      let totalText = '';

      additionalItem.forEach((item) => {
        console.log("")
        console.log(item)
        console.log("")
        let component = item.split(";; ")

        let additionalSelector = component[0];
        let additionalItem = component[1];
        let additionalItemValue = parseFloat(component[2]);
        let amount = component[3];

        if (additionalSelector === 'Select one'){
          // Do nothing
          temp_amount = 0;
          subTotal = subTotal;
        }
        else if (additionalSelector === 'Discount ( - )'){
          // console.log(additionalItem, amount);
          temp_amount = -additionalItemValue;

          addItemOtherTotal = isNaN(temp_amount) ? addItemOtherTotal + 0 : addItemOtherTotal + temp_amount;

          subTotal = subTotal - additionalItemValue;

        }
        else if (additionalSelector === 'Tax Rate (%)'){
          // console.log(additionalItem+' ('+additionalItemValue +'%)', amount);
          temp_amount = subTotal * (additionalItemValue) / 100;
          console.log("Tax Rate (%):");
          console.log("temp_amount: "+ temp_amount);
          addItemTaxTotal = isNaN(temp_amount) ? addItemTaxTotal + 0 : addItemTaxTotal + temp_amount;
          console.log("addItemTaxTotal: "+ addItemTaxTotal);
          subTotal = subTotal * (100 + additionalItemValue) / 100;
          console.log("subTotal after Tax: "+ subTotal);
        }
        else
        {
          // Do nothing
          temp_amount = 0;
          subTotal = subTotal;
        }

        console.log("subTotal: "+ subTotal);
      });

      let addItemOtherJson = {
        "name": 'Others',
        "refId": 'other',
        "type": "cat",
        "total": addItemOtherTotal
      };
      ReportList.push(addItemOtherJson)

      let addItemTaxJson = {
        "name": 'Tax',
        "refId": 'tax',
        "type": "cat",
        "total": addItemTaxTotal
      };
      ReportList.push(addItemTaxJson)


      console.log(ReportList);

      // Ref: https://www.codegrepper.com/code-examples/javascript/pick+the+duplicate+objects+from+json+array+javascript
      var ids = [];
      var clean = [];

      $.each(ReportList, function(index, value) {
          if($.inArray(value.refId, ids) == -1)
          {
            ids.push(value.refId);
            clean.push(value);
          }else{
            let idIndex = ids.indexOf(value.refId);
            clean[idIndex].total = clean[idIndex].total + value.total;

            // ids.push(value.id);
            // clean.push(value);
          }
      });

      console.log(ids)
      console.log(clean)

      return clean;
    }


    // Invalidate Page
    function invalidatePage(){

      // document.getElementById("noInvFound").style.display = "none";
      $("#noInvFound").css("display", "");
      document.getElementById("btnDownloadAsPDF").style.display = "none";
      document.getElementById("invTemplate").style.display = "none";

    }


  </script>

  <script>
		$( document ).ready(function() {
      // Active Register Class Modal
      $('#loadingModal').modal({
        backdrop:'static',
        keyboard:false
      });
      // $('#loadingModal').modal('show');


		});

  </script>


</body>

</html>