<!doctype html>
<html lang="en">

<head>
  <!-- Meta -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>GoLearn School</title>
  <meta name=description content="GoLearn School&trade; is Malaysia #1 teaching platform to run your tuition business and manage your lessons. Start now for Free!">
  <meta property=og:title content="GoLearn School">
  <meta property=og:site_name content="GoLearn School">
  <meta property=og:type content=website>
  <meta property=og:url content=https://org.golearn.com.my/school/class/edit-class.html>
  <meta property=og:image content=https://org.golearn.com.my/assets/img/icon-apple-touch-180x180.png>
  <meta property=og:description content="GoLearn School&trade; is Malaysia #1 teaching platform to run your tuition business and manage your lessons. Start now for Free!">
  <link rel=apple-touch-icon sizes=180x180 href=https://org.golearn.com.my/assets/img/icon-apple-touch-180x180.png>
  <link rel=icon type=image/png sizes=32x32 href=https://org.golearn.com.my/assets/img/icon-32x32.png>
  <link rel=icon type=image/png sizes=16x16 href=https://org.golearn.com.my/assets/img/icon-16x16.png>
  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <script src="https://kit.fontawesome.com/2bdd669e92.js" crossorigin="anonymous"></script>
  <!-- Material Kit CSS -->
  <link href="../../assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet" />
  <link href="../../assets/css/tutor-portal.css" rel="stylesheet" />
  <!--GL Org CSS -->
  <link href="../../assets/css/golearn-org.css" rel="stylesheet" />
  <!-- Firebase Init -->
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-firestore.js"></script>
  <script src="../../assets/js/firebase.js"></script>
  <script>
    const orgUrl = new URL(window.location.href).searchParams.get("url");
    const orgEnt = new URL(window.location.href).searchParams.get("ent");
    if (orgUrl === null || orgUrl === "" || orgEnt === null || orgEnt === "")
      window.location.href = 'http://org.golearn.com.my/';
  </script>
  <link href="../../assets/css/multistepform.css" rel="stylesheet" />
  <link href="../../assets/css/multitabform.css" rel="stylesheet" />
  <link href="../../assets/css/mc-calendar.min.css" rel="stylesheet"/>
  <link href="../../assets/css/star-rating.css" media="all" rel="stylesheet" type="text/css"/>
  <!-- ClockPicker Stylesheet -->
  <link href="../../assets/css/bootstrap-clockpicker.min.css" rel="stylesheet" type="text/css">
  <!-- Tag input -->
  <link href="../../assets/css/tagsinput.css" rel="stylesheet" type="text/css">
  <!-- Color Picker -->
  <link href="../../assets/css/coloris.min.css" rel="stylesheet" type="text/css">
  <!-- Ribbon -->
  <style>
    .full .clr-field button {
      width: 100%;
      height: 100%;
      border-radius: 5px;
    }
  </style>
  <!-- Ribbon -->
  <!-- https://freefrontend.com/css-ribbons/ -->
  <style>
    .ribbon {
      font-size: small;
      position: absolute;
      /* right: var(--right, 10px); */
      /* top: var(--top, -3px); */
      left: var(--left, -3px);
      top: var(--top, 5px);
      filter: drop-shadow(2px 3px 2px rgba(0, 0, 0, 0.2));
    }
    .ribbon > .content {
      color: white;
      font-size: 1rem;
      text-align: center;
      font-weight: 400;
      /* background: var(--color, #FA8072) linear-gradient(45deg, rgba(0, 0, 0, 0) 0%, rgba(255, 255, 255, 0.25) 100%); */
      background:  rgba(0, 0, 0, 0.2);
      padding: 8px 2px 4px;
      clip-path: polygon(0 0, 100% 0, 100% 100%, 50% 100%, 0 100%);
      width: var(--width, 32px);
      min-height: var(--height, 32px);
      transition: clip-path 1s, padding 1s, background 1s;
    }
    .ribbon.slant-up > .content {
      clip-path: polygon(0 0, 100% 0, 100% calc(100% - 12px), 50% calc(100% - 6px), 0 100%);
    }
    .ribbon.slant-down > .content {
      clip-path: polygon(0 0, 100% 0, 100% 100%, 50% calc(100% - 6px), 0 calc(100% - 12px));
    }
    /* .ribbon.down > .content {
      clip-path: polygon(0 0, 100% 0, 100% calc(100% - 8px), 50% 100%, 0 calc(100% - 8px));
    } */
    .ribbon.up > .content {
      clip-path: polygon(0 0, 100% 0, 100% 100%, 50% calc(100% - 8px), 0 100%);
    }
    .ribbon.check > .content {
      clip-path: polygon(0 0, 100% 0, 100% calc(100% - 20px), 40% 100%, 0 calc(100% - 12px));
    }
    .ribbon.down > .content {
      /* clip-path: polygon(0 0, 100% 0, 100% calc(100% - 8px), 50% 100%, 0 calc(100% - 8px)); */
      clip-path: polygon(0% 0%, 75% 0%, 100% 50%, 75% 100%, 0% 100%)
    }

  </style>
</head>

<body>

  <div class="hidden" name="lockscreen" style="height:100vh; width:100vw;  background: white; position: absolute; z-index: 1050;">
    <div class="container" style="background: transparent; height: 100vh; display: flex; vertical-align: middle; align-items: center; justify-content: center;">
      <div class="row align-items-center">
        <div class="col-md-6 text-center">
          <h2>Cannot reach!</h2>
          <p>This account is temporarily disabled. Please contact our <a href="https://golearn.com.my/contact-us">support</a> for more details. </p>
          <a href="https://org.golearn.com.my" class="btn btn-outline-primary btn-round"><i class="material-icons" style="color: #2e74b6; margin-right: 0.5em; padding-bottom: 0.2em;">west</i> Back to Home</a>
        </div>
        <div class="col-md-6 mr-auto" style="height: 400px; width: fit-content;">
          <a href="javascript:;" >
            <img class="img" id="tutorImgUrl3" style="height: 100%; width:100%; object-fit: cover; pointer-events: none; " src="https://org.golearn.com.my/assets/img/maintenance.gif"/>
          </a>
        </div>
      </div>
    </div>
  </div>
  <div class="wrapper">
    <div class="sidebar" data-color="purple" data-background-color="white" data-image="../../assets/img/sidebar-3.jpg">
      <div class="logo">
        <a href="../" class="simple-text logo-mini" style="padding: 0.5rem" id="logoName" name="param-link">
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav" style="margin-bottom: 50px;">
          <li class="nav-item" perm="home">
            <a class="nav-link" href="../" name="param-link">
              <i class="far fa-chart-bar fa-fw nav-icon"></i>
              <p>Dashboard</p>
            </a>
          </li>
          <li class="nav-item hidden" perm="insight">
            <a class="nav-link" href="../report/" name="param-link">
              <i class="far fa-lightbulb fa-fw nav-icon"></i>
              <p>Insight</p>
            </a>
          </li>
          <li class="nav-item hidden" perm="teach">
            <h4 class="nav-link" style="margin-left: 1rem;">Teaching</h4>
          </li>
          <li class="nav-item hidden active" perm="teach-class">
            <a class="nav-link" href="../class/" name="param-link">
              <i class="fas fa-chalkboard fa-fw nav-icon"></i>
              <p>Classes</p>
            </a>
          </li>
		  		<li class="nav-item hidden" perm="teach-student">
            <a class="nav-link" href="../student/" name="param-link">
              <i class="fas fa-user-graduate fa-fw nav-icon"></i>
              <p>Students</p>
            </a>
          </li>
          <li class="nav-item hidden" perm="teach-teacher">
            <a class="nav-link" href="../teacher/" name="param-link">
              <i class="fas fa-chalkboard-teacher fa-fw nav-icon"></i>
              <p>Teachers</p>
            </a>
          </li>
          <li class="nav-item hidden" perm="fin">
            <h4 class="nav-link" style="margin-left: 1rem;">Financial</h4>
          </li>
          <li class="nav-item hidden" perm="fin-invoice">
            <a class="nav-link" href="../invoice/" name="param-link">
              <i class="fas fa-file-invoice-dollar fa-fw nav-icon"></i>
              <p>Invoices</p>
            </a>
          </li>
          <li class="nav-item hidden" perm="fin-payroll">
            <a class="nav-link" href="../payroll/" name="param-link">
              <i class="fas fa-hand-holding-usd fa-fw nav-icon"></i>
              <p>Payroll <span style="visibility: hidden;">PRO</span></p>
            </a>
          </li>
          <li class="nav-item hidden" perm="fin-transaction">
            <a class="nav-link" href="../transaction/" name="param-link">
              <i class="fas fa-exchange-alt fa-fw nav-icon"></i>
              <p>Transactions</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid">

          <!-- navbar-wrapper had to be disabled to prevent overflow -->
          <!-- <div class="navbar-wrapper"> -->
            <a class="navbar-brand" href="javascript:;" style="white-space: nowrap!important; overflow: hidden!important; text-overflow: ellipsis!important; display: block!important;">Classes <span><i class="material-icons" style="color: gray;">chevron_right</i></span> <span id="titleClassName"></span></a>
          <!-- </div> -->

          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end">
            <form class="navbar-form">
              <!-- Put empty placeholder here -->
            </form>

            <ul class="navbar-nav">
              <li class="nav-item" id="activationNavItem">
                <a href="#" class="btn btn-primary btn-round btn-sm" style="visibility: hidden;" id="btnActivateAccount"></a>
              </li>
              <li class="nav-item">
                <a class="navbar-brand" href="javascript:;">
                   Hi <span id="user"></span> !
                </a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownNotification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i> Notifications
                </a>
                <!-- <a class="nav-link" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i>
                  <span class="notification">5</span>
                  <p class="d-lg-none d-md-block">
                    Some Actions
                  </p>
                </a> -->
								<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
									<p style="padding: 1em;" >No notification</p>
                  <!-- <a class="dropdown-item" href="#">Mike John responded to your email</a>
                  <a class="dropdown-item" href="#">You have 5 new tasks</a>
                  <a class="dropdown-item" href="#">You're now friend with Andrew</a>
                  <a class="dropdown-item" href="#">Another Notification</a>
                  <a class="dropdown-item" href="#">Another One</a> -->
                </div>
              </li>
              <!-- your navbar here -->

			  			<li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">person</i>
                  <p class="d-lg-none d-md-block">
                    Account
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
                  <a class="dropdown-item hidden" href="../settings/" name="param-link" perm="settings">Update Information</a>
                  <a class="dropdown-item hidden" href="../team/" name="param-link" perm="team">Team</a>
									<div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="../../">Back to Home</a>
                  <a class="dropdown-item" href="javascript:;" data-toggle="modal" data-target="#signOutModal" onclick="signOutFunction()" id="btn-logout">Log out</a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->

			<!-- Modal Start -->

      <!-- Add Lesson Modal -->
      <div class="row">
        <div class="modal fade" id="addLessonModal" tabindex="-1" role="dialog" aria-labelledby="addLessonModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addLessonModalLabel">Add Lesson</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray;">Date</span>
                      <div class="input-group" data-placement="bottom" data-align="top" data-autoclose="true" style="margin-top: 0.3rem;">
                        <input id="datepicker" class="form-control" type="text" data-compulsory="true" oninput="this.className = 'form-control'" style="cursor:pointer;" readonly>
                        <!-- <span class="d-flex align-items-center input-group-addon">
                          <i class="fas fa-calendar-alt fa-fw" id="datepicker_btn"></i>
                        </span>  -->
                      </div>

                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="form-group"  >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray;">Start Time</span>
                      <div class="input-group clockpicker" data-placement="bottom" data-align="top" data-autoclose="true" style="margin-top: 0.3rem;">
                        <input id="addLessonStart" type="text" class="form-control" data-compulsory="true" oninput="this.className = 'form-control'" style="cursor:pointer;" readonly>
                        <!-- <span class="d-flex align-items-center input-group-addon" >
                          <span class="material-icons">
                            more_time
                          </span>
                        </span> -->
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">End Time</span>
                      <div class="input-group clockpicker" data-placement="bottom" data-align="top" data-autoclose="true" style="margin-top: 0.3rem;">
                        <input id="addLessonEnd" type="text" class="form-control" data-compulsory="true" oninput="this.className = 'form-control'" style="cursor:pointer;" readonly>
                        <!-- <span class="d-flex align-items-center input-group-addon">
                          <span class="material-icons">
                            more_time
                          </span>
                        </span> -->
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-group" >
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Lesson Description</span>
                  <textarea class="form-control" maxlength="255" rows="3" id="addLessonDesc" placeholder="Write something ..."></textarea>
                </div>


                <div class="form-group" style="display: none;" >
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Feedback</span>
                  <textarea class="form-control" maxlength="255" rows="3" id="addLessonFeedback" placeholder="Write something ..." readonly></textarea>
                </div>


                <div class="form-group"  style="display: none;" >
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Lesson Performance</span>
                  <input id="addLessonRate" type="text" class="rating" data-theme="krajee-fas" data-min=0 data-max=5 data-step=1 data-size="lg" required title="" readonly>
                </div>

                <div class="clearfix"></div>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnAddLessonModalUpdate" disabled>Add</button>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- Edit Lesson Modal -->
      <div class="row">
        <div class="modal fade" id="editLessonModal" tabindex="-1" role="dialog" aria-labelledby="editLessonModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editLessonModalLabel">Edit Lesson</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div id="editLessonId" value=""></div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray;">Date</span>
                      <div class="input-group" data-placement="bottom" data-align="top" data-autoclose="true" style="margin-top: 0.3rem;">
                        <input id="editLessonDatepicker" class="form-control" type="text" data-compulsory="true" oninput="this.className = 'form-control'" style="cursor:pointer;" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group"  >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray;">Start Time</span>
                      <div class="input-group clockpicker" data-placement="bottom" data-align="top" data-autoclose="true" style="margin-top: 0.3rem;">
                        <input id="editLessonStart" type="text" class="form-control" data-compulsory="true" oninput="this.className = 'form-control'" style="cursor:pointer;" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">End Time</span>
                      <div class="input-group clockpicker" data-placement="bottom" data-align="top" data-autoclose="true" style="margin-top: 0.3rem;">
                        <input id="editLessonEnd" type="text" class="form-control" data-compulsory="true" oninput="this.className = 'form-control'" style="cursor:pointer;" readonly>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-group" >
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Lesson Description</span>
                  <textarea class="form-control" maxlength="255" rows="3" id="editLessonDesc" placeholder="Write something ..."></textarea>
                </div>
                <div class="form-group" >
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Feedback</span>
                  <textarea class="form-control" maxlength="255" rows="3" id="editLessonFeedback" placeholder="Write something ..."></textarea>
                </div>
                <div class="form-group" >
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Lesson Performance</span>
                  <input id="editLessonRate" type="text" class="rating" data-theme="krajee-fas" data-min=0 data-max=5 data-step=1 data-size="lg" required title="">
                </div>
                <div class="clearfix"></div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary hidden" data-dismiss="modal" id="btnEditLessonModalUpdate" perm='teach-lesson-edit'>Update</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Remove Lesson modal -->
      <div class="row">
        <div class="modal fade" id="delLessonModal" tabindex="-1" role="dialog" aria-labelledby="delLessonModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="delLessonLabel">Delete This Lesson</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnDelLessonModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="delLessonModalBody">
                <div id="deleteLessonId" value=""></div>
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnDelLessonModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnDelLessonModalUpdate" perm="teach-lesson-del" >Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- List / Load Admin's Students Modal -->
      <div class="row">
        <div class="modal fade" id="addStudentModal" tabindex="-1" role="dialog" aria-labelledby="addStudentModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addStudentModalLabel">Add Student</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-12" id="loadAdminStudentTop">

                    <div class="container" id="add-student-modal-container">
                      <!-- Student header -->
                      <div class="row lesson-header">
                        <div class="col-md-3">
                          <p>Student Name</p>
                        </div>
                        <div class="col-md-3">
                          <p>Gender</p>
                        </div>
                        <div class="col-md-3">
                          <p>Guardian Name</p>
                        </div>
                        <div class="col-md-3">
                          <p>Action</p>
                        </div>
                      </div>

                      <!-- Student List Start -->

                    </div>

                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12 text-center">
                    <button type="button" class="btn btn-outline-primary btn-sm btn-round" id="btnAddAdminStudentModalLoadMore" >Load More</button>
                  </div>
                </div>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-success" data-target="#invitationModal" data-toggle="modal" onclick="appendModal('invitationModal')" id="btnAutoJoinLink2" >Invite Students</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <!-- <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnAddStudentModalUpdate" >Add</button> -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Invitation modal -->
      <div class="row">
        <div class="modal fade" id="invitationModal" tabindex="-1" role="dialog" aria-labelledby="invitationModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Invite Students</h5>
                <button type="button" class="close" data-dismiss="modal">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="addTutorModalBody">

                <div class="form-group" style="margin-top: 0rem;">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Online Registration Link</span>
                  <div class="input-group">
                    <span class="d-flex align-items-center input-group-addon" style="margin-right: 0.5em; cursor: pointer;" onclick="copyText('inAutoJoinLink2')">
                      <span class="material-icons">
                        content_copy
                      </span>
                    </span>
                    <textarea type="text" value='' class="form-control" style="background-color: #f5f5f5;" id="inAutoJoinLink2" readonly></textarea>
                  </div>
                </div>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Student Modal  -->
      <div class="row">
        <div class="modal fade" id="editStudentModal" tabindex="-1" role="dialog" aria-labelledby="editStudentModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editStudentLabel">View Student</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnEditStudentModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="editStudentModalBody">
                <div id="editClassStudentDocId" value=""></div>
                <div id="editStudentId" value=""></div>
                <div id="editGuardianId" value=""></div>
                <div id="editStudentEnrollmentStatus" value=""></div>
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group" >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Student Name</span>
                      <input id="stuName" type="text" class="form-control" readonly>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="form-group" >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Student Phone</span>
                      <input id="stuPhone" type="text" class="form-control" readonly>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group" >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Student Email</span>
                      <input id="stuEmail" type="text" class="form-control" readonly>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group" >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Student Gender</span>
                      <div class="form-check form-check-radio">
                        <label class="form-check-label">
                          <input class="form-check-input" type="radio" name="stuGenderRadio" id="stuGenderMale" value="option1" disabled>
                            Male
                          <span class="circle">
                            <span class="check"></span>
                          </span>
                        </label>
                      </div>
                      <div class="form-check form-check-radio">
                        <label class="form-check-label">
                          <input class="form-check-input" type="radio" name="stuGenderRadio" id="stuGenderFemale" value="option2" disabled>
                            Female
                          <span class="circle">
                            <span class="check"></span>
                          </span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group" >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Guardian Name</span>
                      <input id="gurName" type="text" class="form-control" readonly>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="form-group" >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Guardian Phone</span>
                      <input id="gurPhone" type="text" class="form-control" readonly>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group" >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Guardian Email</span>
                      <input id="gurEmail" type="text" class="form-control" readonly>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-group" >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Address</span>
                      <textarea class="form-control" id="gurAddr" rows="2" readonly></textarea>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-group" >
                      <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Add Feedback / Comment</span>
                      <textarea class="form-control" id="stuFeedback" rows="4"></textarea>
                    </div>
                  </div>
                </div>


              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnEditStudentModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnEditStudentModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Delete Student modal -->
      <div class="row">
        <div class="modal fade" id="delStudentModal" tabindex="-1" role="dialog" aria-labelledby="delStudentModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="delStudentLabel">Removing This Student</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnDelStudentModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="delStudentModalBody">
                <div id="deleteStudentClassId" value=""></div>
                <div id="deleteStudentName" value=""></div>
                <div id="deleteStudentId" value=""></div>
                <div id="deleteGuardianId" value=""></div>
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnDelStudentModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnDelStudentModalUpdate">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- List Admins's Teacher modal -->
      <div class="row">
        <div class="modal fade" id="myTeacherModal" tabindex="-1" role="dialog" aria-labelledby="myTeacherModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="myTeacherModalLabel">My Teachers</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnMyTeacherModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="myTeacherModalBody">
                <div class="row">
                  <div class="col-md-12" id="studentTop">

                    <div class="container" id="add-tutor-modal-container">
                      <!-- Tutor header -->
                      <div class="row lesson-header text-center">
                        <div class="col-md-2">
                        </div>
                        <div class="col-md-3">
                          <p>Tutor Name</p>
                        </div>
                        <div class="col-md-3">
                          <p>Phone</p>
                        </div>
                        <div class="col-md-2">
                          <p>Age</p>
                        </div>
                        <div class="col-md-2">
                          <p>Action</p>
                        </div>
                      </div>
                      <!-- Myself -->
                      <!-- <div class="row tutor-wrapper text-center">
                        <div class="col-md-2">
                          <div style="height: 50px; width: 50px; display: inline-block; position: relative; overflow: hidden; border-radius: 50%;">
                            <img id="viewTutorMySelfImgUrl" style="height: 100%;width: 100%; object-fit: cover;" src="../../assets/img/empty-photo.png"/>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <p class="tutor-item" id="viewTutorMySelfName"></p>
                        </div>
                        <div class="col-md-3">
                          <p class="tutor-item" id="viewTutorMySelfPhone"></p>
                        </div>
                        <div class="col-md-2">
                          <p class="tutor-item" id="viewTutorMySelfAge"></p>
                        </div>
                        <div class="col-md-2">
                          <button type="button" class="btn btn-success btn-sm" data-dismiss="modal" id="btnSelectMyself" disabled>Myself</button>
                        </div>
                      </div> -->

                      <!-- Tutor List Start -->

                      <!-- <div class="row tutor-wrapper text-center">
                        <div class="col-md-2">
                          <div style="height: 50px; width: 50px; display: inline-block; position: relative; overflow: hidden; border-radius: 50%;">
                            <img id="viewTutorImgUrl" style="height: 100%;width: 100%; object-fit: cover;" src="../../assets/img/test.jpg"/>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <p class="tutor-item">Alric Liew</p>
                        </div>
                        <div class="col-md-3">
                          <p class="tutor-item">Phone</p>
                        </div>
                        <div class="col-md-2">
                          <p class="tutor-item">12</p>
                        </div>

                        <div class="col-md-2">
                          <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal" id="btnSelectTutor">Select</button>
                        </div>
                      </div> -->

                    </div>


                    <div class="row">
                      <div class="col-md-12 text-center">
                        <button type="button" class="btn btn-outline-primary btn-sm btn-round" id="btnAddTeacherModalLoadMore" >Load More</button>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary"  data-dismiss="modal" id="btnMyTeacherModalClose2">Close</button>
                <!-- <a type="button" class="btn btn-success" data-dismiss="modal" data-toggle="modal" data-target="#addTeacherModal" id="btnAddTeacherModal">Add New Teacher</a> -->
                <!-- <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnMyTeacherModalUpdate">Add</button> -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Teacher Modal -->
      <div class="row">
        <div class="modal fade" id="addTeacherModal" tabindex="-1" role="dialog" aria-labelledby="addTeacherModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addTeacherModalLabel">Add Teacher</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <!-- Phone -->
                <div class="form-group">
                  <label class="bmd-label-floating">Phone*</label>
                  <input class="form-control" id="addTeacherModalEmail" placeholder="" type="tel"></input>
                </div>
                <!-- Name -->
                <div class="form-group">
                  <label class="bmd-label-floating">Name*</label>
                  <input class="form-control" id="addTeacherModalName" placeholder=""></input>
                </div>

                <!-- Gender -->
                <div class="form-group">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;">Gender</span>
                  <div class="form-check form-check-radio form-check-inline">
                    <label class="form-check-label">
                      <input class="form-check-input" type="radio" name="exampleRadios" id="addTeacherModalRadio-male" value="option1" >
                      Male
                      <span class="circle">
                        <span class="check"></span>
                      </span>
                    </label>
                  </div>
                  <div class="form-check form-check-radio form-check-inline">
                    <label class="form-check-label">
                      <input class="form-check-input" type="radio" name="exampleRadios" id="addTeacherModalRadio-female" value="option2">
                      Female
                      <span class="circle">
                        <span class="check"></span>
                      </span>
                    </label>
                  </div>
                </div>

                <!-- Email -->
                <div class="form-group">
                  <label class="bmd-label-floating">Email</label>
                  <input class="form-control" id="addTeacherModalEmail" placeholder=""></input>
                </div>

                <!-- Address -->
                <div class="form-group">
                  <label class="bmd-label-floating">Address</label>
                  <textarea class="form-control" id="addTeacherModalAddress" rows="4"></textarea>
                </div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnAddTeacherModalUpdate" >Add</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Remove Teacher 2 modal -->
      <div class="row">
        <div class="modal fade" id="delTutor2Modal" tabindex="-1" role="dialog" aria-labelledby="delTutor2ModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="delTutor2Label">Removing Teacher 2</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnDelTutor2ModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="delTutor2ModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnDelTutor2ModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnDelTutor2ModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Save Data modal -->
      <div class="row">
        <div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="saveModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="saveLabel">Save</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnSaveModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="saveModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnSaveModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSaveModalUpdate">Save</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Image Uploading Progress modal -->
      <div class="row">
        <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="uploadModalLabel">Uploading...</h5>
              </div>
              <div class="modal-body" id="uploadModalBody">
                <div id="myProgress" style="width: 100%; background-color: grey;">
                  <div id="myBar" style="width: 1%; height: 30px; background-color: green;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Archive Class modal -->
      <div class="row">
        <div class="modal fade" id="archiveClassModal" tabindex="-1" role="dialog" aria-labelledby="archiveClassModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Are you absolutely sure? </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <p>This action will archive the class details & lesson histories.</p>
                <p>Your teachers will not be able to access this class. However, students and parents are able to view this class under their accounts. </p>

                <p>Please type <strong>OK</strong> to confirm.</p>


                <input type="text" class="form-control" id="archiveClassModalIn">


              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal" id="btnArchiveClassModalUpdate" style="white-space: normal; word-wrap: break-word;" disabled>Confirm Archive</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reactivate modal -->
      <div class="row">
        <div class="modal fade" id="reactivateModal" tabindex="-1" role="dialog" aria-labelledby="signOutModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Re-activate This Class</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <p>This action will restore the archived class details and lesson histories.<br/>
                Teachers & students will be able to access this class.</p>
                <p>Are you sure you want to continue?</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnReactivateModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Delete Class modal -->
      <div class="row">
        <div class="modal fade" id="delClassModal" tabindex="-1" role="dialog" aria-labelledby="delClassModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="delClassModalLabel">Are you absolutely sure? </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnDelClassModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="delClassModalBody">
                <p>This action cannot be <strong style="color: red;">undone</strong>. This will permanently delete the class details, lesson histories, assigned teachers, and remove all enrolled students.</p>
                <p>Your students and teachers will not be able to view this class under their accounts. </p>
                <p>If you still want to keep this class, you may set the Class Status to <strong style="color: #2e74b6 ;">Inactive</strong>.</p>

                <p>Please type <strong>DELETE</strong> to confirm.</p>


                <input type="text" class="form-control" id="delClassModalIn">


              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal" id="btnDelClassModalUpdate" style="white-space: normal; word-wrap: break-word;" disabled>I understand the consequences. Delete this class.</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sign-out modal -->
      <div class="row">
        <div class="modal fade" id="signOutModal" tabindex="-1" role="dialog" aria-labelledby="signOutModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="signOutLabel">Logging Out</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="signOutModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSignOutModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="container overflow-hidden">
          <!-- Back button -->
          <div class="row d-flex">
            <div class="p-2">
              <a href="./" class="btn btn-outline-primary btn-round" id="btnBack" name="param-link"><i class="material-icons" style="color: #2e74b6; margin-right: 0.5em;">west</i> Back</a>
            </div>
            <!-- <div class="p-2">
              <a href="javascript:;" class="btn btn-outline-primary btn-round text-white hidden" id="btnSave" data-toggle="modal" data-target="#saveModal" style="background: #2e74b6;" perm="teach-class-edit"><i class="material-icons" style="color: #ffffff; margin-right: 0.5em;">save</i> Save</a>
            </div> -->
          </div>

          <div class="row">
            <div class="col-md-12">
              <div class="row" >
                <div class="col-12 col-lg-12 ml-auto mr-auto mb-4">
                  <div class="d-flex flex-wrap multitabs-form__progress">
                    <button class="multitabs-form__progress-btn js-active" type="button" title="Lessons">Lessons</button>
                    <button class="multitabs-form__progress-btn" type="button" title="General Info">General</button>
                    <button class="multitabs-form__progress-btn" type="button" title="Time Slot">Schedule</button>
                    <button class="multitabs-form__progress-btn" type="button" title="Students">Students</button>
                    <button class="multitabs-form__progress-btn" type="button" title="Teacher">Teacher</button>
                    <button class="multitabs-form__progress-btn" type="button" title="Fee">Fee</button>
                    <!-- <button class="multitabs-form__progress-btn" type="button" title="Advanced Settings" id="advancedSettingsTab">Advanced <span class='card-class-status-label'>Admin</span></button> -->
                    <button class="multitabs-form__progress-btn" type="button" title="Advanced Settings" id="advancedSettingsTab" >Advanced</button>
                    <button class="multitabs-form__progress-btn" type="button" title="Public" id="publicTab" style="display: none;">Public</button>


                  </div>
                </div>
              </div>

              <!--multitabs-form-->
              <div class="multitabs-form">
                <!--form panels-->
                <div class="row">
                  <div class="col-12">
                    <form class="multitabs-form__form">
                      <!--Lessons panel-->
                      <div class="multitabs-form__panel shadow p-4 rounded bg-white js-active" data-animation="scaleIn">
                        <h4 class="multitabs-form__title">Lessons
                          <a class="btn btn-sm btn-outline-primary btn-round hidden" id="btnAddLesson" data-toggle="modal" data-target="#addLessonModal" data-button-text="Add" data-title="Add New Lesson" perm='teach-lesson-add'><i class="material-icons" style="color: #2e74b6;">add</i></a>
                          <a class="btn btn-sm btn-outline-primary btn-round" onclick="latestLessonDoc=null; removeElementsByClass('row lesson-wrapper'); LoadLessonInfo();"><i class="material-icons" style="color: #2e74b6;">refresh</i></a>
                          <a class="btn btn-sm btn-outline-primary btn-round" onclick="generatePDFeKoopmans('lessonTop')"><i class="fas fa-file-download fa-fw" style="color: #2e74b6; font-size: 0.8rem;"></i></a>

                        </h4>
                        <div class="multitabs-form__content">

                          <div class="col-md-12" id="lessonTop" style="padding: 0; margin-top: 1rem;">
                            <!-- <div class="container" style="padding: 0rem 0rem 0rem 0rem; ">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin: auto 1rem 0 auto;">Class Details</span>
                              <a class="btn btn-sm btn-outline-primary btn-round" id="btnAddLesson" data-toggle="modal" data-target="#addLessonModal" data-button-text="Add" data-title="Add New Lesson"><i class="material-icons" style="color: #2e74b6; padding-bottom: 0.2em;">add</i></a>
                            </div> -->
                            <!-- <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Class Details</span>  -->

                            <div class="container" id="lesson-container">
                              <!-- Lesson header -->
                              <div class="row lesson-header">
                                <div class="col-md-11">
                                  <div class="row">
                                    <div class="col-md-4">
                                      <div class="row">
                                        <div class="col-md-4 ">
                                          <p>Date</p>
                                        </div>
                                        <div class="col-md-8">
                                          <p>Time</p>
                                        </div>
                                        <!-- <div class="col-4">
                                          <p>End Time</p>
                                        </div> -->
                                      </div>
                                    </div>
                                    <div class="col-md-4">
                                      <p>Class Notes</p>
                                    </div>
                                    <div class="col-md-4">
                                      <p>Teacher's Feedback</p>
                                      <!-- <div class="row" style="padding:0; margin: 0;">
                                        <div class="col-8" style="padding:0; margin: 0;">
                                          <p>Teacher's Feedback</p>
                                        </div>
                                        <div class="col-4" style="padding-right:0; margin-right: 0;">
                                          <p>Score</p>
                                        </div>
                                      </div> -->
                                    </div>
                                  </div>
                                </div>

                                <div class="col-md-1">
                                  <p>Action</p>
                                </div>
                              </div>

                              <!-- No data placeholder -->
                              <div class="row" style="display: none;" id="lessonNoDataPlaceholder">
                                <div class="col-md-12 text-center">
                                  No lesson
                                </div>
                              </div>

                              <!-- Add new lesson here .... -->
                              <!-- Lesson List Start -->
                              <!-- <div class="row lesson-wrapper">
                                <div class="col-md-11" >
                                  <div class="row">
                                    <div class="col-md-4 lesson-active" data-toggle="modal" data-target="#editLessonModal">
                                      <div class="row">
                                        <div class="col-4" >
                                            <p class="lesson-item">12/6/2022</p>
                                        </div>
                                        <div class="col-4">
                                            <p class="lesson-item">11:12</p>
                                        </div>
                                        <div class="col-4">
                                            <p class="lesson-item">11:12</p>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="col-md-4 lesson-active" data-toggle="modal" data-target="#editLessonModal">
                                        <p class="lesson-item">Announcement Text Here a a a a a a a a Announcement Text Here Announcement Text Here Announcement Text Here Announcement Text Here Announcement Text Here Announcement Text Here Announcement Text Here Announcement Text Here</p>
                                    </div>
                                    <div class="col-md-4 lesson-active" data-toggle="modal" data-target="#editLessonModal">
                                      <div class="row" style="padding:0; margin: 0;">
                                        <div class="col-md-8" style="padding:0;">
                                          <p class="lesson-item">Feedback Text Here a a a a a aa  a a a adsa a adsa as ada as da a sadas asda  </p>
                                        </div>
                                        <div class="col-md-4" style="padding-right:0;">
                                          <span class="d-flex flex-wrap align-content-center" style="margin-top: 1rem;">5<i class="material-icons">star</i></span>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                                <div class="col-md-1">
                                  <a href="#" class="btn btn-sm btn-outline-danger btn-round" id="btnRemoveTimeSlot" data-toggle="modal" data-target="#delLessonModal" data-id="lessonId" style="margin-top: 1rem;"><i class="material-icons" style="color: red;">remove</i></a>
                                </div>
                              </div> -->
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12" >
                              <a class="btn btn-sm btn-outline-primary btn-round" id="btnLessonLoadMore">Load More <i class="material-icons" style="color: #2e74b6; padding-bottom: 0.2em;">expand_more</i></a>
                            </div>
                          </div>

                        </div>
                      </div>
                      <!--General panel-->
                      <div class="multitabs-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                        <h4 class="multitabs-form__title">General Info</h4>
                        <div class="multitabs-form__content">
                          <div class="col-md-12">
                            <!-- Announcement -->
                            <div class="form-group" style="margin-top: 1.5rem;" >
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Class Announcement</span>
                              <textarea class="form-control" maxlength="511" rows="3" id="inClassAnnouncement" data-compulsory="false" placeholder="Write something ..."></textarea>
                            </div>

                            <div class="form-group" style="margin-top: 2rem;">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Class Name* <span id="countClassName" style="color: grey; margin-left: 1rem;">0/40</span></span>
                              <input type="text" class="form-control" id="inClassName" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40">
                            </div>


                            <div class="form-group" style="margin-top: 2rem;">
                              <p class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 1rem;">Class Icon</p>
                              <div style="height: 100px;width: 100px; display: inline-block; position: relative; overflow: hidden; border-radius: 50%; cursor: pointer;">
                                <img id="tutorImgUrl" style="height: 100%;width: 100%; object-fit: cover;" src="../../assets/img/empty-photo.png"/>
                              </div>
                              <input type="file" id="select_image" name="image" style="display:none" accept="image/x-png,image/jpeg"> </input>
                            </div>

                            <div class="form-group" style="margin-top: 1.5rem;" >
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Class Description <span id="countClassDesc" style="color: grey; margin-left: 1rem;">0/400</span></span>
                              <textarea class="form-control" maxlength="400" rows="4" id="inClassDesc" data-compulsory="false"></textarea>
                            </div>

                            <div class="form-group" style="margin-top: 2rem;">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Venue <span id="countClassVenue" style="color: grey; margin-left: 1rem;">0/250</span></span>
                              <textarea class="form-control" maxlength="250" rows="3"  id="inVenue" data-compulsory="false"></textarea>
                            </div>

                            <div class="form-group" style="margin-top: 2rem;">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Class Link</span>
                              <span class="tooltiptext-trigger">?
                                <span class="tooltiptext-general">
                                  <h6>Class Link</h6>
                                  <p>Link to the platform where this class will be conducted. I.e Google Meet, Zoom or other platforms.</p>
                                </span>
                              </span>
                              <div class="input-group">
                                <span class="d-flex align-items-center input-group-addon" id="inUrlClassIconWrapper" style="margin-right: 0.5em; cursor: pointer;" onclick="RedirectTo('')">
                                  <img id='inUrlClassIcon' height="24" width="24" src="http://www.google.com/s2/favicons?domain=https://golearn.com.my/"/>
                                </span>
                                <input type="text" class="form-control" id="inUrlClass" data-compulsory="true" oninput="this.className = 'form-control'">
                              </div>
                            </div>


                            <div class="form-group" style="margin-top: 2rem;">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Chat Group Link</span>
                              <span class="tooltiptext-trigger">?
                                <span class="tooltiptext-general">
                                  <h6>Chat Group Link</h6>
                                  <p>Link to this class chat group. I.e Whatsapp, Telegram, Facebook group or other groups.</p>
                                </span>
                              </span>
                              <div class="input-group">
                                <span class="d-flex align-items-center input-group-addon" id="inUrlGroupIconWrapper" style="margin-right: 0.5em; cursor: pointer;" onclick="RedirectTo('')">
                                  <img id='inUrlGroupIcon' height="24" width="24" src="http://www.google.com/s2/favicons?domain=https://golearn.com.my/"/>
                                </span>
                                <input type="text" class="form-control" id="inUrlGroup" data-compulsory="true" oninput="this.className = 'form-control'" >
                              </div>
                            </div>

                            <div class="form-group" style="margin-top: 2rem;">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Lesson Material Link </span>
                              <span class="tooltiptext-trigger">?
                                <span class="tooltiptext-general">
                                  <h6>Lesson Material Link</h6>
                                  <p>Link to material that will be used for the class. I.e Google Classroom, Drive, or other storage places.</p>
                                </span>
                              </span>
                              <div class="input-group">
                                <span class="d-flex align-items-center input-group-addon" id="inUrlMaterialIconWrapper" style="margin-right: 0.5em; cursor: pointer;" onclick="RedirectTo('')">
                                  <img id='inUrlMaterialIcon' height="24" width="24" src="http://www.google.com/s2/favicons?domain=https://golearn.com.my/"/>
                                </span>
                                <input type="text" class="form-control" id="inUrlMaterial" data-compulsory="true" oninput="this.className = 'form-control'">
                              </div>
                            </div>

                          </div>

                          <div class="button-row d-flex mt-4">
                            <!-- <button class="btn btn-primary ml-auto js-btn-next" type="button" title="Next">Next</button> -->
                          </div>
                        </div>
                      </div>
                      <!--Time Slot panel-->
                      <div class="multitabs-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                        <h4 class="multitabs-form__title">Class Schedule</h4>
                        <div class="multitabs-form__content">
                          <div class="col-md-12" id="timeSlotTop">

                            <div class="container" id="timeSlot-container">
                              <div class="row" style="padding: 0rem 3rem 0rem 0rem; border: solid #2e74b6; border-width: thin; margin-top: 1rem;" id="timeSlot-1">

                                <div class="col-md-5">
                                  <div class="form-group">
                                    <span class="" style="font-size: smaller; font-weight: 300; color: gray;">Day of Week*</span>
                                    <select class="form-control" name="tutor_course[]" id="inDayOfWeek1" data-compulsory="true" oninput="this.className = 'form-control'">
                                      <option value="">Select Day Of Week</option>
                                      <option value="mon">Monday</option>
                                      <option value="tue">Tuesday</option>
                                      <option value="wed">Wednesday</option>
                                      <option value="thu">Thursday</option>
                                      <option value="fri">Friday</option>
                                      <option value="sat">Saturday</option>
                                      <option value="sun">Sunday</option>
                                    </select>
                                  </div>

                                  <!-- <div class="form-group">
                                    <span class="" style="font-size: smaller; font-weight: 300; color: gray;margin-bottom: 0;">Day of Week*</span>
                                    <input type="text" class="form-control" id="DayOfWeek1">
                                  </div> -->
                                </div>
                                <div class="col-md-3">
                                  <div class="form-group"  >
                                    <span class="" style="font-size: smaller; font-weight: 300; color: gray;">Start Time*</span>
                                    <div class="input-group clockpicker" data-placement="bottom" data-align="top" data-autoclose="true" style="margin-top: 0.3rem;">
                                      <input id="inStartTime1" type="text" class="form-control" value="" data-compulsory="true" oninput="this.className = 'form-control'" style="cursor: not-allowed; pointer-events: none;">
                                      <span class="d-flex align-items-center input-group-addon">
                                        <span class="material-icons">
                                          more_time
                                        </span>
                                      </span>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-3">
                                  <div class="form-group">
                                    <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">End Time*</span>
                                    <div class="input-group clockpicker" data-placement="bottom" data-align="top" data-autoclose="true" style="margin-top: 0.3rem;">
                                      <input id="inEndTime1" type="text" class="form-control" value="" data-compulsory="true" oninput="this.className = 'form-control'" style="cursor: not-allowed; pointer-events: none;">
                                      <span class="d-flex align-items-center input-group-addon">
                                        <span class="material-icons">
                                          more_time
                                        </span>
                                      </span>
                                    </div>
                                  </div>
                                </div>
                                <!-- <div class="col-md-1 d-flex align-items-center">
                                  <a href="#" class="btn btn-sm btn-outline-danger btn-round" id="btnRemoveTimeSlot"><i class="material-icons" style="color: red;">remove</i></a>
                                </div> -->
                              </div>

                            </div>

                            <div class="col-lg-4 col-md-4 col-sm-4">
                              <a class="btn btn-sm btn-outline-primary btn-round" id="btnAddTimeSlot"><i class="material-icons" style="color: #2e74b6;">add</i></a>
                            </div>
                          </div>

                          <div class="button-row d-flex mt-4">
                            <!-- <button class="btn btn-primary js-btn-prev" type="button" title="Prev">Prev</button> -->
                            <!-- <button class="btn btn-primary ml-auto js-btn-next" type="button" title="Next">Next</button> -->
                          </div>
                        </div>
                      </div>
                      <!--Students panel-->
                      <div class="multitabs-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                        <h4 class="multitabs-form__title">Students
                          <a class="btn btn-sm btn-outline-primary btn-round" id="btnAddStudent" data-toggle="modal" data-target="#addStudentModal" data-button-text="Add" data-title="Add New Student"  onclick="appendModal('addStudentModal')"><i class="material-icons" style="color: #2e74b6;">add</i></a>
                          <a class="btn btn-sm btn-outline-primary btn-round" onclick="latestStuDoc=null; removeElementsByClass('row student-wrapper'); loadAllStudents();"><i class="material-icons" style="color: #2e74b6;">refresh</i></a>
                        </h4>
                        <div class="multitabs-form__content">
                          <div class="col-md-12" style="padding: 0; margin-top: 1rem;">

                            <div class="container" id="students-container">
                              <!-- Student header -->
                              <div class="row lesson-header">
                                <div class="col-md-11" >
                                  <div class="row" >
                                    <div class="col-md-3">
                                      <p>Student Name</p>
                                    </div>
                                    <div class="col-md-1">
                                      <p>Gender</p>
                                    </div>
                                    <div class="col-md-3">
                                      <p>Guardian Name</p>
                                    </div>
                                    <div class="col-md-2">
                                      <p>Guardian Phone</p>
                                    </div>
                                    <div class="col-md-1">
                                      <p>Status</p>
                                    </div>
                                    <div class="col-md-2">
                                      <p>Date Joined</p>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-1">
                                  <p>Action</p>
                                </div>
                              </div>

                              <!-- No data placeholder -->
                              <div class="row" style="display: none;" id="studentNoDataPlaceholder">
                                <div class="col-md-12 text-center">
                                  No student
                                </div>
                              </div>

                              <!-- Student List Start -->
                              <!-- <div class="row lesson-wrapper">
                                <div class="col-md-11" >
                                  <div class="row" >
                                    <div class="col-md-3">
                                      <p class="lesson-item" style="margin-bottom: 0;">Student Name</p>
                                    </div>
                                    <div class="col-md-1">
                                      <p class="lesson-item">Gender</p>
                                    </div>
                                    <div class="col-md-3">
                                      <p class="lesson-item">Guardian</p>
                                    </div>
                                    <div class="col-md-2">
                                      <p class="lesson-item">Contact No.</p>
                                    </div>
                                    <div class="col-md-1">
                                      <p class="lesson-item card-student-status-label pending" >Pending</p>
                                    </div>
                                    <div class="col-md-2">
                                      <p class="lesson-item">Date Joined</p>
                                    </div>
                                  </div>
                                </div>

                                <div class="col-md-1">
                                  <a href="#" class="btn btn-sm btn-outline-danger btn-round" id="btnRemoveTimeSlot" data-toggle="modal" data-target="#delLessonModal" data-id="lessonId"><i class="material-icons" style="color: red;">remove</i></a>
                                </div>
                              </div> -->
                            </div>
                          </div>

                          <div class="row">
                            <div class="col-md-12" >
                              <a class="btn btn-sm btn-outline-primary btn-round" id="btnStudentLoadMore">Load More <i class="material-icons" style="color: #2e74b6;">expand_more</i></a>
                            </div>
                          </div>

                        </div>
                      </div>
                      <!--Teacher panel-->
                      <div class="multitabs-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                        <h4 class="multitabs-form__title">Teachers</h4>
                        <div class="multitabs-form__content">
                          <!-- Teacher 1  -->
                          <div class="row" style="margin-top: 1.0rem;">
                            <div class="col-md-1">
                              <div style="height: 50px; width: 50px; display: inline-block; position: relative; overflow: hidden; border-radius: 50%; margin-top: 1.5rem;">
                                <img id="inTutor1ImgUrl" style="height: 100%;width: 100%; object-fit: cover;" src="../../assets/img/empty-photo.png"/>
                              </div>
                            </div>
                            <div class="col-md-5">
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Teacher 1's Name*</span>
                                <input type="text" class="form-control" style="background-color: #e9ecef;" disabled  id="inTutor1Name" data-tutor1id="bobo">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Teacher 1's Phone*</span>
                                <input type="text" class="form-control" style="background-color: #e9ecef;" disabled  id="inTutor1Phone">
                              </div>
                            </div>
                            <div class="col-md-2 d-flex align-items-center">
                              <a class="btn btn-sm btn-outline-primary btn-round" id="btnAddTeacher1" data-toggle="modal" data-target="#myTeacherModal" data-num='1' onclick="appendModal('myTeacherModal')" href="javascript:;" style="pointer-events:none; background-color: #e9ecef;"><i class="material-icons" style="color: #2e74b6;">add</i></a>
                            </div>
                          </div>
                          <!-- Teacher 2  -->
                          <div class="row" style="margin-top: 1.0rem;">
                            <div class="col-md-1">
                              <div style="height: 50px; width: 50px; display: inline-block; position: relative; overflow: hidden; border-radius: 50%; margin-top: 1.5rem;">
                                <img id="inTutor2ImgUrl" style="height: 100%;width: 100%; object-fit: cover;" src="../../assets/img/empty-photo.png"/>
                              </div>
                            </div>
                            <div class="col-md-5">
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Teacher 2's Name</span>
                                <input type="text" class="form-control" style="background-color: #e9ecef;" disabled id="inTutor2Name" data-tutor2id="bobo2">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group" >
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Teacher 2's Phone</span>
                                <input type="text" class="form-control" style="background-color: #e9ecef;" disabled id="inTutor2Phone">
                              </div>
                            </div>
                            <div class="col-md-2 d-flex align-items-center">
                              <a class="btn btn-sm btn-outline-primary btn-round" id="btnAddTeacher2" data-toggle="" data-target="#myTeacherModal" data-num='2' onclick="appendModal('myTeacherModal')" href="javascript:;" style="pointer-events:none; background-color: #e9ecef;"><i class="material-icons" style="color: #2e74b6;">add</i></a>
                              <a class="btn btn-sm btn-outline-danger btn-round" id="btnDelTeacher2" data-toggle="modal" data-target="#delTutor2Modal" href="javascript:;" ><i class="material-icons" style="color: red;">remove</i></a>
                            </div>
                          </div>
                          <div class="button-row d-flex mt-4">
                            <!-- <button class="btn btn-primary js-btn-prev" type="button" title="Prev">Prev</button> -->
                            <!-- <button class="btn btn-primary ml-auto js-btn-next" type="button" title="Next">Next</button> -->
                          </div>
                        </div>
                      </div>
                      <!--Fee panel-->
                      <div class="multitabs-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                        <h4 class="multitabs-form__title">Tutoring Fee</h4>
                        <div class="multitabs-form__content">

                          <div class="form-group" style="margin-top: 2rem;">
                            <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Fee* (RM)</span>
                            <input type="number" step=".01" pattern="^\d*(\.\d{0,2})?$" class="form-control" id="inFee" data-compulsory="true" oninput="this.className = 'form-control'">
                          </div>

                          <div style="margin-top: 1.0rem;"></div>
                          <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;" >Fee Type</span>
                          <div class="form-group" >
                            <div class="form-check form-check-radio form-check-inline">
                              <label class="form-check-label">
                                <input class="form-check-input" type="radio" name="exampleRadios" id="feeTypePerMonthRadio" value="option1" data-compulsory="false">
                                Per Month
                                <span class="circle">
                                  <span class="check"></span>
                                </span>
                              </label>
                            </div>
                            <div class="form-check form-check-radio form-check-inline">
                              <label class="form-check-label">
                                <input class="form-check-input" type="radio" name="exampleRadios" id="feeTypePerHourRadio" value="option2" data-compulsory="false">
                                Per Hour
                                <span class="circle">
                                  <span class="check"></span>
                                </span>
                              </label>
                            </div>
                          </div>

                          <div class="button-row d-flex mt-4">
                            <!-- <button class="btn btn-primary js-btn-prev" type="button" title="Prev">Prev</button> -->
                            <!-- <button class="btn btn-primary ml-auto js-btn-next" type="button" title="Next">Next</button> -->
                          </div>
                        </div>
                      </div>
                      <!--Advanced panel-->
                      <div class="multitabs-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                        <h4 class="multitabs-form__title">Advanced Settings</h4>
                        <div class="multitabs-form__content">

                          <!-- Type -->
                          <div class="row" style="display: none;">
                            <div class="col-sm-12 text-left">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-top: 1.0rem;">Class Type</span>
                              <span class="tooltiptext-trigger">?
                                <span class="tooltiptext-general">
                                  <h6>Class Type</h6>
                                  <p>Set to <strong style="color: #2e74b6;">Public</strong> to be discovered by other. </p>
                                </span>
                              </span>
                            </div>
                          </div>

                          <div class="form-group"  style="display: none;">
                            <div class="form-check form-check-radio form-check-inline">
                              <label class="form-check-label">
                                <input class="form-check-input" type="radio" name="classTypeRadios" id="classTypeRadioPrivate" value="option1" data-compulsory="false" checked>
                                Private
                                <span class="circle">
                                  <span class="check"></span>
                                </span>
                              </label>
                            </div>
                            <div class="form-check form-check-radio form-check-inline">
                              <label class="form-check-label">
                                <input class="form-check-input" type="radio" name="classTypeRadios" id="classTypeRadioPublic" value="option2" data-compulsory="false">
                                Public
                                <span class="circle">
                                  <span class="check"></span>
                                </span>
                              </label>
                            </div>
                          </div>

                          <!-- Spacer  -->
                          <!-- <div style="margin-top: 2rem;"></div> -->

                          <!-- Student Limit -->
                          <div class="form-group" style="margin-top: 0rem;">
                            <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Student Limit</span>
                            <input type="number" class="form-control" id="inStudentLimit" data-compulsory="true" oninput="this.className = 'form-control'; checkStudentLimit();">
                          </div>

                          <!-- First Class Date -->
                          <div class="form-group" style="margin-top: 0rem;">
                            <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">First Lesson Date</span>
                            <span class="tooltiptext-trigger">?
                              <span class="tooltiptext-general">
                                <h6>First Lesson Date</h6>
                                <p>Set the first lesson date. Useful for custom payment cycle. Default: The date this class is created.</p>
                              </span>
                            </span>
                            <input id="firstClassDatePicker" class="form-control" type="text" data-compulsory="false" oninput="this.className = 'form-control'" style="cursor:pointer;" readonly>

                            <!-- <input type="number" class="form-control" value="20" style="background-color: #e9ecef;" disabled id="inStudentLimit" data-compulsory="true" oninput="this.className = 'form-control'"> -->
                          </div>

                          <!-- Spacer  -->
                          <div style="margin-top: 1.5rem;"></div>

                          <!-- Permission -->
                          <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Special Permissions</span>
                          <div class="form-check" style="margin-top: 1.0rem;">
                            <label class="form-check-label">
                              <input class="form-check-input" type="checkbox" value="" id="stuAutoJoinEn" checked>
                              <span class="form-check-sign">
                                <span class="check"></span>
                              </span>
                              Allow students to join class through invitation link.
                            </label>
                          </div>
                          <!-- Invite Link: Show when above is checked -->
                          <div class="form-group"  style="padding: 0.5rem; margin-top: 1rem; display: none; " id="inAutoJoinLinkTop">
                            <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Copy Student Registration Link:</span>
                            <div class="input-group">
                              <span class="d-flex align-items-center input-group-addon" id="btnCopyAutoJoinLink" style="margin-right: 0.5em; cursor: pointer;" onclick="copyText('inAutoJoinLink')">
                                <span class="material-icons">
                                  content_copy
                                </span>
                              </span>
                              <input type="text" value='' class="form-control" style="background-color: #e9ecef; pointer-events: none;" id="inAutoJoinLink">
                            </div>
                          </div>

                          <div class="form-check" style="margin-top: 1.0rem;">
                            <label class="form-check-label">
                              <input class="form-check-input" type="checkbox" value="" id="tAddEditLessonEn">
                              <span class="form-check-sign">
                                <span class="check"></span>
                              </span>
                              Authorize teachers to create and edit lessons.
                            </label>
                          </div>
                          <div class="form-check" style="margin-top: 1.0rem;">
                            <label class="form-check-label">
                              <input class="form-check-input" type="checkbox" value="" id="tDelLessonEn">
                              <span class="form-check-sign">
                                <span class="check"></span>
                              </span>
                              Authorize teachers to remove lessons.
                            </label>
                          </div>
                          <div class="form-check" style="margin-top: 1.0rem;">
                            <label class="form-check-label">
                              <input class="form-check-input" type="checkbox" value="" id="tAddRibbonEn">
                              <span class="form-check-sign">
                                <span class="check"></span>
                              </span>
                              Add A Ribbon
                            </label>
                          </div>
                          <!-- Ribbon: Show when above is checked -->
                          <div class="row" id="inRibbonSettings" style="display: none; padding: 0.5rem; margin-top: 0.5rem;">

                            <div class="col-md-4 full">

                              <p class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Pick A Color</p>
                              <input type="text" id="inLabelColor" value="#e76f51" class="coloris">


                              <p class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0; margin-top: 0.5rem;">Content (Max 2 Chars / 1 Emoji )</p>
                              <input type="text" class="form-control" id="inLabelText" data-compulsory="false" maxlength="2">
                            </div>
                            <div class="col-md-8">

                              <div class="card"  style="height: 70px; width: 200px">
                                <div class="ribbon down">
                                  <div class="content" id="inLabelSample"></div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Spacer  -->
                          <div style="margin-top: 2rem;"></div>

                          <!-- Class Tag -->
                          <div class="form-group" style="margin-top: 0rem;">
                            <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Tag</span>
                            <span class="tooltiptext-trigger">?
                              <span class="tooltiptext-general">
                                <h6>Tag</h6>
                                <p>Assign up to 5 tag keywords to identify this class, and receive better breakdowns in your analysis reports.</p>
                              </span>
                            </span>
                            <input type="text" id="classTag" data-role="tagsinput" class="form-control">
                          </div>

                          <!-- Status -->
                          <div class="row">
                            <div class="col-sm-12 text-left">
                              <span class="" style="font-size: smaller; font-weight: 300; color: gray;">Class Status</span>
                              <span class="tooltiptext-trigger">?
                                <span class="tooltiptext-general">
                                  <h6>Class Status</h6>
                                  <p>Set to <strong style="color: #2e74b6;">Inactive</strong> to pause the class new intake, hide from the public, and disallow edits to the class.</p>
                                </span>
                              </span>
                            </div>
                          </div>

                          <div class="form-group">
                            <div class="form-check form-check-radio form-check-inline">
                              <label class="form-check-label">
                                <input disabled class="form-check-input" type="radio" name="classStatus" id="classStatusRadioActive" value="optionActive" data-compulsory="false" checked>
                                Active
                                <span class="circle">
                                  <span class="check"></span>
                                </span>
                              </label>
                            </div>
                            <div class="form-check form-check-radio form-check-inline">
                              <label class="form-check-label">
                                <input disabled class="form-check-input" type="radio" name="classStatus" id="classStatusRadioInactive" value="optionInactive" data-compulsory="false">
                                Inactive
                                <span class="circle">
                                  <span class="check"></span>
                                </span>
                              </label>
                            </div>
                          </div>

                          <!-- Archive Class  -->
                          <!-- <div class="row hidden" perm='teach-class-del'>
                            <div class="col-sm-12 text-left">
                              <span class="" style="font-size: smaller; font-weight: 400; color: grey;">Archive This Class</span>
                              <span class="tooltiptext-trigger" style="background-color: red; padding: 0.2em 0.6em 0.2em 0.6em;">!
                                <span class="tooltiptext-general" style="border: thin solid red;">
                                  <h6 style="color: red;">Archive This Class</h6>
                                  <p>This action will archive the class details & lesson histories.</p>
                                  <p>Teachers will <strong>NOT</strong> be able to access this class.</p>
                                  <p>Students and parents can still view this class under their accounts.</p>
                                </span>
                              </span>
                            </div>
                          </div>
                          <div class="row hidden" perm='teach-class-del'>
                            <div class="col-md-12" >
                              <a class="btn btn-sm btn-outline-danger btn-round" id="btnDelClass" style="color: red; background-color: white;" data-toggle='modal' data-target='#archiveClassModal'>Archive Class <i class="fas fa-exclamation-triangle" style="color: red;"></i></a>
                            </div>
                          </div> -->

                          <!-- Re-activate Class  -->
                          <div class="row hidden" perm='teach-class-del'>
                            <div class="col-sm-12 text-left">
                              <span class="" style="font-size: smaller; font-weight: 400; color: grey;">Re-activate Class</span>
                              <span class="tooltiptext-trigger">?
                                <span class="tooltiptext-general">
                                  <h6>Re-activate Class</h6>
                                  <p>This action will restore the archived class details and lesson histories.</p>
                                  <p>Teachers & students will be able to access this class.</p>
                                </span>
                              </span>
                            </div>
                          </div>
                          <div class="row hidden" perm='teach-class-del'>
                            <div class="col-md-12" >
                              <a class="btn btn-sm btn-outline-primary btn-round" id="btnDelClass" style="color: #2e74b6; background-color: white;" data-toggle='modal' data-target='#reactivateModal'>Re-activate Class</a>
                            </div>
                          </div>



                          <!-- Delete Class  -->
                          <div class="row hidden" perm='teach-class-del'>
                            <div class="col-sm-12 text-left">
                              <span class="" style="font-size: smaller; font-weight: 400; color: grey;">Delete This Class</span>
                              <span class="tooltiptext-trigger" style="background-color: red; padding: 0.2em 0.6em 0.2em 0.6em;">!
                                <span class="tooltiptext-general" style="border: thin solid red;">
                                  <h6 style="color: red;">Delete This Class</h6>
                                  <p>This action cannot be <strong style="color: red;">undone</strong>. This will permanently delete the class details, lesson histories, assigned teachers, and remove all enrolled students.</p>
                                </span>
                              </span>
                            </div>
                          </div>
                          <div class="row hidden" perm='teach-class-del'>
                            <div class="col-md-12" >
                              <a class="btn btn-sm btn-outline-danger btn-round" id="btnDelClass" style="color: red; background-color: white;" data-toggle='modal' data-target='#delClassModal'>Delete Class <i class="fas fa-exclamation-triangle" style="color: red;"></i></a>
                            </div>
                          </div>


                          <div class="button-row d-flex mt-4">
                            <!-- <button class="btn btn-primary js-btn-prev" type="button" title="Prev">Prev</button> -->
                            <!-- <button class="btn btn-success ml-auto js-btn-send" type="button" title="Send">Create Class</button> -->
                          </div>
                        </div>
                      </div>
                      <!--Public panel-->
                      <div class="multitabs-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                        <h4 class="multitabs-form__title">Public</h4>
                        <div class="multitabs-form__content">

                          <!-- Level and Subject  -->
                          <div class="row" style="margin: 0.5rem 0 0 0;  display: flex;" id="levelSubjectTop">
                            <div class="col-md-6" style="padding-left: 0;">
                                <!-- Education Level -->
                              <div class="form-group" >
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray;">Education Level*</span>
                                <select class="form-control" name="tutor_course[]" id="level_drop" data-compulsory="false" oninput="this.className = 'form-control'">
                                  <option value="">Select education level</option>
                                  <!-- <option value="1" >Pre-School</option>
                                  <option value="2" >Lower Primary (Tahun 1-3)</option>
                                  <option value="3" >Upper Primary (UPSR)</option>
                                  <option value="4" >Form 1-3 (PT3)</option>
                                  <option value="5" >Form 4-5 (SPM)</option>
                                  <option value="6" >Primary (International Syllabus)</option>
                                  <option value="7" >Lower Secondary (International Syllabus)</option>
                                  <option value="8" >Year 10-11 (IGCSE)</option>
                                  <option value="9" >Others</option> -->
                                </select>
                              </div>
                            </div>
                            <div class="col-md-6" style="padding-left: 0;">
                              <!-- Subjects -->
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray;" >Subject*</span>
                                <select class="form-control" name="tutor_course[]" id="subject_drop" data-compulsory="false" oninput="this.className = 'form-control'">
                                  <option value="">Select subject</option>
                                </select>
                              </div>
                            </div>
                          </div>

                          <!-- Online Only  -->
                          <div class="row" style="margin: 0.5rem 0 0 0; display: flex;" id="onlineOnlyTop">
                            <div class="form-check">
                              <label class="form-check-label">
                                <input class="form-check-input" type="checkbox" value="" id="onlineonly_check" data-compulsory="false">
                                <span class="form-check-sign">
                                  <span class="check"></span>
                                </span>
                                Online Only?
                              </label>
                            </div>
                          </div>

                          <!-- Area and State -->
                          <div class="row" style="margin: 0.5rem 0 1.5rem 0; display: flex;" id="areaStateTop">
                            <div class="col-md-6" style="padding-left: 0;">
                                <!-- State -->
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray;">State</span>
                                <select class="form-control" name="tutor_course[]" id="state_drop" data-compulsory="false">
                                  <option value="">Select state</option>

                                </select>
                              </div>
                            </div>
                            <div class="col-md-6" style="padding-left: 0;" >
                              <!-- Area -->
                              <div class="form-group">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray;" >Area</span>
                                <select class="form-control" name="tutor_course[]" id="area_drop" data-compulsory="false">
                                  <option value="">Select area</option>
                                </select>
                              </div>
                            </div>
                          </div>


                          <div class="row">
                            <button class="btn btn-primary" type="button">Submit for Review</button>
                          </div>
                          <div class="button-row d-flex mt-4">
                            <!-- <button class="btn btn-primary js-btn-prev" type="button" title="Prev">Prev</button> -->
                            <!-- <button class="btn btn-primary ml-auto js-btn-next" type="button" title="Next">Next</button> -->
                          </div>
                        </div>
                      </div>

                    </form>
                  </div>
                </div>
              </div>

            </div>
          </div>

        </div>
      </div>

      <footer class="footer">
        <div class="container-fluid">
          <nav class="float-left">
          <ul>
            <!-- <li>
            <a href="https://golearn.com.my/join-us" target="_blank">
              Visit GoLearn Tutor
            </a>
            </li> -->
          </ul>
          </nav>
          <!-- <div class="copyright float-right">
            &copy;
            <script>
              document.write(new Date().getFullYear())
            </script>
            , made with <i class="material-icons">favorite</i> by <a href="#" >GoLearn Team</a>
          </div> -->
          <!-- your footer here -->
        </div>
      </footer>
    </div>

  </div>


  <script src="../../assets/js/core/jquery.min.js"></script>
  <script src="../../assets/js/core/popper.min.js"></script>
  <script src="../../assets/js/core/bootstrap-material-design.min.js"></script>
  <script src="../../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!-- Plugin for the momentJs  -->
  <script src="../../assets/js/plugins/moment.min.js"></script>
  <!--  Plugin for the DateTimePicker, full documentation here: https://eonasdan.github.io/bootstrap-datetimepicker/ -->
  <script src="../../assets/js/plugins/bootstrap-datetimepicker.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="../../assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Material Dashboard -->
  <script src="../../assets/js/material-dashboard.js?v=2.1.2" type="text/javascript"></script>
  <!-- Common constants -->
  <script src="../../assets/js/common.js" type="text/javascript"></script>
  <!-- General Info -->
  <script src="../../assets/js/const.js" type="text/javascript"></script>
  <!-- Core Tutor Js -->
  <script src="../../assets/js/org-core.js" type="text/javascript"></script>
  <!-- Datepicker -->
  <script src="../../assets/js/mc-calendar.min.js" type="text/javascript"></script>
  <!-- ClockPicker -->
  <script type="text/javascript" src="../../assets/js/bootstrap-clockpicker.min.js"></script>
  <!-- Rating -->
  <script src="../../assets/js/star-rating.js" type="text/javascript"></script>
  <script src="../../assets/js/star-rating-theme.js" type="text/javascript"></script>
  <!-- Tag input -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js"></script>
  <script src="../../assets/js/tagsinput.js"></script>
  <!-- Generate pdf -->
  <script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>
  <!-- Color Picker -->
  <script src="../../assets/js/coloris.min.js" type="text/javascript"></script>
  <script>

    // Global var
    var gState ='';
    var gArea ='';
    var gLevel ='';
    var gSubject ='';
    var gOnlineOnly = false;
    var gStateName='';
    var gAreaName ='';
    var gLevelName = '';
    var gSubjectName = '';

    var categoryId= '';
    var category= '';
    var subjectId= '';
    var subject= '';
    var online = false;
    var imgUrl_temp = '';
    // Teacher 1 & 2
    var tutor1Id = '';
    var tutor2Id = '';
    var tutor1Name = '';
    var tutor2Name = '';
    var tutor1Phone = '';
    var tutor2Phone = '';
    // Time Slot
    var dayOfWeekArr = [];
    var startTimeArr = [];
    var endTimeArr = [];
    // Advanced
    var classTag = null;


    var latestLessonDoc = null;// Store last document - Used for Lesson Load More btn
    var latestStuDoc = null;// Store last document - Used for Student Load More btn
    var latestAdminStuDoc = null;// Store last document - Used for Admin's Student Load More btn in Add Student Modal
    var latestAdminTutorDoc = null;// Store last document - Used for Admin's Tutor Load More btn in Add Teacher Modal
    var tutorBtnNum; // used to differentiate btn Teacher 1 / 2

		// var db = firebase.firestore();
		// db.settings({ timestampsInSnapshots: true });

    // Check the current CLASS in session Storage - Valid only if user come from class.html
    var currentClassObj = null;
    const cid = new URL(window.location.href).searchParams.get("cid");

    getClassObj(cid);
    // getClassObject();

    // Initialization
    AuthCheck();

    // Page Specific Initialization
    function loadPageInitFunc(){

      // Set the first choice of tutor in Tutor modal
      initMyselfAsTutor();


    }

    function getClassObj(cid){

      if (cid == null || cid == ''){
        func.showNotification('top','center', 'danger', 'error_outline', "Error: No class id in params." );
        alert('Error: No class id in params.')
        window.location.href='./?url=' + orgUrl + "&ent=" + orgEnt;
      }
      else {
        let docRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .doc(cid);

        docRef.get().then((doc) => {
          if (doc.exists) {

            console.log(doc.data())
            // Store in lacal variable
            currentClassObj = doc.data()

            // Init variable
            categoryId = doc.data()[CLASS_CATEGORY_ID_KEY];
            category = doc.data()[CLASS_CATEGORY_KEY];
            subjectId = doc.data()[CLASS_SUBJECT_ID_KEY];
            subject = doc.data()[CLASS_SUBJECT_KEY];
            online = doc.data()[CLASS_ONLINE_KEY];
            gState = doc.data()[CLASS_STATE_ID_KEY];
            gStateName = doc.data()[CLASS_STATE_KEY];
            gArea = doc.data()[CLASS_AREA_ID_KEY];
            gAreaName = doc.data()[CLASS_AREA_KEY];
            imgUrl_temp = doc.data()[CLASS_IMG_URL];
            classTag = doc.data()[CLASS_TAG];

            updatePageContent(doc.data())

            // Load Lessons
            LoadLessonInfo();


            // Load all students
            loadAllStudents();

          }
          else {
            func.showNotification('top','center', 'danger', 'error_outline', "Error: No such class." );
            alert('Error: No such class.')
            window.location.href='./?url=' + orgUrl + "&ent=" + orgEnt;

          }
        })
      }
    }

    function getClassObject(){
      // Check if there are valid class data in session storage.
      if (JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLASS_CURRENT_DOC_KEY)) == null ||
        JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLASS_CURRENT_DOC_KEY)).id == null ||
        JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLASS_CURRENT_DOC_KEY)).id == '' ){
        // Return to class.html if invalid class obj
        func.showNotification('top','center', 'danger', 'error_outline', "Error: No class selected." );
        window.location.href='./';

      }else{
        // Set the fields
        currentClassObj = JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLASS_CURRENT_DOC_KEY));
        // console.log("currentClassObj");
        // console.log(currentClassObj);
        updatePageContent(currentClassObj);

        // If user is NOT the admin of this class, disable non admin edits
        // console.log('SESSION_STORAGE_CLASS_NON_ADMIN_KEY')
        // console.log(JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLASS_NON_ADMIN_KEY)));

        if (JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLASS_NON_ADMIN_KEY))){
          disableAllEditsForNonAdmin();
        }

      }
    }

    function updatePageContent(data){
      // Title
      document.getElementById("titleClassName").textContent = data[CLASS_NAME];

      // Lesson Panel
      document.getElementById("inClassAnnouncement").value = data[CLASS_ANNOUNCEMENT];

      // General Panel
      document.getElementById("inClassName").value = data[CLASS_NAME];
      document.getElementById("countClassName").textContent = data[CLASS_NAME].length + '/40'
      document.getElementById("tutorImgUrl").src = data[CLASS_IMG_URL] == null || data[CLASS_IMG_URL] == '' ?  '../../assets/img/empty-photo.png' : data[CLASS_IMG_URL];
      document.getElementById("inClassDesc").value = data[CLASS_DESC];
      document.getElementById("countClassDesc").textContent = data[CLASS_DESC].length + '/400'
      document.getElementById("inVenue").value = data[CLASS_VENUE];
      document.getElementById("countClassVenue").textContent = data[CLASS_VENUE].length + '/250'
      document.getElementById("inUrlClass").value = data[CLASS_CLASS_URL];

      if (isValidHttpUrl(data[CLASS_CLASS_URL])){
        let uri = checkDomainNameException(data[CLASS_CLASS_URL])
        document.getElementById("inUrlClassIcon").src = uri;
        document.getElementById("inUrlClassIconWrapper").setAttribute("onclick", "RedirectTo('"+data[CLASS_CLASS_URL]+"')");
      }else{
        document.getElementById("inUrlClassIcon").src = "../../assets/img/broken-link.png";
        document.getElementById("inUrlClassIconWrapper").setAttribute("onclick", "");
      }

      document.getElementById("inUrlGroup").value = data[CLASS_CHAT_GROUP_URL];
      if (isValidHttpUrl(data[CLASS_CHAT_GROUP_URL])){
        let uri = checkDomainNameException(data[CLASS_CHAT_GROUP_URL])
        document.getElementById("inUrlGroupIcon").src = uri;
        document.getElementById("inUrlGroupIconWrapper").setAttribute("onclick", "RedirectTo('"+data[CLASS_CHAT_GROUP_URL]+"')");
      }else{
        document.getElementById("inUrlGroupIcon").src = "../../assets/img/broken-link.png";
        document.getElementById("inUrlGroupIconWrapper").setAttribute("onclick", "");
      }

      document.getElementById("inUrlMaterial").value = data[CLASS_MATERIAL_URL];
      if (isValidHttpUrl(data[CLASS_MATERIAL_URL])){
        let uri = checkDomainNameException(data[CLASS_MATERIAL_URL])
        document.getElementById("inUrlMaterialIcon").src = uri;
        document.getElementById("inUrlMaterialIconWrapper").setAttribute("onclick", "RedirectTo('"+data[CLASS_MATERIAL_URL]+"')");
      }else{
        document.getElementById("inUrlMaterialIcon").src = "../../assets/img/broken-link.png";
        document.getElementById("inUrlMaterialIconWrapper").setAttribute("onclick", "");
      }


      // Time Slot Panel
      // Remove second and above time slot
      clearTimeSlot();
      if (data[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][0] == null || data[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][0] == ""){
        // Someone removed the first Day of Week. So do nothing here
      }else {
        // $('#inDayOfWeek1').find('option[value='+data[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][0]+']').attr('selected','selected');
        document.getElementById('inDayOfWeek1').value = data[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][0];
      }
      document.getElementById("inStartTime1").value = data[CLASS_TIMESLOT_START_ARR][0];
      document.getElementById("inEndTime1").value = data[CLASS_TIMESLOT_END_ARR][0];
      // console.log(CLASS_TIMESLOT_DAY_OF_WEEK_ARR)
      // console.log(CLASS_TIMESLOT_DAY_OF_WEEK_ARR.length)
      if (data[CLASS_TIMESLOT_DAY_OF_WEEK_ARR].length > 1){
        // Add time slot
        for (let i = 1; i<data[CLASS_TIMESLOT_DAY_OF_WEEK_ARR].length; i++){
          addTimeSlot(data[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][i], data[CLASS_TIMESLOT_START_ARR][i], data[CLASS_TIMESLOT_END_ARR][i]);
        }
      }
      initTimePicker();

      let tutor1ImgUrlInvalid = tutorImgUrlChecker(data[CLASS_TUTOR_IMG_URL_ARR][0]);
      let tutor2ImgUrlInvalid = tutorImgUrlChecker(data[CLASS_TUTOR_IMG_URL_ARR][1]);

      // Check if img is valid. If no, create a 2 chars avatar
      if (data[CLASS_TUTOR_IMG_URL_ARR][0] == null || data[CLASS_TUTOR_IMG_URL_ARR][0] == "" || tutor1ImgUrlInvalid){
        let AvatarText = data[CLASS_TUTOR_NAME_ARR][0][0] + data[CLASS_TUTOR_NAME_ARR][0][1];
        document.getElementById("inTutor1ImgUrl").src = generateAvatar(AvatarText, "#eaeaea", "#f6f6f6", "100px");
      }
      else {
        document.getElementById("inTutor1ImgUrl").src = data[CLASS_TUTOR_IMG_URL_ARR][0];
      }

      // document.getElementById("inTutor1ImgUrl").src = data[CLASS_TUTOR_IMG_URL_ARR][0];
      document.getElementById("inTutor1Name").value = data[CLASS_TUTOR_NAME_ARR][0];
      document.getElementById("inTutor1Phone").value = data[CLASS_TUTOR_PHONE_ARR][0];
      document.getElementById("inTutor1Name").setAttribute("data-tutor1Id", data[CLASS_TUTOR_ID_ARR][0]);
      tutor1Id = data[CLASS_TUTOR_ID_ARR][0];
      tutor1Name = data[CLASS_TUTOR_NAME_ARR][0];
      tutor1Phone = data[CLASS_TUTOR_PHONE_ARR][0];


      if (data[CLASS_TUTOR_ID_ARR][1] == null || data[CLASS_TUTOR_ID_ARR][1] == ''){
        document.getElementById("inTutor2ImgUrl").src = '../../assets/img/empty-photo.png';
        document.getElementById("inTutor2Name").value = '';
        document.getElementById("inTutor2Phone").value = '';
        document.getElementById("inTutor2Name").setAttribute("data-tutor2Id", '');
      }else{
        // Check if second tutor img is valid. If no, create a 2 chars avatar
        if (data[CLASS_TUTOR_IMG_URL_ARR][1] == null || data[CLASS_TUTOR_IMG_URL_ARR][1] == "" || tutor2ImgUrlInvalid){
          let AvatarText = data[CLASS_TUTOR_NAME_ARR][1][0] + data[CLASS_TUTOR_NAME_ARR][1][1];
          document.getElementById("inTutor2ImgUrl").src = generateAvatar(AvatarText, "#eaeaea", "#f6f6f6", "100px");
        }
        else {
          document.getElementById("inTutor2ImgUrl").src = data[CLASS_TUTOR_IMG_URL_ARR][1];
        }

        // document.getElementById("inTutor2ImgUrl").src = data[CLASS_TUTOR_IMG_URL_ARR][1];
        document.getElementById("inTutor2Name").value = data[CLASS_TUTOR_NAME_ARR][1];
        document.getElementById("inTutor2Phone").value = data[CLASS_TUTOR_PHONE_ARR][1];
        document.getElementById("inTutor2Name").setAttribute("data-tutor2Id", data[CLASS_TUTOR_ID_ARR][1]);
      }

      tutor2Id = data[CLASS_TUTOR_ID_ARR][1];
      tutor2Name = data[CLASS_TUTOR_NAME_ARR][1];
      tutor2Phone = data[CLASS_TUTOR_PHONE_ARR][1];

      // Enable changes to Tutor 1 and 2
      // if (current_accountStatus === PREMIUM_ACCOUNT_2_STATUS_KEY || current_accountStatus === PREMIUM_ACCOUNT_3_STATUS_KEY){
        document.getElementById("btnAddTeacher1").setAttribute("data-toggle", "modal");
        // document.getElementById("btnAddTeacher1").setAttribute("data-target", "#myTeacherModal");
        document.getElementById("btnAddTeacher1").setAttribute("style", "pointer-events: fill; background-color: #fff;");
        document.getElementById("btnAddTeacher2").setAttribute("data-toggle", "modal");
        document.getElementById("btnAddTeacher2").setAttribute("style", "pointer-events: fill; background-color: #fff;");
      // }else {
      //   document.getElementById("btnAddTeacher1").setAttribute("data-toggle", "");
      //   document.getElementById("btnAddTeacher2").setAttribute("data-toggle", "");
      // }

      // Fee Panel
      document.getElementById("inFee").value = data[FEES_KEY];
      document.getElementById("feeTypePerMonthRadio").checked = data[FEES_TYPE_KEY] === FEES_TYPE_PER_MONTH_KEY ;
      document.getElementById("feeTypePerHourRadio").checked = data[FEES_TYPE_KEY] === FEES_TYPE_PER_HOUR_KEY ;

      // Admin Panel
      document.getElementById("inStudentLimit").value = data[CLASS_STUDENT_LIMIT];
      document.getElementById("onlineonly_check").checked = data[ONLINE_KEY];
      if (data[ONLINE_KEY]){
        document.getElementById("state_drop").disabled=true;
        document.getElementById("area_drop").disabled=true;
        document.getElementById("state_drop").style.backgroundColor = "#e9ecef" ;
        document.getElementById("area_drop").style.backgroundColor="#e9ecef" ;
      } else {
        document.getElementById("state_drop").disabled=false;
        document.getElementById("area_drop").disabled=false;
        document.getElementById("state_drop").style.backgroundColor = "#fff" ;
        document.getElementById("area_drop").style.backgroundColor="#fff" ;
      }

      let uriAdminId = encodeURIComponent(data[CLASS_ADMIN_ID]);
      let uriClassId = encodeURIComponent(data[CLASS_ID]);
      document.getElementById("classStatusRadioActive").checked = data[CLASS_STATUS] === CLASS_STATUS_ACTIVE ;
      document.getElementById("classStatusRadioInactive").checked = data[CLASS_STATUS] === CLASS_STATUS_INACTIVE ;
      document.getElementById("classTypeRadioPrivate").checked = data[CLASS_TYPE] === CLASS_TYPE_PRIVATE ;
      document.getElementById("classTypeRadioPublic").checked = data[CLASS_TYPE] === CLASS_TYPE_PUBLIC;
      if (data[CLASS_TYPE] === CLASS_TYPE_PUBLIC){
        document.getElementById("publicTab").style.display = 'flex';
      }else {
        document.getElementById("publicTab").style.display = 'none';
      }

      if (data[CLASS_TYPE] === CLASS_TYPE_PUBLIC){
        document.getElementById("levelSubjectTop").style.display = 'flex';
        document.getElementById("onlineOnlyTop").style.display = 'flex';
        document.getElementById("areaStateTop").style.display = 'flex';
      } else { //CLASS_TYPE_PRIVATE
        document.getElementById("levelSubjectTop").style.display = 'none';
        document.getElementById("onlineOnlyTop").style.display = 'none';
        document.getElementById("areaStateTop").style.display = 'none';
      }

      // *1000 because the input of new Date is miliseconds, firstore uses second instead.
      document.getElementById("firstClassDatePicker").value = (data[CLASS_FIRST_CLASS_DATE] == null || data[CLASS_FIRST_CLASS_DATE] == '') ? new Date(data[CLASS_DATE_ADD].seconds * 1000).toLocaleDateString("en-GB") : new Date(data[CLASS_FIRST_CLASS_DATE].seconds * 1000).toLocaleDateString("en-GB");
      document.getElementById("stuAutoJoinEn").checked = data[CLASS_STUDENT_AUTO_JOIN_ENABLE];
      document.getElementById("tAddEditLessonEn").checked = data[CLASS_TUTOR_ADD_EDIT_LESSON_ENABLE];
      document.getElementById("tDelLessonEn").checked = data[CLASS_TUTOR_REMOVE_LESSON_ENABLE];
      document.getElementById("inAutoJoinLink").value = 'https://org.golearn.com.my/online-registration.html?aid='+uriAdminId+'&cid='+uriClassId;
      if (data[CLASS_STUDENT_AUTO_JOIN_ENABLE]){
        document.getElementById("inAutoJoinLinkTop").style.display = 'initial';
        document.getElementById("btnAutoJoinLink2").className = "btn btn-success";
        document.getElementById("btnAutoJoinLink2").style.pointerEvents= 'auto';
        document.getElementById("inAutoJoinLink2").value = 'https://org.golearn.com.my/online-registration.html?aid='+uriAdminId+'&cid='+uriClassId;
      }else{
        document.getElementById("inAutoJoinLinkTop").style.display = 'none';
        document.getElementById("btnAutoJoinLink2").className = "btn btn-default";
        document.getElementById("btnAutoJoinLink2").style.pointerEvents= 'none';
        document.getElementById("inAutoJoinLink2").value = 'https://org.golearn.com.my/online-registration.html?aid='+uriAdminId+'&cid='+uriClassId;
      }

      if (data[CLASS_LABEL_ENABLE] == null || !data[CLASS_LABEL_ENABLE]){
        document.getElementById("inRibbonSettings").style.display = "none";
        document.getElementById("tAddRibbonEn").checked = false;
        document.getElementById("inLabelColor").value = data[CLASS_LABEL_COLOR];
        document.getElementById("inLabelText").value = data[CLASS_LABEL_TEXT] == null ? "" : data[CLASS_LABEL_TEXT];
        document.getElementById("inLabelSample").style.background = data[CLASS_LABEL_COLOR] == null ? "rgba(0, 0, 0, 0.2)" : data[CLASS_LABEL_COLOR];
        document.getElementById("inLabelSample").textContent = data[CLASS_LABEL_TEXT] == null ? "" : data[CLASS_LABEL_TEXT];
      }
      else {
        document.getElementById("inRibbonSettings").style.display = "";
        document.getElementById("tAddRibbonEn").checked = data[CLASS_LABEL_ENABLE];
        document.getElementById("inLabelColor").value = data[CLASS_LABEL_COLOR];
        document.getElementById("inLabelText").value = data[CLASS_LABEL_TEXT];
        document.getElementById("inLabelSample").style.background =  data[CLASS_LABEL_COLOR] == null ? "rgba(0, 0, 0, 0.2)" : data[CLASS_LABEL_COLOR];
        document.getElementById("inLabelSample").textContent = data[CLASS_LABEL_TEXT];
      }


      // Check if class status
      if (data[CLASS_STATUS] === CLASS_STATUS_INACTIVE){
        disableAllEdits();
      }

      // ------ Tag Start ------- //
      if (classTag != null){
        classTag.forEach((item) => {
          // console.log(item);
          $('#classTag').tagsinput('add', item, {preventPost: true});
        });
      }

      // ------ Education Level Dropdown Start ------- //
      // Populate Education Level
      var level_select = document.getElementById("level_drop");
      var level = Category;
      var catId = CategoryId;
      for (var i = 0; i < level.length; i++) {
        var opt = level[i];
        var el = document.createElement("option");
        el.setAttribute("value", catId[i]);
        el.textContent = opt;
        el.value = catId[i];
        // Update Level
        if (catId[i] === data[CLASS_CATEGORY_ID_KEY]) {
          el.selected = true;
        }
        level_select.appendChild(el);

      }

      // Update Subjects
      // Clear the area option first, except the first one. 50 is a just a huge number
      var subject_drop = document.getElementById("subject_drop");
        for(i=1; i <= 50; i++){
          subject_drop.remove(1);
        }
      // Load default selected subject and respective subject lists
      var subjectInfo = selectSubjectListBasedOnLevelId(data[CLASS_CATEGORY_ID_KEY]);// Get the subject info
      var optionsName = subjectInfo[0];
      var optionId = subjectInfo[1];

      if (!(data[CLASS_CATEGORY_ID_KEY] == null || data[CLASS_CATEGORY_ID_KEY] =='')){
        for (var i = 0; i < optionsName.length; i++) {
          var el = document.createElement("option");
          // el.setAttribute("value", "volvocar");
          el.textContent = optionsName[i];
          el.value = optionId[i];
          // Default selection based on existing class
          if (optionId[i] === data[CLASS_SUBJECT_ID_KEY]) {
            el.selected = true;
          }
          subject_drop.appendChild(el);
        }

      }

      // ------State Dropdown start------- //
      let state_select = document.getElementById("state_drop");
      let state = MYAllState;
      let stateId = MYAllStateId;
      for (let i = 0; i < state.length; i++) {
        let el = document.createElement("option");
        el.textContent = state[i];
        el.value = stateId[i];

        // Update State
        if (state[i] === data[STATE_KEY]) {
          el.selected = true;
        }
        state_select.appendChild(el);
      }

      // Update Area
      // Clear the area option first, except the first one. 100 is just a huge number
      let select_area = document.getElementById("area_drop");
      for(i=1; i <= 100; i++){
          select_area.remove(1);
      }

      if (!(data[CLASS_STATE_KEY] == null || data[CLASS_STATE_KEY] =='')){
        // let options = selectCityBasedOnState (data[STATE_KEY]);
        let cityInfo = selectCityListBasedOnStateId(data[CLASS_STATE_ID_KEY]);
        let cityName = cityInfo[0];
        let cityId = cityInfo[1];
        for (let i = 0; i < cityName.length; i++) {
            let el = document.createElement("option");
            el.textContent = cityName[i];
            el.value = cityId[i];
            // Default selection based on existing class
            if (cityName[i] === data[CLASS_AREA_KEY]) {
              el.selected = true;
            }
            select_area.appendChild(el);
        }
      }


    }

    // This function check the validity of imgUrl. Return true when invalid.
    function tutorImgUrlChecker(imgUrl){
      // Tutor Panel
      let isHelloGifExist = false ;
      let helloGifArr =  imgUrl.match(/hello.gif/gi)
      if ( helloGifArr != null) {
        if (helloGifArr.length > 0){
          isHelloGifExist = true;
        }
      }
      let isEmptyPhotoPngExist = false;
      let emptyPhotoPngArr = imgUrl.match(/empty-photo.png/gi)
      if ( emptyPhotoPngArr != null) {
        if (emptyPhotoPngArr.length > 0){
          isEmptyPhotoPngExist = true;
        }
      }
      let isGeneratedAvatar = false;
      let generatedAvatarArr = imgUrl.match(/data:image\/png;base64,/gi)
      if ( generatedAvatarArr != null) {
        if (generatedAvatarArr.length > 0){
          isGeneratedAvatar = true;
        }
      }

      if (isHelloGifExist || isEmptyPhotoPngExist || isGeneratedAvatar)
        return true;
      else
        return false;
    }


    //---------- Load all lessons details ----------//
    // Lesson Load More Button - Init
    const lessonLoadmore = document.querySelector('#btnLessonLoadMore');
    lessonLoadmore.style.visibility='hidden';
    const lessonLoadMoreHandleClick = () =>{
      // updateInfoAllActiveJob2();
      // alert('lessonLoadmore clicked')
      LoadLessonInfo();
    }
    lessonLoadmore.addEventListener('click', lessonLoadMoreHandleClick );

    //---------- Load all students details ----------//
    // Lesson Load More Button - Init
    const stuLoadmore = document.querySelector('#btnStudentLoadMore');
    stuLoadmore.style.visibility='hidden';
    const stuLoadMoreHandleClick = () =>{
      loadAllStudents();
    }
    stuLoadmore.addEventListener('click', stuLoadMoreHandleClick );

    //---------- Init All Admin's Student details ----------//
    // Lesson Load More Button - Init
    const stuAdminLoadmore = document.querySelector('#btnAddAdminStudentModalLoadMore');
    stuAdminLoadmore.style.visibility='hidden';

    const stuAdminLoadMoreHandleClick = () =>{
      loadAllAdminStudents();
    }
    stuAdminLoadmore.addEventListener('click', stuAdminLoadMoreHandleClick );

    //---------- Init All Admin's Teacher details ----------//
    // Lesson Load More Button - Init
    const tutorAdminLoadmore = document.querySelector('#btnAddTeacherModalLoadMore');
    tutorAdminLoadmore.style.visibility='hidden';

    const tutorAdminLoadMoreHandleClick = () =>{
      loadAllAdminTeachers(tutorBtnNum);
    }
    tutorAdminLoadmore.addEventListener('click', tutorAdminLoadMoreHandleClick );

    // Initialized page view
    function initMyselfAsTutor(){

      // // Update Myself in Add Teacher Modal
      // document.getElementById("viewTutorMySelfImgUrl").src = ent_imgUrl;
      // document.getElementById("viewTutorMySelfName").textContent = ent_name;
      // document.getElementById("viewTutorMySelfPhone").textContent = ent_phone;
      // document.getElementById("viewTutorMySelfAge").textContent = '-';
      // const btnSelectMyself = document.getElementById("btnSelectMyself");
      // btnSelectMyself.setAttribute('onclick', "AddNewTutorToDB("+ 0+", '"+ ent_id+"', `"+ent_name+"`, '"+ent_phone+"', `"+ent_imgUrl+"`)");

    }

    // Update Class
    function UpdateClass(classId){

      var docRef = db.collection("Class")
        .doc("v1")
        .collection("Class")
        .doc(classId);

      // Get date from firstClassDate
      let myDate = document.getElementById("firstClassDatePicker").value;
      myDate = myDate.split("/");
      let newDate = new Date( myDate[2], myDate[1] - 1, myDate[0]);

      var data = {
        // [CLASS_ID]: docRef.id,
        [CLASS_NAME]: document.getElementById("inClassName").value,
        [CLASS_IMG_URL]: imgUrl_temp,
        [CLASS_DESC]: document.getElementById("inClassDesc").value,
        [CLASS_CATEGORY_KEY]: category,
        [CLASS_CATEGORY_ID_KEY]: categoryId,
        [CLASS_SUBJECT_KEY]: subject,
        [CLASS_SUBJECT_ID_KEY]: subjectId,
        [CLASS_ONLINE_KEY]: document.getElementById("onlineonly_check").checked,
        [CLASS_STUDENT_LIMIT]: document.getElementById("inStudentLimit").value,
        [CLASS_FIRST_CLASS_DATE]: newDate,
        [CLASS_ANNOUNCEMENT]: document.getElementById("inClassAnnouncement").value,

        [CLASS_TYPE]: (document.getElementById("classTypeRadioPrivate").checked)? CLASS_TYPE_PRIVATE : CLASS_TYPE_PUBLIC,
        [CLASS_TAG]: $("#classTag").tagsinput('items'),
        [CLASS_STATUS]: (document.getElementById("classStatusRadioActive").checked)? CLASS_STATUS_ACTIVE : CLASS_STATUS_INACTIVE,
        [CLASS_VENUE]: document.getElementById("inVenue").value,
        [CLASS_CLASS_URL]: document.getElementById("inUrlClass").value,
        [CLASS_CHAT_GROUP_URL]: document.getElementById("inUrlGroup").value,
        [CLASS_MATERIAL_URL]: document.getElementById("inUrlMaterial").value,

        [CLASS_STATE_KEY]: gStateName,
        [CLASS_STATE_ID_KEY]: gState,
        [CLASS_AREA_KEY]: gAreaName,
        [CLASS_AREA_ID_KEY]: gArea,
        // Time slot
        [CLASS_TIMESLOT_DAY_OF_WEEK_ARR]: dayOfWeekArr,
        [CLASS_TIMESLOT_START_ARR]: startTimeArr,
        [CLASS_TIMESLOT_END_ARR]: endTimeArr,
        // Fee type
        [CLASS_FEES_KEY]: parseFloat(document.getElementById("inFee").value),
        [CLASS_FEES_PER_MONTH_KEY]: (document.getElementById("feeTypePerMonthRadio").checked)? parseFloat(document.getElementById("inFee").value) : parseFloat(document.getElementById("inFee").value * 2 * 4),
        [CLASS_FEES_TYPE_KEY]: (document.getElementById("feeTypePerMonthRadio").checked)? FEES_TYPE_PER_MONTH_KEY : FEES_TYPE_PER_HOUR_KEY,
        // Special Permission
        [CLASS_STUDENT_AUTO_JOIN_ENABLE]: (document.getElementById("stuAutoJoinEn").checked)? true : false,
        [CLASS_TUTOR_ADD_EDIT_LESSON_ENABLE]: (document.getElementById("tAddEditLessonEn").checked)? true : false,
        [CLASS_TUTOR_REMOVE_LESSON_ENABLE]: (document.getElementById("tDelLessonEn").checked)? true : false,
        [CLASS_LABEL_ENABLE]: (document.getElementById("tAddRibbonEn").checked)? true : false,
        [CLASS_LABEL_COLOR]: document.getElementById("inLabelColor").value,
        [CLASS_LABEL_TEXT]: document.getElementById("inLabelText").value,

        [CLASS_DATE_EDIT]: new Date(),
        [CLASS_EDIT_MSG]: 'Updated by '+ ent_name, // Update: CLASS_DATE_EDIT + CLASS_EDIT_MSG
        [STATUS_KEY]: true,

      }
      // console.log("Saving...")
      // console.log(data)

      docRef.update(data)
      .then(() => {
        // Reload the page view.
        // getClassObj(cid);

        func.showNotification('top','center', 'success', 'check_circle', "Class updated!" );
      })
      .catch((error) => {
        console.error("Error writing document: ", error);
      });


    }

    // Archive Class
    function ReactivateClass(classId){
      var docRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .doc(classId);

      var data = {
        // [CLASS_TYPE]: CLASS_TYPE_PRIVATE,
        [CLASS_STATUS]: CLASS_STATUS_ACTIVE,
        [CLASS_DATE_EDIT]:  new Date(),
        [CLASS_EDIT_MSG]: 'Re-activated by '+ org_name, // Update: CLASS_DATE_EDIT + CLASS_EDIT_MSG
        [STATUS_KEY]: true,
      }
      // console.log("Reactivating Class...")
      // console.log(data)

      docRef.update(data, { merge: true })
      .then(() => {

        return Promise.resolve( updateGeneralReportNum(ent_id, NUM_TYPE_CLASS, 'asc', 1) )

      })
      .then(() => {
        window.location.href='./history.html?url=' + orgUrl + "&ent=" + orgEnt;
      });


    }

    // Delete Class
    function DeleteClass(classId){
      // Delete all class_student
      // Delete all lesson
      // Delete class

      var lessonDocRef = db.collection("Class")
          .doc("v1")
          .collection("Lesson")
          .where(LESSON_CLASS_ID, "==", currentClassObj[CLASS_ID])

      var classStudentDocRef = db.collection("Class")
          .doc("v1")
          .collection("Class_Student")
          .where(CLASS_STUDENT_CLASS_ID, "==", currentClassObj[CLASS_ID])

      var promiseAll = []
      promiseAll.push(lessonDocRef.get())
      promiseAll.push(classStudentDocRef.get())

      Promise.all(promiseAll).then((snapshots) => {

        var promiseAll = []
        var pathArr = []
        // console.log(snapshots[0].size)
        // console.log(snapshots[0].length)
        // console.log(snapshots[0].empty)

        if (snapshots[0] != null && snapshots[0].size > 0){
          snapshots[0].forEach((doc) => {
            console.log(doc.data())

            let lessonDocRef = db.collection("Class")
              .doc("v1")
              .collection("Lesson")
              .doc(doc.id);
            promiseAll.push(lessonDocRef.delete())
            pathArr.push(lessonDocRef.path)
          })
        }

        if (snapshots[1] != null && snapshots[1].size > 0){
          snapshots[1].forEach((doc) => {
            console.log(doc.data())

            let classStudentDocRef = db.collection("Class")
              .doc("v1")
              .collection("Class_Student")
              .doc(doc.id);

            promiseAll.push(classStudentDocRef.delete())
            pathArr.push(classStudentDocRef.path)

          })
        }

        let classDocRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .doc(classId)

        promiseAll.push(classDocRef.delete())
        pathArr.push(classDocRef.path)

        console.log(pathArr)

        return Promise.all(promiseAll)

      })
      .then(() => {
        window.location.href='./history.html?url=' + orgUrl + "&ent=" + orgEnt;
      })
      .catch((e) => {

        console.log(e.message)
      })

      // docRef.set(data, { merge: true })
      // .then(() => {

      //   return Promise.resolve( updateGeneralReportNum(ent_id, NUM_TYPE_CLASS, 'desc', 1) )

      // })
      // .then(() => {
      //   window.location.href='./?url=' + orgUrl + "&ent=" + orgEnt;
      // });


    }


    // Add Time Slot
    function addTimeSlot(dayOfWeekVal, startTime, endTime){
      var x = document.getElementById("timeSlot-container").childElementCount;

      let dayOfWeek_form_label = document.createElement('span');
      dayOfWeek_form_label.className = "";
      dayOfWeek_form_label.textContent = "Day of Week";
      dayOfWeek_form_label.setAttribute("style", "font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;");

      // let blogsHtml_dayOfWeek = '';
      // blogsHtml_dayOfWeek += "<option value=''>Select Day Of Week</option><option value='mon'>Monday</option><option value='tue'>Tuesday</option><option value='wed'>Wednesday</option><option value='thu'>Thursday</option><option value='fri'>Friday</option><option value='sat'>Saturday</option><option value='sun'>Sunday</option>";
      let dayOfWeek_form_input = document.createElement('select');
      // dayOfWeek_form_input.innerHTML = blogsHtml_dayOfWeek;
      dayOfWeek_form_input.className = "form-control";
      dayOfWeek_form_input.selected = dayOfWeekVal;
      dayOfWeek_form_input.setAttribute("data-compulsory", "true");
      dayOfWeek_form_input.setAttribute("oninput", "this.className = 'form-control'");
      dayOfWeek_form_input.setAttribute("id", "DayOfWeek" + (x+1));
      let myDayOfWeekId = MyDayOfWeekId;
      let myDayOfWeek = MyDayOfWeek;
      // First items
      let el = document.createElement("option");
      el.textContent = 'Select Day Of Week';
      el.value = '';
      dayOfWeek_form_input.appendChild(el);
      //Create Mon - Sun options
      for (var i = 0; i < myDayOfWeekId.length; i++) {
        let el = document.createElement("option");
        el.textContent = myDayOfWeek[i];
        el.value = myDayOfWeekId[i];
        // Set default selection
        if (dayOfWeekVal === myDayOfWeekId[i]){
          el.selected =  true;
        }

        dayOfWeek_form_input.appendChild(el);
      }

      let dayOfWeek_form_div = document.createElement('div');
      dayOfWeek_form_div.className = "form-group bmd-form-group";
      dayOfWeek_form_div.appendChild(dayOfWeek_form_label)
      dayOfWeek_form_div.appendChild(dayOfWeek_form_input)
      let dayOfWeek_div = document.createElement('div');
      dayOfWeek_div.className = "col-md-5";
      dayOfWeek_div.appendChild(dayOfWeek_form_div)

      // Start Time
      let startTime_form_label = document.createElement('span');
      startTime_form_label.className = "";
      startTime_form_label.textContent = "Start Time";
      startTime_form_label.setAttribute("style", "font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;");

      let startTime_form_input = document.createElement('input');
      startTime_form_input.type = "text";
      startTime_form_input.className = "form-control";
      startTime_form_input.value = startTime;
      startTime_form_input.setAttribute("id", "StartTime" + (x+1));
      startTime_form_input.setAttribute("style", "cursor: not-allowed; pointer-events: none;");
      // startTime_form_input.setAttribute("value", "");
      startTime_form_input.setAttribute("data-compulsory", "true");
      startTime_form_input.setAttribute("oninput", "this.className = 'form-control'");

      let blogsHtml_startTimeIcon = '';
      blogsHtml_startTimeIcon += "<span class='material-icons'>more_time</span>";
      let startTime_span = document.createElement('span');
      startTime_span.innerHTML = blogsHtml_startTimeIcon;
      startTime_span.className = "d-flex align-items-center input-group-addon"

      let startTime_form_input_div = document.createElement('div');
      startTime_form_input_div.type = "text";
      startTime_form_input_div.className = "input-group clockpicker";
      startTime_form_input_div.setAttribute("data-placement", "bottom");
      startTime_form_input_div.setAttribute("data-align", "top");
      startTime_form_input_div.setAttribute("data-autoclose", "true");
      startTime_form_input_div.setAttribute("style", "margin-top: 0.3rem;");
      startTime_form_input_div.appendChild(startTime_form_input)
      startTime_form_input_div.appendChild(startTime_span)

      let startTime_form_div = document.createElement('div');
      startTime_form_div.className = "form-group bmd-form-group";
      startTime_form_div.appendChild(startTime_form_label)
      startTime_form_div.appendChild(startTime_form_input_div)
      let startTime_div = document.createElement('div');
      startTime_div.className = "col-md-3";
      startTime_div.appendChild(startTime_form_div)

      let endTime_form_label = document.createElement('span');
      endTime_form_label.className = "";
      endTime_form_label.textContent = "End Time";
      endTime_form_label.setAttribute("style", "font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;");

      // <div class="input-group clockpicker" data-placement="right" data-align="top" data-autoclose="true" style="margin-top: 0.3rem;">
      //   <input type="text" class="form-control" value="13:30" id="">
      // </div>

      let endTime_form_input = document.createElement('input');
      endTime_form_input.type = "text";
      endTime_form_input.className = "form-control";
      endTime_form_input.value = endTime;
      endTime_form_input.setAttribute("id", "EndTime" + (x+1));
      endTime_form_input.setAttribute("style", "trcursor: not-allowed; pointer-events: none;ue");
      // endTime_form_input.setAttribute("value", "");
      endTime_form_input.setAttribute("data-compulsory", "true");
      endTime_form_input.setAttribute("oninput", "this.className = 'form-control'");

      let blogsHtml_endTimeIcon = '';
      blogsHtml_endTimeIcon += "<span class='material-icons'>more_time</span>";
      let endTime_span = document.createElement('span');
      endTime_span.innerHTML = blogsHtml_endTimeIcon;
      endTime_span.className = "d-flex align-items-center input-group-addon"

      let endTime_form_input_div = document.createElement('div');
      endTime_form_input_div.type = "text";
      endTime_form_input_div.className = "input-group clockpicker";
      endTime_form_input_div.setAttribute("data-placement", "bottom");
      endTime_form_input_div.setAttribute("data-align", "top");
      endTime_form_input_div.setAttribute("data-autoclose", "true");
      endTime_form_input_div.setAttribute("style", "margin-top: 0.3rem;");
      endTime_form_input_div.appendChild(endTime_form_input)
      endTime_form_input_div.appendChild(endTime_span)

      let endTime_form_div = document.createElement('div');
      endTime_form_div.className = "form-group bmd-form-group";
      endTime_form_div.appendChild(endTime_form_label)
      endTime_form_div.appendChild(endTime_form_input_div)
      let endTime_div = document.createElement('div');
      endTime_div.className = "col-md-3";
      endTime_div.appendChild(endTime_form_div)

      let blogsHtml_btn = '';
      blogsHtml_btn += "<i class='material-icons' style='color: red;'>remove</i>";
      let btnRemove_a = document.createElement('a');
      btnRemove_a.innerHTML = blogsHtml_btn;
      btnRemove_a.className = "btn btn-sm btn-outline-danger btn-round"
      btnRemove_a.setAttribute("id", "btnRemoveTimeSlot" + (x+1))
      btnRemove_a.setAttribute("onclick", "removeTimeSlot("+(x+1)+")")
      let btnRemove_div = document.createElement('div');
      btnRemove_div.className = "col-md-1  d-flex align-items-center";
      btnRemove_div.appendChild(btnRemove_a)

      let timeSlotTop_div = document.createElement('div');
      timeSlotTop_div.setAttribute("id", "timeSlot-"+(x+1));
      timeSlotTop_div.setAttribute("style", "padding: 0rem 3rem 0rem 0rem; border: solid #2e74b6; border-width: thin; margin-top: 1rem;");
      timeSlotTop_div.className = "row"
      timeSlotTop_div.appendChild(dayOfWeek_div)
      timeSlotTop_div.appendChild(startTime_div)
      timeSlotTop_div.appendChild(endTime_div)
      timeSlotTop_div.appendChild(btnRemove_div)

      const timeSlot_container = document.getElementById("timeSlot-container");
      timeSlot_container.appendChild(timeSlotTop_div);

    }

    // Get Time Slot Data
    function getAllTimeSlots() {
      dayOfWeekArr = [];
      startTimeArr = [];
      endTimeArr = [];
      // This function deals with validation of the form fields with data-compulsory = 'true'
      var x, y, i, valid = true;
      x = document.getElementById("timeSlotTop");
      // console.log(x)
      // y = x[activePanelNum].getElementsByTagName("input") && x[activePanelNum].querySelectorAll('[type="text"]');
      y =x.querySelectorAll('[data-compulsory="true"]');

      // A loop that checks every input field in the current tab:
      for (i = 0; i < y.length; i++) {

        if (i % 3 === 0){
          dayOfWeekArr.push(y[i].value)
        }
        if (i % 3 === 1){
          startTimeArr.push(y[i].value)
        }
        if (i % 3 === 2){
          endTimeArr.push(y[i].value)
        }


        // If a field is empty...
        if (y[i].value == "") {
          // add an "invalid" class to the field:
          // y[i].className += " invalid";
          // and set the current valid status to false:
          valid = false;
        }
      }

      // console.log(dayOfWeekArr)
      // console.log(startTimeArr)
      // console.log(endTimeArr)
      return valid; // return the valid status
    }


    // Remove Time Slot
    function removeTimeSlot(id){
      $( "#timeSlot-"+id ).remove();
    }

    // Remove second and above Time Slot
    function clearTimeSlot(){
      var timeSlotContainerChildCount = document.getElementById("timeSlot-container").childElementCount;
      var timeSlotContainer = document.getElementById("timeSlot-container").children;

      // console.log(timeSlotContainer);
      Array.from(timeSlotContainer).forEach((row, index) => {

        if (index > 0){
          row.remove();
        }
        // console.log(row);
        // console.log(index);
      });

    }

    // Add a new lesson item

    function addLesson(type='NEW', doc, lessonId){
      // <div class="row lesson-wrapper">
      //   <div class="col-md-11" >
      //     <div class="row">
      //       <div class="col-md-4 lesson-active" data-toggle="modal" data-target="#editLessonModal">
      //         <div class="row">
      //           <div class="col-4">
      //             <p class="lesson-item" style="font-weight: 400;">12/6/2022</p>
      //           </div>
      //           <div class="col-8">
      //             <p class="lesson-item" style="font-weight: 400;">11:00AM - 12:00AM</p>
      //           </div>
      //         </div>
      //       </div>
      //       <div class="col-md-4 lesson-active" data-toggle="modal" data-target="#editLessonModal">
      //           <p class="lesson-item">Announcement Text Here Please complete your homework before today. Pls bring color pensil and eraser to class next monday</p>
      //       </div>
      //       <div class="col-md-4 lesson-active" data-toggle="modal" data-target="#editLessonModal">
      //         <div class="lesson-item">
      //           <span style="font-size: small; font-weight:600;">5 <i class="fas fa-star" style="color: #FF9529;"></i></span>
      //           <span class="lesson-item">Feedback Text Here Alice is very talkertive. need more attention. Overall the class is good. Students interact actively with teacher. </span>
      //         </div>
      //       </div>
      //     </div>
      //   </div>
      // </div>
      // Type:
      // 'NEW' - Add a new lesson
      // 'LOAD' - Load data from doc.

      //
      let date_item_p = document.createElement('p');
      date_item_p.className = "lesson-item";
      date_item_p.setAttribute("style", "font-weight: 400;")
      if (type == 'NEW'){
        date_item_p.textContent = document.getElementById("datepicker").value;
      }else if (type == 'LOAD'){
        date_item_p.textContent = doc.data()[LESSON_DATE ].toDate().toLocaleDateString("en-GB");
      }
      let date_item_div = document.createElement('div');
      date_item_div.className = "col-md-4";
      date_item_div.appendChild(date_item_p);

      let start_item_p = document.createElement('p');
      start_item_p.className = "lesson-item";
      start_item_p.setAttribute("style", "font-weight: 400;")


      // For loading purposes
      let startTime = "";
      let endTime = "";
      let timeslot = "";

      if (type == 'NEW'){
        startTime = document.getElementById("addLessonStart").value;
        endTime = document.getElementById("addLessonEnd").value;
        startTime = tConvert (startTime);
        // startTime = (parseInt(startTime.substring(0, 2))>12) ? (parseInt(startTime.substring(0, 2)) - 12) + startTime.substring(2, 5) + 'PM' : startTime + 'AM';
        endTime = tConvert (endTime);
        // endTime = (parseInt(endTime.substring(0, 2))>12) ? (parseInt(endTime.substring(0, 2)) - 12) + endTime.substring(2, 5) + 'PM' : endTime + 'AM';
        timeslot = startTime+' - '+endTime;
        start_item_p.textContent = timeslot;

      }else if (type == 'LOAD'){
        startTime = doc.data()[LESSON_START];
        endTime = doc.data()[LESSON_END];
        startTime = tConvert (startTime);
        // startTime = (parseInt(startTime.substring(0, 2))>12) ? (parseInt(startTime.substring(0, 2)) - 12) + startTime.substring(2, 5) + 'PM' : startTime + 'AM';
        endTime = tConvert (endTime);
        // endTime = (parseInt(endTime.substring(0, 2))>12) ? (parseInt(endTime.substring(0, 2)) - 12) + endTime.substring(2, 5) + 'PM' : endTime + 'AM';
        timeslot = startTime+' - '+endTime;
        start_item_p.textContent = timeslot;
      }

      let start_item_div = document.createElement('div');
      start_item_div.className = "col-md-8";
      start_item_div.appendChild(start_item_p);

      let time_div = document.createElement('div');
      time_div.className = "row"
      time_div.appendChild(date_item_div);
      time_div.appendChild(start_item_div);
      // time_div.appendChild(end_item_div);

      let time_top_div = document.createElement('div');
      time_top_div.className = "col-md-4 lesson-active"
      time_top_div.appendChild(time_div);

      let description = (doc.data()[LESSON_DESC] == null || doc.data()[LESSON_DESC] == "") ? "No notes" : doc.data()[LESSON_DESC];
      let desc_p = document.createElement('p');
      desc_p.className = "lesson-item";
      desc_p.setAttribute("style", "word-wrap: break-word;")
      if (type == 'NEW'){
        desc_p.textContent =  document.getElementById("addLessonDesc").value
      }else if (type == 'LOAD'){
        desc_p.textContent = description;
      }
      let desc_top_div = document.createElement('div');
      desc_top_div.className = "col-md-4 lesson-active"
      // desc_top_div.setAttribute('data-toggle', 'modal');
      // desc_top_div.setAttribute('data-target', '#editLessonModal');
      desc_top_div.appendChild(desc_p);

      // Feedback
      let ratingSpanHtml ="";
      if (doc.data()[LESSON_RATE] == null || isNaN(doc.data()[LESSON_RATE]) || doc.data()[LESSON_RATE] == 0){
        ratingSpanHtml = "<i class='fas fa-star' style='color: #ff9529;''></i> ";
      }else {
        ratingSpanHtml = doc.data()[LESSON_RATE] + " <i class='fas fa-star' style='color: #ff9529;'></i> ";
      }
      let ratingSpan = document.createElement('span');
      ratingSpan.setAttribute("style", "font-size: small; font-weight:600;");
      ratingSpan.innerHTML = ratingSpanHtml;

      let feedback = (doc.data()[LESSON_FEEDBACK] == null || doc.data()[LESSON_FEEDBACK] == "") ? "" : doc.data()[LESSON_FEEDBACK];
      let feedback_item_p = document.createElement('span');
      feedback_item_p.className = "lesson-item";
      feedback_item_p.setAttribute("style", "word-wrap: break-word;")
      if (type == 'NEW'){
        feedback_item_p.textContent = document.getElementById("addLessonFeedback").value;
      }else if (type == 'LOAD'){
        feedback_item_p.textContent = feedback;
      }

      let feedback_item_div = document.createElement('div');
      feedback_item_div.className = "lesson-item";
      feedback_item_div.appendChild(ratingSpan);
      feedback_item_div.appendChild(feedback_item_p);

      let feedback_top_div = document.createElement('div');
      feedback_top_div.className = "col-md-4 lesson-active";
      feedback_top_div.appendChild(feedback_item_div);

      let edit_wrapper = document.createElement('div');
      edit_wrapper.className = "row"
      edit_wrapper.appendChild(time_top_div);
      edit_wrapper.appendChild(desc_top_div);
      edit_wrapper.appendChild(feedback_top_div);
      let edit_wrapper_top = document.createElement('div');
      edit_wrapper_top.className = "col-md-11"
      edit_wrapper_top.setAttribute('data-toggle', 'modal');
      edit_wrapper_top.setAttribute('data-target', '#editLessonModal');
      if (type == 'NEW'){
        edit_wrapper_top.setAttribute('data-id', lessonId);
        edit_wrapper_top.setAttribute('data-date', document.getElementById("datepicker").value);
        edit_wrapper_top.setAttribute('data-start', document.getElementById("addLessonStart").value);
        edit_wrapper_top.setAttribute('data-end', document.getElementById("addLessonEnd").value);
        edit_wrapper_top.setAttribute('data-desc', document.getElementById("addLessonDesc").value);
        edit_wrapper_top.setAttribute('data-feedback', document.getElementById("addLessonFeedback").value);
        edit_wrapper_top.setAttribute('data-rate', document.getElementById("addLessonRate").value);
      }else if (type == 'LOAD'){
        edit_wrapper_top.setAttribute('data-id', doc.data()[LESSON_ID]);
        edit_wrapper_top.setAttribute('data-date', doc.data()[LESSON_DATE].toDate().toLocaleDateString("en-GB"));
        edit_wrapper_top.setAttribute('data-start', doc.data()[LESSON_START]);
        edit_wrapper_top.setAttribute('data-end', doc.data()[LESSON_END]);
        edit_wrapper_top.setAttribute('data-desc', doc.data()[LESSON_DESC]);
        edit_wrapper_top.setAttribute('data-feedback', doc.data()[LESSON_FEEDBACK]);
        edit_wrapper_top.setAttribute('data-rate', doc.data()[LESSON_RATE]);
      }

      edit_wrapper_top.appendChild(edit_wrapper);

      // Button
      let btn_html = '';
      btn_html += "<i class='material-icons' style='color: red;''>remove</i>";
      let btn_a = document.createElement('a');
      btn_a.className = "btn btn-sm btn-outline-danger btn-round";
      btn_a.setAttribute('id', "btnRemoveTimeSlot");
      btn_a.setAttribute('href', "#");
      btn_a.setAttribute('data-toggle', 'modal');
      btn_a.setAttribute('data-target', '#delLessonModal');
      btn_a.setAttribute('data-id', doc.data().id);
      btn_a.setAttribute('data-lessondate', doc.data().lesDate.toDate().toLocaleDateString("en-GB"));

      btn_a.innerHTML= btn_html;

      let btn_top_div = document.createElement('div');
      btn_top_div.className = "col-md-1"
      btn_top_div.appendChild(btn_a);

      let wrapper_div = document.createElement('div');
      wrapper_div.className = "row lesson-wrapper";
      wrapper_div.appendChild(edit_wrapper_top);
      wrapper_div.appendChild(btn_top_div);


      const lesson_container = document.getElementById("lesson-container");
      lesson_container.appendChild(wrapper_div);

    }

    // Load Lesson Details
    function LoadLessonInfo(){
      let today = new Date(2100, 12, 31);// Set a big date
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Lesson")
          .where("classId", "==", currentClassObj[CLASS_ID])
          .where("status", "==", true)
          .orderBy('lesDate', 'desc')
          .startAfter(latestLessonDoc || today)
          .limit(10);

      docRef
      .get()
      .then((querySnapshot) => {
        // console.log('Total Lessons Found: '+querySnapshot.docs.length);

        if ((querySnapshot.docs.length== null || querySnapshot.docs.length == 0) && latestLessonDoc == null){
          document.getElementById("lessonNoDataPlaceholder").style.display = 'initial';
        }else {
          document.getElementById("lessonNoDataPlaceholder").style.display = 'none';
        }
        querySnapshot.forEach((doc) => {
          // console.log(doc.data());
          // latestLessonDoc = doc.data()[LESSON_DATE];
          // console.log(latestLessonDoc);

          // Due to limitation, Do a secondary filter at client side based on the status.
          // if (doc.data()[LESSON_STATUS])
          addLesson(type='LOAD', doc, '');


        });

        latestLessonDoc = querySnapshot.docs[querySnapshot.docs.length - 1];
        // console.log(querySnapshot.docs.length)
        // Handle Lesson Load more btn
        if (querySnapshot.empty){
          lessonLoadmore.removeEventListener('click', lessonLoadMoreHandleClick );
        }
        if (querySnapshot.docs.length == 10){
          lessonLoadmore.style.visibility='visible';
        }else{
          lessonLoadmore.style.visibility='hidden';
        }


      }).catch((error) => {
          console.log("Error getting document:", error);
      });

    }


    // Add New Lesson
    function UploadToDBLesson(){
      var docRef = db.collection("Class")
          .doc("v1")
          .collection("Lesson")
          .doc();

      // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
      let myDate = document.getElementById("datepicker").value;
      myDate = myDate.split("/");
      let newDate = new Date( myDate[2], myDate[1] - 1, myDate[0]);
      // console.log(newDate)
      let myTimestamp = firebase.firestore.Timestamp.fromDate(newDate);
      // console.log(myTimestamp)
      let data = {
        [LESSON_ID]: docRef.id,
        [LESSON_CLASS_ID]: currentClassObj[CLASS_ID],
        [LESSON_ADMIN]: ent_id,
        [LESSON_STATUS]: true,
        [LESSON_DATE_ADD]: new Date(),
        [LESSON_DATE_EDIT]: new Date(),
        [LESSON_DATE_DEL]: '',
        [LESSON_DATE]: newDate,
        [LESSON_MONTH_TYPE]: parseInt(""+myDate[2]+myDate[1]),
        [LESSON_START]: document.getElementById("addLessonStart").value,
        [LESSON_END]: document.getElementById("addLessonEnd").value,
        [LESSON_DESC]: document.getElementById("addLessonDesc").value,
        [LESSON_FEEDBACK]: document.getElementById("addLessonFeedback").value,
        [LESSON_RATE]: parseInt(document.getElementById("addLessonRate").value),

      }

      var docRefWithMerge = docRef.set(data , { merge: true })
      .then(() => {
        func.showNotification('top','center', 'success', 'check_circle', "Successfully added new lesson!" );

        // Reset the paginnation cursor, remove all lesson-wrapper & reload the lessons
        latestLessonDoc = null;
        document.getElementById("lessonNoDataPlaceholder").style.display = 'none';
        removeElementsByClass('row lesson-wrapper');

        LoadLessonInfo();

        // Change Last Update in Class Module
        var classDocRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .doc(currentClassObj[CLASS_ID]);

        var classData = {
          [CLASS_DATE_EDIT]: new Date(),
          [CLASS_EDIT_MSG]: ent_name + ' added a new lesson', // Update: CLASS_DATE_EDIT + CLASS_EDIT_MSG
          [STATUS_KEY]: true,
        }
        classDocRef.update(classData)
        .then(() => {
          // Reload the page view after changing removing tutor.
          // reload();
        });

      }).catch((error) => {
        console.log("Error getting document:", error);
      });

    }

    // Update Lesson
    function UploadChangesToDBLesson(){
      let lessonId = document.getElementById("editLessonId").getAttribute('value');

      if(lessonId === null || lessonId ===''){
        alert('Error: Update changes failed. Please try again.')
      }else{

        let docRef = db.collection("Class")
          .doc("v1")
          .collection("Lesson")
          .doc(lessonId);

        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        let myDate = document.getElementById("editLessonDatepicker").value;
        myDate = myDate.split("/");
        let newDate = new Date( myDate[2], myDate[1] - 1, myDate[0]);
        // console.log(newDate)
        let myTimestamp = firebase.firestore.Timestamp.fromDate(newDate);
        // console.log(myTimestamp)
        let data = {
          // [LESSON_ID]: lessonId,
          // [LESSON_CLASS_ID]: currentClassObj[CLASS_ID],
          [LESSON_ADMIN]: ent_id,
          // [LESSON_STATUS]: true,
          // [LESSON_DATE_ADD]: new Date(),
          [LESSON_DATE_EDIT]: new Date(),
          // [LESSON_DATE_DEL]: '',
          [LESSON_DATE]: newDate,
          [LESSON_MONTH_TYPE]: parseInt(""+myDate[2]+myDate[1]),
          [LESSON_START]: document.getElementById("editLessonStart").value,
          [LESSON_END]: document.getElementById("editLessonEnd").value,
          [LESSON_DESC]: document.getElementById("editLessonDesc").value,
          [LESSON_FEEDBACK]: document.getElementById("editLessonFeedback").value,
          [LESSON_RATE]: parseInt(document.getElementById("editLessonRate").value),

        }

        docRef.set(data , { merge: true })
        .then(() => {
          func.showNotification('top','center', 'success', 'check_circle', "Successfully updated lesson info!" );

          // Reset the paginnation cursor, remove all lesson-wrapper & reload the lessons
          latestLessonDoc = null;
          removeElementsByClass('row lesson-wrapper');
          LoadLessonInfo();

          // Change Last Update in Class Module
          var classDocRef = db.collection("Class")
            .doc("v1")
            .collection("Class")
            .doc(currentClassObj[CLASS_ID]);

          var classData = {
            [CLASS_DATE_EDIT]: new Date(),
            [CLASS_EDIT_MSG]: 'Lesson updated by '+ ent_name, // Update: CLASS_DATE_EDIT + CLASS_EDIT_MSG
          }
          classDocRef.set(classData, { merge: true })
          .then(() => {
            // Reload the page view after changing removing tutor.
            // reload();
          });

        }).catch((error) => {
          console.log("Error getting document:", error);
        });

      }
    }


    // Remove Lesson
    function RemoveLesson(){
      let lessonId = document.getElementById("deleteLessonId").getAttribute('value');

      if(lessonId === null || lessonId ===''){
        alert('Error: Update changes failed. Please try again.')
      }else{

        let docRef = db.collection("Class")
          .doc("v1")
          .collection("Lesson")
          .doc(lessonId);

        let data = {
          // [LESSON_ID]: lessonId,
          // [LESSON_CLASS_ID]: currentClassObj[CLASS_ID],
          // [LESSON_ADMIN]: ent_id,
          [LESSON_STATUS]: false,
          // [LESSON_DATE_ADD]: new Date(),
          // [LESSON_DATE_EDIT]: new Date(),
          [LESSON_DATE_DEL]: new Date(),
          // [LESSON_DATE]: newDate,
          // [LESSON_MONTH_TYPE]: parseInt(""+myDate[2]+myDate[1]),
          // [LESSON_START]: document.getElementById("editLessonStart").value,
          // [LESSON_END]: document.getElementById("editLessonEnd").value,
          // [LESSON_DESC]: document.getElementById("editLessonDesc").value,
          // [LESSON_FEEDBACK]: document.getElementById("editLessonFeedback").value,
          // [LESSON_RATE]: parseInt(document.getElementById("editLessonRate").value),
        }

        var docRefWithMerge = docRef.delete( )
        .then(() => {
          func.showNotification('top','center', 'success', 'check_circle', "Lesson has been removed." );
          // Reset the paginnation cursor, remove all lesson-wrapper & reload the lessons
          latestLessonDoc = null;
          removeElementsByClass('row lesson-wrapper');
          LoadLessonInfo();

          // Change Last Update in Class Module
          var classDocRef = db.collection("Class")
            .doc("v1")
            .collection("Class")
            .doc(currentClassObj[CLASS_ID]);

          var classData = {
            [CLASS_DATE_EDIT]: new Date(),
            [CLASS_EDIT_MSG]: ent_name + " removed a lesson", // Update: CLASS_DATE_EDIT + CLASS_EDIT_MSG
            [STATUS_KEY]: true,
          }
          classDocRef.set(classData, { merge: true })
          .then(() => {
            // Reload the page view after changing removing tutor.
            // reload();
          });

        }).catch((error) => {
          console.log("Error getting document:", error);
        });

      }
    }

    // Load All Students of the class in Class_Student Module.
    var allClassStuDoc = []; // Hold all students doc in Class_Student Module
    function loadAllStudents(){
      allClassStuDoc = []; // Reinit the array
      // Class_Student Module
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Class_Student")
          .where("classId", "==", currentClassObj[CLASS_ID])
          .where("status", "==", true)
          .orderBy('stuName', 'asc')
          .startAfter(latestStuDoc)
          .limit(25);

      docRef
      .get()
      .then((querySnapshot) => {

        if ((querySnapshot.docs.length == null || querySnapshot.docs.length == 0) && latestStuDoc == null ){
          document.getElementById("studentNoDataPlaceholder").style.display = 'initial';
        }else {
          document.getElementById("studentNoDataPlaceholder").style.display = 'none';
        }
        querySnapshot.forEach((doc) => {
          allClassStuDoc.push(doc.data());
          // console.log(doc.data().stuName);
          renderAllStudents(doc);
        });

        latestStuDoc = querySnapshot.docs[querySnapshot.docs.length - 1];

        // console.log("allClassStuDoc")
        // console.log(allClassStuDoc)

        // Handle Lesson Load more btn
        if (querySnapshot.empty){
          stuLoadmore.removeEventListener('click', stuLoadMoreHandleClick );
        }

        if (querySnapshot.docs.length == 25){
          stuLoadmore.style.visibility='visible';
        }else{
          stuLoadmore.style.visibility='hidden';
        }

      }).catch((error) => {
          console.log("Error getting document:", error);
      });


    }

    // Render all students View
    function renderAllStudents(doc){

      let stuName_p = document.createElement('p');
      stuName_p.className = "student-item";
      stuName_p.setAttribute("style", "font-size: 1rem; font-weight: 400;")
      stuName_p.textContent = doc.data()[CLASS_STUDENT_STU_NAME];
      let stuName_div = document.createElement('div');
      stuName_div.className = "col-md-3";
      stuName_div.appendChild(stuName_p);

      let stuGender_p = document.createElement('p');
      stuGender_p.className = "student-item";
      stuGender_p.textContent = (doc.data()[CLASS_STUDENT_STU_GENDER] === 0) ? 'Male' : 'Female';
      let stuGender_div = document.createElement('div');
      stuGender_div.className = "col-md-1";
      stuGender_div.appendChild(stuGender_p);

      let gurName_p = document.createElement('p');
      gurName_p.className = "student-item";
      gurName_p.setAttribute("style", "font-weight: 400;")
      gurName_p.textContent = doc.data()[CLASS_STUDENT_GUR_NAME];
      let gurName_div = document.createElement('div');
      gurName_div.className = "col-md-3";
      gurName_div.appendChild(gurName_p);

      let gurPhone_p = document.createElement('p');
      gurPhone_p.className = "student-item";
      gurPhone_p.textContent = doc.data()[CLASS_STUDENT_GUR_PHONE];
      let gurPhone_div = document.createElement('div');
      gurPhone_div.className = "col-md-2";
      gurPhone_div.appendChild(gurPhone_p);

      let status_p = document.createElement('p');
      if (doc.data()[CLASS_STUDENT_ENROLLMENT_STATUS] === CLASS_STUDENT_ENROLLMENT_STATUS_PENDING){
        status_p.textContent = 'Pending';
        status_p.className = "student-item card-student-status-label pending";
      }else if (doc.data()[CLASS_STUDENT_ENROLLMENT_STATUS] === CLASS_STUDENT_ENROLLMENT_STATUS_ACTIVE){
        status_p.textContent = 'Active';
        status_p.className = "student-item card-student-status-label active";
      }
      let status_div = document.createElement('div');
      status_div.className = "col-md-1 col-4";
      status_div.appendChild(status_p);

      let dateJoined_p = document.createElement('p');
      dateJoined_p.className = "student-item";
      dateJoined_p.textContent = doc.data()[CLASS_STUDENT_DATE_ADD].toDate().toLocaleDateString("en-GB");
      let dateJoined_div = document.createElement('div');
      dateJoined_div.className = "col-md-2  col-8";
      dateJoined_div.appendChild(dateJoined_p);

      let blogsHtml_btn = '';
      blogsHtml_btn += "<i class='material-icons' style='color: red;''>remove</i>";
      let del_btn = document.createElement('a');
      del_btn.className = "btn btn-sm btn-outline-danger btn-round";
      del_btn.innerHTML = blogsHtml_btn;
      del_btn.setAttribute('type','button')
      del_btn.setAttribute('data-toggle','modal');
      del_btn.setAttribute('data-target','#delStudentModal');
      del_btn.setAttribute('data-id', doc.data()[CLASS_STUDENT_ID]);
      del_btn.setAttribute('data-stuname', doc.data()[CLASS_STUDENT_STU_NAME]);
      del_btn.setAttribute('data-stuid', doc.data()[CLASS_STUDENT_STU_ID]);
      del_btn.setAttribute('data-gurid', doc.data()[CLASS_STUDENT_GUR_ID]);
      del_btn.setAttribute('href','#');
      let del_div = document.createElement('div');
      del_div.className = "col-md-1";
      del_div.appendChild(del_btn);

      // top of student details
      let stuDetail_div = document.createElement('div');
      stuDetail_div.className = 'row';
      stuDetail_div.appendChild(stuName_div);
      stuDetail_div.appendChild(stuGender_div);
      stuDetail_div.appendChild(gurName_div);
      stuDetail_div.appendChild(gurPhone_div);
      stuDetail_div.appendChild(status_div);
      stuDetail_div.appendChild(dateJoined_div);
      let stuDetailTop_div = document.createElement('div');
      stuDetailTop_div.className = 'col-md-11 lesson-active';
      stuDetailTop_div.setAttribute('data-toggle', 'modal');
      stuDetailTop_div.setAttribute('data-target', '#editStudentModal');
      stuDetailTop_div.setAttribute('data-id', doc.data()[CLASS_STUDENT_ID]);
      stuDetailTop_div.setAttribute('data-stuname', doc.data()[CLASS_STUDENT_STU_NAME]);
      stuDetailTop_div.setAttribute('data-enrollmentstatus', doc.data()[CLASS_STUDENT_ENROLLMENT_STATUS]);
      stuDetailTop_div.setAttribute('style','padding-bottom: 12px')
      stuDetailTop_div.appendChild(stuDetail_div);

      let stuTop_div = document.createElement('div');
      stuTop_div.className = 'row student-wrapper';
      stuTop_div.appendChild(stuDetailTop_div);
      stuTop_div.appendChild(del_div);

      const students_container = document.getElementById("students-container");
      students_container.appendChild(stuTop_div)

      // students_container.insertBefore(stuTop_div, students_container.children[1])
    }


    // Add the student admin/tutor selected in Add Student Modal to Class_Student module
    function AddNewStudentsToDB(id){
      // id is the docId of a student in Student Module
      let selectedStuModuleDoc = null;
      allStuModuleDoc.forEach((doc) => {
        if (id === doc.id) selectedStuModuleDoc = doc;
      });

      var docRef = db.collection("Class")
          .doc("v1")
          .collection("Class_Student")
          .doc();
      let data = {
        [CLASS_STUDENT_ID]: docRef.id,
        [CLASS_STUDENT_CLASS_ID]: currentClassObj[CLASS_ID],
        [CLASS_STUDENT_ADMIN_ID]: currentClassObj[CLASS_ADMIN_ID],
        [CLASS_STUDENT_STATUS]: true,
        [CLASS_STUDENT_DATE_ADD]: new Date(),
        [CLASS_STUDENT_DATE_EDIT]: '',
        [CLASS_STUDENT_DATE_DEL]: '',
        [CLASS_STUDENT_ENROLLMENT_STATUS]: CLASS_STUDENT_ENROLLMENT_STATUS_ACTIVE,
        [CLASS_STUDENT_FEEDBACK]: '',
        // Student Module
        [CLASS_STUDENT_DEPENDENT_ID]: selectedStuModuleDoc.depId,
        [CLASS_STUDENT_STU_ID]: selectedStuModuleDoc[STU_CHILD_ID],
        [CLASS_STUDENT_STU_NAME]: selectedStuModuleDoc.childName,
        [CLASS_STUDENT_STU_PHONE]: selectedStuModuleDoc.childPhone,
        [CLASS_STUDENT_STU_GENDER]: selectedStuModuleDoc.childGender,
        [CLASS_STUDENT_STU_EMAIL]: selectedStuModuleDoc.childEmail,
        [CLASS_STUDENT_GUR_ID]: selectedStuModuleDoc[STU_GUR_ID],
        [CLASS_STUDENT_GUR_NAME]: selectedStuModuleDoc.gurName,
        [CLASS_STUDENT_GUR_PHONE]: selectedStuModuleDoc.gurPhone,
        [CLASS_STUDENT_GUR_EMAIL]: selectedStuModuleDoc.gurEmail,
        [CLASS_STUDENT_GUR_ADDR]: selectedStuModuleDoc.gurAddr,
      }

      // console.log('Class_Student Sub Module Data:')
      // console.log(data)
      var docRefWithMerge = docRef.set(data , { merge: true })
      .then(() => {
        func.showNotification('top','center', 'success', 'check_circle', "Successfully added a new student: " + selectedStuModuleDoc.childName );
        // Add studentId and gurId from Student Module to class's viewerId array in Class Module
        addStudentIdToClassDB(selectedStuModuleDoc[STU_GUR_ID], selectedStuModuleDoc[STU_CHILD_ID], selectedStuModuleDoc[STU_CHILD_NAME]);

        // Reset the paginnation cursor, remove all student-wrapper & reload the students
        latestStuDoc = null;
        document.getElementById("studentNoDataPlaceholder").style.display = 'none';
        removeElementsByClass('row student-wrapper');
        loadAllStudents();

      }).catch((error) => {
        console.log("Error getting document:", error);
      });

    }

    // Add new studentId & parentID as viewer to Class DB
    // Note: Guardian ID is always valid. Sometime, childId is empty.
    function addStudentIdToClassDB(guardianId, childId, childName) {
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .doc(currentClassObj[CLASS_ID]);

      // Update the Teacher panel
      // If the CLASS_VIEWER_ID_ARR or CLASS_STUDENT_ID_ARR is null or empty, assign empty arr to them.
      let viewerArray = (currentClassObj[CLASS_VIEWER_ID_ARR] == null || currentClassObj[CLASS_VIEWER_ID_ARR] == "") ? [] : currentClassObj[CLASS_VIEWER_ID_ARR];
      viewerArray.push(guardianId);
      viewerArray.push(childId);

      let stuArray = (currentClassObj[CLASS_STUDENT_ID_ARR] == null || currentClassObj[CLASS_STUDENT_ID_ARR] == "") ? [] : currentClassObj[CLASS_STUDENT_ID_ARR];
      stuArray.push(childId);

      let data = {
        [CLASS_STUDENT_ID_ARR]: stuArray,
        [CLASS_VIEWER_ID_ARR]: viewerArray,
        [CLASS_DATE_EDIT]: new Date(),
        [CLASS_EDIT_MSG]: childName + ' joined.',
      }
      // console.log('StudentID Array Data');
      // console.log(data);
      docRef.set( data, { merge: true })
      .then(() => {
        // reload();
      })
      .catch((error) => {
        console.error("Error writing document: ", error);
      });

    }

    // Remove a studentId & parentID as viewer from Class DB
    function delStudentIdFromClassDB(guardianId, studentId, studentName) {
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .doc(currentClassObj[CLASS_ID]);

      // Removed the student and gurdian Id
      let viewerArray = (currentClassObj[CLASS_VIEWER_ID_ARR] == null || currentClassObj[CLASS_VIEWER_ID_ARR] == "") ? [] : currentClassObj[CLASS_VIEWER_ID_ARR];
      // viewerArray = viewerArray.filter(e => e !== guardianId); // Remove all gurId
      // viewerArray = viewerArray.filter(e => e !== studentId); // Remove all stuId
      viewerArray = viewerArray.filter(e => e !== ""); // Remove empty items

      const indexGur = viewerArray.indexOf(guardianId);
      if (indexGur > -1) {
        viewerArray.splice(indexGur, 1);
      }

      const indexStu = viewerArray.indexOf(studentId);
      if (indexStu > -1) {
        viewerArray.splice(indexStu, 1);
      }

      let stuArray = (currentClassObj[CLASS_STUDENT_ID_ARR] == null || currentClassObj[CLASS_STUDENT_ID_ARR] == "") ? [] : currentClassObj[CLASS_STUDENT_ID_ARR];
      // stuArray = stuArray.filter(e => e !== studentId); // Remove all stuId
      stuArray = stuArray.filter(e => e !== ""); // Remove empty items

      const indexStuArray = stuArray.indexOf(studentId);
      if (indexStuArray > -1) {
        stuArray.splice(indexStuArray, 1);
      }

      let data = {
        [CLASS_STUDENT_ID_ARR]: stuArray,
        [CLASS_VIEWER_ID_ARR]: viewerArray,
        [CLASS_DATE_EDIT]: new Date(),
        [CLASS_EDIT_MSG]: ent_name, // Update: CLASS_DATE_EDIT + CLASS_EDIT_MSG
      }

      // console.log('StudentID Array Data');
      // console.log(data);

      docRef.set( data, { merge: true })
      .then(() => {
        // Reload the page view after changing removing student.
        // reload();

        // Reset the pagination cursor, remove all student-wrapper & reload the students
        latestStuDoc = null;
        removeElementsByClass('row student-wrapper');
        loadAllStudents();
        func.showNotification('top','center', 'success', 'check_circle', studentName + " has been removed." );
      })
      .catch((error) => {
        console.error("Error writing document: ", error);
      });

    }

    // Remove permanantly a student from class
    function removeStudent(studentClassId, studentName, studentId, guardianId){

      // studentClassId is the id of student in Student_Class Module
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Class_Student")
          .doc(studentClassId);


      docRef.delete().then(() => {
        // console.log("Document successfully deleted!");
        delStudentIdFromClassDB(guardianId, studentId, studentName);

      }).catch((error) => {
        console.error("Error removing document: ", error);
      });

    }

    // Load All Admin's Students that owned by class admin.
    var allStuModuleDoc = []; // Reset all students doc
    function loadAllAdminStudents(){

      // STUDENT Module
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Student")
          .where(STU_ADMIN_ID, "==", currentClassObj[CLASS_ADMIN_ID])
          .where(STU_STATUS_ADMIN, "==", true)
          .orderBy(STU_CHILD_NAME, 'asc')
          .startAfter(latestAdminStuDoc)
          .limit(25);

      docRef
      .get()
      .then((querySnapshot) => {
        querySnapshot.forEach((doc) => {

          allStuModuleDoc.push(doc.data());
          // console.log(doc.data());

          let stuClassDepIdModArray = []; // temp arrays for student dep id
          if (doc.data()[STU_DEPENDENT_ID] == ''){
            // OIf the students in Student Module have no depId, render.
            renderAllAdminStudents(doc);
          }
          else{
            // Check if the students in Student Module exist in Class_Student Module. If yes, skip, else render.
            // allClassStuDoc is obtain from the loadAllStudents func.
            allClassStuDoc.forEach((doc) => {
              stuClassDepIdModArray.push(doc[CLASS_STUDENT_DEPENDENT_ID]);
            });

            if (stuClassDepIdModArray.includes(doc.data()[STU_DEPENDENT_ID]) ){
              // Do not render
              renderAllAdminStudents(doc, true);

            }else {
              renderAllAdminStudents(doc);
            }
          }

        });
        // console.log("allStuModuleDoc")
        // console.log(allStuModuleDoc)

        latestAdminStuDoc = querySnapshot.docs[querySnapshot.docs.length - 1];
        // console.log(querySnapshot.docs.length)
        // Handle Lesson Load more btn
        if (querySnapshot.empty){
          stuAdminLoadmore.removeEventListener('click', stuAdminLoadMoreHandleClick );
        }

        if (querySnapshot.docs.length == 25){
          stuAdminLoadmore.style.visibility='visible';
        }else{
          stuAdminLoadmore.style.visibility='hidden';
        }

      }).catch((error) => {
          console.log("Error getting document:", error);
      });


    }

    // Render all admin's students in Add Student Modal
    function renderAllAdminStudents(doc, isExist = false){

      let stuName_p = document.createElement('p');
      stuName_p.className = "student-item";
      stuName_p.textContent = doc.data().childName;
      let stuName_div = document.createElement('div');
      stuName_div.className = "col-md-3";
      stuName_div.appendChild(stuName_p);

      let stuGender_p = document.createElement('p');
      stuGender_p.className = "student-item";
      stuGender_p.textContent = (doc.data().childGender === 0) ? 'Male' : 'Female';
      let stuGender_div = document.createElement('div');
      stuGender_div.className = "col-md-3";
      stuGender_div.appendChild(stuGender_p);

      let gurName_p = document.createElement('p');
      gurName_p.className = "student-item";
      gurName_p.textContent = doc.data().gurName;
      let gurName_div = document.createElement('div');
      gurName_div.className = "col-md-3";
      gurName_div.appendChild(gurName_p);

      let sel_btn = document.createElement('button');
      sel_btn.className = "btn btn-primary btn-sm";
      sel_btn.textContent = 'Select';
      sel_btn.setAttribute('data-dismiss','modal');
      sel_btn.setAttribute('type','button')
      sel_btn.setAttribute('onclick',"AddNewStudentsToDB('"+doc.data().id+"')");
      if (isExist){
        sel_btn.setAttribute('disabled',true);
      }
      let sel_div = document.createElement('div');
      sel_div.className = "col-md-3";
      sel_div.appendChild(sel_btn);

      let stuDetail_div = document.createElement('div');
      stuDetail_div.className = 'row student-wrapper';
      stuDetail_div.appendChild(stuName_div);
      stuDetail_div.appendChild(stuGender_div);
      stuDetail_div.appendChild(gurName_div);
      stuDetail_div.appendChild(sel_div);

      const add_student_modal_container = document.getElementById("add-student-modal-container");
      add_student_modal_container.appendChild(stuDetail_div)
      // add_student_modal_container.insertBefore(stuDetail_div, add_student_modal_container.children[1])
    }

    // Edit the Feedback or approve a new student to Class_Student module in editStudentModal.
    function updateStudent(classStudentDocId, studentId, guardianId, studentName, studentFeedback, studenEnrollmentStatus){

      var docRef = db.collection("Class")
          .doc("v1")
          .collection("Class_Student")
          .doc(classStudentDocId);
      let data = {};

      // If the enrollment status is still pending, approve the student
      if (studenEnrollmentStatus === CLASS_STUDENT_ENROLLMENT_STATUS_PENDING){
        data = {
          [CLASS_STUDENT_ENROLLMENT_STATUS]: CLASS_STUDENT_ENROLLMENT_STATUS_ACTIVE,
          [CLASS_STUDENT_FEEDBACK]: studentFeedback,
        }
      }else if (studenEnrollmentStatus === CLASS_STUDENT_ENROLLMENT_STATUS_ACTIVE){
        data = {
          [CLASS_STUDENT_FEEDBACK]: studentFeedback,
        }
      }else{
        data = {
          [CLASS_STUDENT_FEEDBACK]: studentFeedback,
        }
      }

      // console.log('Class_Student UPDATE Data:')
      // console.log(data)
      // console.log(classStudentDocId, studentId, guardianId, studentName, studentFeedback, studenEnrollmentStatus)

      docRef.set(data , { merge: true })
      .then(() => {

        // Add the student view to the class
        addStudentIdToClassDB(guardianId, studentId, studentName);

        func.showNotification('top','center', 'success', 'check_circle', "Successfully updated student info!" );
        // Reset the paginnation cursor, remove all student-wrapper & reload the lessons
        latestStuDoc = null;
        removeElementsByClass('row student-wrapper');
        loadAllStudents();
      }).catch((error) => {
          console.log("Error getting document:", error);
      });



    }


    // Load All Teachers that owned by class admin.
    var allTutorModuleDoc = []; // Reset all Tutors doc
    function loadAllAdminTeachers(tutorBtnNum){

      allTutorModuleDoc = []; // Init All Tutors Doc array
      // STUDENT Module
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Tutor")
          .where(TUTOR_ADMIN_ID, "==", ent_id)
          .where(TUTOR_STATUS_ADMIN, "==", TUTOR_STATUS_TYPE_ACTIVE)
          .orderBy(TUTOR_TUTOR_NAME, 'asc')
          .startAfter(latestAdminTutorDoc)
          .limit(25);

      docRef
      .get()
      .then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          // console.log(doc.data().id);
          allTutorModuleDoc.push(doc.data());
          renderAllAdminTeachers(doc, tutorBtnNum);
        });

        latestAdminTutorDoc = querySnapshot.docs[querySnapshot.docs.length - 1];
        // console.log(querySnapshot.docs.length)
        // Handle Lesson Load more btn
        if (querySnapshot.empty){
          tutorAdminLoadmore.removeEventListener('click', tutorAdminLoadMoreHandleClick );
        }

        if (querySnapshot.docs.length == 25){
          tutorAdminLoadmore.style.visibility='visible';
        }else{
          tutorAdminLoadmore.style.visibility='hidden';
        }


      }).catch((error) => {
          console.log("Error getting document:", error);
      });


    }

    // Render all teachers view in Add Teachers Modal
    function renderAllAdminTeachers(doc, tutorBtnNum){
      //  <div class="row tutor-wrapper text-center">
      //   <div class="col-md-2">
      //     <div style="height: 50px; width: 50px; display: inline-block; position: relative; overflow: hidden; border-radius: 50%;">
      //       <img style="height: 100%;width: 100%; object-fit: cover;" src="../../assets/img/test.jpg"/>
      //     </div>
      //   </div>
      //   <div class="col-md-3">
      //     <p class='tutor-item'>Alric Liew</p>
      //   </div>
      //   <div class="col-md-3">
      //     <p class='tutor-item'>Phone</p>
      //   </div>
      //   <div class="col-md-2">
      //     <p class='tutor-item'>12</p>
      //   </div>

      //   <div class="col-md-2">
      //     <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal" id="btnSelectTutor">Select</button>
      //   </div>
      // </div>

      let imgUrl_temp = "";
      let img = document.createElement('img');
      img.setAttribute('style', 'height: 100%; width: 100%; object-fit: cover;');
      // img.src = doc.data()[TUTOR_TUTOR_IMG_URL];

      // Check if img is valid. If no, create a 2 chars avatar
      if (doc.data()[TUTOR_TUTOR_IMG_URL] == null || doc.data()[TUTOR_TUTOR_IMG_URL] == ""
      || doc.data()[TUTOR_TUTOR_IMG_URL] == "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D"
      || tutorImgUrlChecker(doc.data()[TUTOR_TUTOR_IMG_URL])){

        let AvatarText = doc.data()[TUTOR_TUTOR_NAME][0] + doc.data()[TUTOR_TUTOR_NAME][1];
        img.src = generateAvatar(AvatarText, "#eaeaea", "#f6f6f6", "100px");
        imgUrl_temp = "";

      }
      else {
        img.src = doc.data()[TUTOR_TUTOR_IMG_URL];
        imgUrl_temp = doc.data()[TUTOR_TUTOR_IMG_URL];
      }

      let img_div = document.createElement('div');
      img_div.setAttribute('style', 'height: 50px; width: 50px; display: inline-block; position: relative; overflow: hidden; border-radius: 50%;');
      img_div.appendChild(img);
      let imgTop_div = document.createElement('div');
      imgTop_div.className = "col-md-2";
      imgTop_div.appendChild(img_div);


      let tutorName_p = document.createElement('p');
      tutorName_p.className = "tutor-item";
      tutorName_p.textContent = doc.data()[TUTOR_TUTOR_NAME];
      let tutorName_div = document.createElement('div');
      tutorName_div.className = "col-md-3";
      tutorName_div.appendChild(tutorName_p);

      let tutorPhone_p = document.createElement('p');
      tutorPhone_p.className = "tutor-item";
      tutorPhone_p.textContent = doc.data()[TUTOR_TUTOR_PHONE];
      let tutorPhone_div = document.createElement('div');
      tutorPhone_div.className = "col-md-3";
      tutorPhone_div.appendChild(tutorPhone_p);

      let tutorAge_p = document.createElement('p');
      tutorAge_p.className = "tutor-item";
      tutorAge_p.textContent = doc.data()[TUTOR_TUTOR_AGE];
      let tutorAge_div = document.createElement('div');
      tutorAge_div.className = "col-md-2";
      tutorAge_div.appendChild(tutorAge_p);

      let sel_btn = document.createElement('button');
      sel_btn.className = "btn btn-primary btn-sm";
      sel_btn.textContent = 'Select';
      sel_btn.setAttribute('data-dismiss','modal');
      sel_btn.setAttribute('type','button')
      sel_btn.setAttribute('onclick',"AddNewTutorToDB("+ tutorBtnNum+", '"+ doc.data()[TUTOR_TUTOR_ID]+"', `"+doc.data()[TUTOR_TUTOR_NAME]+"`, '"+doc.data()[TUTOR_TUTOR_PHONE]+"', `"+imgUrl_temp+"`)");
      let sel_div = document.createElement('div');
      sel_div.className = "col-md-2";
      sel_div.appendChild(sel_btn);

      let tutorDetail_div = document.createElement('div');
      tutorDetail_div.className = 'row tutor-wrapper text-center';
      tutorDetail_div.appendChild(imgTop_div);
      tutorDetail_div.appendChild(tutorName_div);
      tutorDetail_div.appendChild(tutorPhone_div);
      tutorDetail_div.appendChild(tutorAge_div);
      tutorDetail_div.appendChild(sel_div);

      const add_tutor_modal_container = document.getElementById("add-tutor-modal-container");
      add_tutor_modal_container.appendChild(tutorDetail_div);

      // add_tutor_modal_container.insertBefore(tutorDetail_div, add_tutor_modal_container.children[1])
    }

    // Add Tutor to Class (Subset of Add to Class function)
    function AddNewTutorToDB(tutorNum, tutorId_temp, tutorName, tutorPhone, tutorImgUrl){
      // tutorNum refer to Teacher 1 / 2 since we share the similar modal
      // console.log(tutorNum)
      // console.log(ent_id)
      // console.log(tutorName)
      // console.log(tutorPhone)

      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .doc(currentClassObj[CLASS_ID]);

      // First, get the original value first
      let tutor1_id = document.getElementById("inTutor1Name").getAttribute("data-tutor1id");
      let tutor1_name = document.getElementById("inTutor1Name").value;
      let tutor1_phone = document.getElementById("inTutor1Phone").value;
      let tutor1_imgurl = document.getElementById("inTutor1ImgUrl").src;
      // Check if tutor1_imgurl is valid. If no, set to empty
      if (tutor1_imgurl == null || tutor1_imgurl == "" || tutorImgUrlChecker(tutor1_imgurl)){
        tutor1_imgurl = "";
      }
      else {
        // Do nothing, remain the same.
        // tutor1_imgurl = tutor1_imgurl;
      }

      let tutor2_id = document.getElementById("inTutor2Name").getAttribute("data-tutor2id");
      let tutor2_name = document.getElementById("inTutor2Name").value;
      let tutor2_phone = document.getElementById("inTutor2Phone").value;
      let tutor2_imgurl = document.getElementById("inTutor2ImgUrl").src;
      // Check if tutor2_imgurl is valid. If no, set to empty
      if (tutor2_imgurl == null || tutor2_imgurl == "" || tutorImgUrlChecker(tutor2_imgurl)){
        tutor2_imgurl = "";
      }
      else {
        // Do nothing, remain the same.
        // tutor2_imgurl = tutor2_imgurl;
      }

      // Update the Teacher panel
      if (tutorNum == 1){
        tutor1_id = tutorId_temp;
        tutor1_name = tutorName;
        tutor1_phone = tutorPhone;
        tutor1_imgurl = tutorImgUrl;
        document.getElementById('inTutor1Name').setAttribute("data-tutor1id", tutorId_temp);
        document.getElementById("inTutor1Name").value = tutorName;
        document.getElementById("inTutor1Phone").value = tutorPhone;
        document.getElementById("inTutor1ImgUrl").src = tutorImgUrl;
      }else if (tutorNum == 2){
        tutor2_id = tutorId_temp;
        tutor2_name = tutorName;
        tutor2_phone = tutorPhone;
        tutor2_imgurl = tutorImgUrl;
        document.getElementById('inTutor2Name').setAttribute("data-tutor2id", tutorId_temp);
        document.getElementById("inTutor2Name").value = tutorName;
        document.getElementById("inTutor2Phone").value = tutorPhone;
        document.getElementById("inTutor2ImgUrl").src = tutorImgUrl;
      }else{
        // Do nothing
      }

      let data = {
        // [CLASS_ADMIN_ID]: ent_id,
        [CLASS_TUTOR_ID_ARR]: [tutor1_id, tutor2_id, currentClassObj[CLASS_ADMIN_ID]],
        [CLASS_TUTOR_NAME_ARR]: [tutor1_name, tutor2_name],
        [CLASS_TUTOR_PHONE_ARR]: [tutor1_phone, tutor2_phone],
        [CLASS_TUTOR_IMG_URL_ARR]: [tutor1_imgurl, tutor2_imgurl],
        [CLASS_DATE_EDIT]: new Date(),
        [CLASS_EDIT_MSG]: tutorName + ' joined as tutor.', // Update: CLASS_DATE_EDIT + CLASS_EDIT_MSG
      }

      console.log('Tutors Data');
      console.log(data);
      docRef.update( data, { merge: true })
      .then(() => {
        func.showNotification('top','center', 'success', 'check_circle', "New tutor added.");
        // reload();
      })
      .catch((error) => {
        console.error("Error writing document: ", error);
      });

    }

    // Remove Tutor 2 from Class
    function removeTutor2FromDB(){
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .doc(currentClassObj[CLASS_ID]);

      // First, get the original value first
      let tutor1_id = document.getElementById("inTutor1Name").getAttribute("data-tutor1id");
      let tutor1_name = document.getElementById("inTutor1Name").value;
      let tutor1_phone = document.getElementById("inTutor1Phone").value;
      let tutor1_imgurl = document.getElementById("inTutor1ImgUrl").src;
      // Check if tutor1_imgurl is valid. If no, set to empty
      if (tutor1_imgurl == null || tutor1_imgurl == "" || tutorImgUrlChecker(tutor1_imgurl)){
        tutor1_imgurl = "";
      }
      else {
        // Do nothing, remain the same.
        // tutor1_imgurl = tutor1_imgurl;
      }

      let tutor2_name = document.getElementById("inTutor2Name").value;
      // Clear the fields
      document.getElementById('inTutor2Name').setAttribute("data-tutor2id", '');
      document.getElementById("inTutor2Name").value = '';
      document.getElementById("inTutor2Phone").value = '';
      document.getElementById("inTutor2ImgUrl").src = '../../assets/img/empty-photo.png';


      let data = {
        [CLASS_TUTOR_ID_ARR]: [tutor1_id, '', currentClassObj[CLASS_ADMIN_ID]],
        [CLASS_TUTOR_NAME_ARR]: [tutor1_name, ''],
        [CLASS_TUTOR_PHONE_ARR]: [tutor1_phone, ''],
        [CLASS_TUTOR_IMG_URL_ARR]: [tutor1_imgurl, ''],
        [CLASS_DATE_EDIT]: new Date(),
        [CLASS_EDIT_MSG]: 'by '+ ent_name, // Update: CLASS_DATE_EDIT + CLASS_EDIT_MSG
      }
      // console.log('Remove Tutors Data');
      // console.log(data);
      docRef.update( data)
      .then(() => {
        func.showNotification('top','center', 'success', 'check_circle', tutor2_name + " removed.");
        // reload();
      })
      .catch((error) => {
        console.error("Error writing document: ", error);
      });
    }

    // Remove Elements by Class Name
    function removeElemenentByClassName(elem){
      $( "."+elem).remove();
    }

    function removeElementsByClass(className){
      const elements = document.getElementsByClassName(className);
      while(elements.length > 0){
          elements[0].parentNode.removeChild(elements[0]);
      }
    }

    // Validate date n time fields in Add Class Modal.
    function ValidateFields(parentId){
      // This function deals with validation of the form fields with data-compulsory = 'true'
      var x, y, i, valid = true;
      x = document.getElementById(parentId);
      y =x.querySelectorAll('[data-compulsory="true"]');

      // A loop that checks every input field in the current tab:
      for (i = 0; i < y.length; i++) {
        // console.log(y[i].value)
        // If a field is empty...
        if (y[i].value == "") {
          // add an "invalid" class to the field:
          y[i].className += " invalid";
          // and set the current valid status to false:
          valid = false;
        }
      }
      return valid; // return the valid status
    }

    // Copy a text based on element ID
    function copyText(targetElemId){
      /* Get the text field */
      let copyText = document.getElementById(targetElemId);
      // console.log(copyText)
      // console.log(copyText.select())
      /* Select the text field */
      copyText.focus();
      copyText.select();
      copyText.setSelectionRange(0, 99999); /* For mobile devices */

      /* Copy the text inside the text field */
      navigator.clipboard.writeText(copyText.value);

      func.showNotification('top','center', 'success', 'check_circle', "Link copied.");
      /* Alert the copied text */
      // alert("Copied the text: " + copyText.value);
    }

    // Redirect to specific url
    function RedirectTo(url){
      // window.location.href = url;
      window.open(
        url,
        '_blank' // <- This is what makes it open in a new window.
      );
    }

    // Check if valid url. Return true if valid.
    function isValidHttpUrl(string) {
      let url;
      try {
        url = new URL(string);
      } catch (_) {
        return false;
      }
      return true;
    }

    // Used when user set Class Status to Active
    function enableAllEdits() {
      // Title
      document.getElementById("titleClassName").textContent = currentClassObj[CLASS_NAME];

      // Lesson Panel
      document.getElementById("btnEditLessonModalUpdate").style.pointerEvents= 'auto';
      document.getElementById("btnEditLessonModalUpdate").style.backgroundColor = '#2e74b6';
      document.getElementById("btnDelLessonModalUpdate").style.pointerEvents= 'auto';
      document.getElementById("btnDelLessonModalUpdate").style.backgroundColor = '#2e74b6';
      document.getElementById("btnAddLesson").style.pointerEvents= 'auto';
      document.getElementById("btnAddLesson").style.backgroundColor = '#fff';

      // General Panel
      document.getElementById("inClassAnnouncement").removeAttribute("readonly");
      document.getElementById("inClassAnnouncement").disabled=false;
      document.getElementById("inClassAnnouncement").style.backgroundColor = "#fff" ;
      document.getElementById("inClassName").removeAttribute("readonly");
      document.getElementById("inClassName").disabled=false;
      document.getElementById("inClassName").style.backgroundColor = "#fff" ;
      document.getElementById("inClassDesc").removeAttribute("readonly");
      document.getElementById("inClassDesc").disabled=false;
      document.getElementById("inClassDesc").style.backgroundColor = "#fff" ;
      document.getElementById("inVenue").removeAttribute("readonly");
      document.getElementById("inVenue").disabled=false;
      document.getElementById("inVenue").style.backgroundColor = "#fff" ;
      document.getElementById("inUrlClass").removeAttribute("readonly");
      document.getElementById("inUrlClass").disabled=false;
      document.getElementById("inUrlClass").style.backgroundColor = "#fff" ;
      document.getElementById("inUrlGroup").removeAttribute("readonly");
      document.getElementById("inUrlGroup").disabled=false;
      document.getElementById("inUrlGroup").style.backgroundColor = "#fff" ;
      document.getElementById("inUrlMaterial").removeAttribute("readonly");
      document.getElementById("inUrlMaterial").disabled=false;
      document.getElementById("inUrlMaterial").style.backgroundColor = "#fff" ;


      // Time Slot Panel
      document.getElementById("btnAddTimeSlot").style.pointerEvents= 'auto';
      document.getElementById("btnAddTimeSlot").style.backgroundColor = '#fff';
      document.getElementById("timeSlot-container").style.pointerEvents= 'auto';
      document.getElementById("timeSlot-container").style.backgroundColor = '#fff';

      // Student Panel
      document.getElementById("btnAddStudent").style.pointerEvents= 'auto';
      document.getElementById("btnAddStudent").style.backgroundColor = '#fff';
      document.getElementById("btnEditStudentModalUpdate").style.pointerEvents= 'auto';
      document.getElementById("btnEditStudentModalUpdate").style.backgroundColor = '#2e74b6';
      document.getElementById("btnDelStudentModalUpdate").style.pointerEvents= 'auto';
      document.getElementById("btnDelStudentModalUpdate").style.backgroundColor = '#2e74b6';

      // Tutor Panel
      document.getElementById("btnAddTeacher1").style.pointerEvents = 'auto';
      document.getElementById("btnAddTeacher1").style.backgroundColor = '#fff';
      document.getElementById("btnAddTeacher2").style.pointerEvents = 'auto';
      document.getElementById("btnAddTeacher2").style.backgroundColor = '#fff';
      document.getElementById("btnDelTeacher2").style.pointerEvents = 'auto';
      document.getElementById("btnDelTeacher2").style.backgroundColor = '#fff';

      // Fee Panel
      document.getElementById("inFee").removeAttribute("readonly");
      document.getElementById("inFee").disabled=false;
      document.getElementById("inFee").style.backgroundColor = "#fff" ;
      document.getElementById("feeTypePerMonthRadio").removeAttribute("disabled");
      document.getElementById("feeTypePerHourRadio").removeAttribute("disabled");

      // Admin Panel
      document.getElementById("inStudentLimit").removeAttribute("readonly");
      document.getElementById("inStudentLimit").disabled=false;
      document.getElementById("inStudentLimit").style.backgroundColor = "#fff" ;
      document.getElementById("firstClassDatePicker").removeAttribute("readonly");
      document.getElementById("firstClassDatePicker").disabled=false;
      document.getElementById("firstClassDatePicker").style.backgroundColor = "#fff" ;
      document.getElementById("onlineonly_check").removeAttribute("disabled");
      document.getElementById("state_drop").disabled=false;
      document.getElementById("area_drop").disabled=false;
      document.getElementById("state_drop").style.backgroundColor = "#fff" ;
      document.getElementById("area_drop").style.backgroundColor="#fff" ;
      document.getElementById("level_drop").disabled=false;
      document.getElementById("subject_drop").disabled=false;
      document.getElementById("level_drop").style.backgroundColor = "#fff" ;
      document.getElementById("subject_drop").style.backgroundColor="#fff" ;

      document.getElementById("classTypeRadioPrivate").removeAttribute("disabled");
      document.getElementById("classTypeRadioPublic").removeAttribute("disabled");

      document.getElementById("stuAutoJoinEn").removeAttribute("disabled");
      document.getElementById("btnCopyAutoJoinLink").setAttribute("onclick", "copyText('inAutoJoinLink')");
      let uriAdminId = encodeURIComponent(currentClassObj[CLASS_ADMIN_ID]);
      let uriClassId = encodeURIComponent(currentClassObj[CLASS_ID]);
      document.getElementById("inAutoJoinLink").value = 'https://org.golearn.com.my/online-registration.html?aid='+uriAdminId+'&cid='+uriClassId;
      document.getElementById("tAddRibbonEn").removeAttribute("disabled");
      if (document.getElementById("tAddRibbonEn").checked){
        document.getElementById("inRibbonSettings").style.display = '';
      }

      document.getElementById("tAddEditLessonEn").removeAttribute("disabled");
      document.getElementById("tDelLessonEn").removeAttribute("disabled");

      document.getElementById("classTag").removeAttribute("disabled");

    }



    // Used when user set Class Status to Inactive
    function disableAllEdits() {
      // Title
      document.getElementById("titleClassName").textContent = currentClassObj[CLASS_NAME] + ' (Inactive)';

      // Lesson Panel
      document.getElementById("btnEditLessonModalUpdate").style.pointerEvents= 'none';
      document.getElementById("btnEditLessonModalUpdate").style.backgroundColor = 'grey';
      document.getElementById("btnDelLessonModalUpdate").style.pointerEvents= 'none';
      document.getElementById("btnDelLessonModalUpdate").style.backgroundColor = 'grey';
      document.getElementById("btnAddLesson").style.pointerEvents= 'none';
      document.getElementById("btnAddLesson").style.backgroundColor = '#e9ecef';

      // General Panel
      document.getElementById("inClassAnnouncement").setAttribute("readonly", true);
      document.getElementById("inClassAnnouncement").disabled=true;
      document.getElementById("inClassAnnouncement").style.backgroundColor = "#e9ecef" ;
      document.getElementById("inClassName").setAttribute("readonly", true);
      document.getElementById("inClassName").disabled=true;
      document.getElementById("inClassName").style.backgroundColor = "#e9ecef" ;
      document.getElementById("inClassDesc").setAttribute("readonly", true);
      document.getElementById("inClassDesc").disabled=true;
      document.getElementById("inClassDesc").style.backgroundColor = "#e9ecef" ;
      document.getElementById("inVenue").setAttribute("readonly", true);
      document.getElementById("inVenue").disabled=true;
      document.getElementById("inVenue").style.backgroundColor = "#e9ecef" ;
      document.getElementById("inUrlClass").setAttribute("readonly", true);
      document.getElementById("inUrlClass").disabled=true;
      document.getElementById("inUrlClass").style.backgroundColor = "#e9ecef" ;
      document.getElementById("inUrlGroup").setAttribute("readonly", true);
      document.getElementById("inUrlGroup").disabled=true;
      document.getElementById("inUrlGroup").style.backgroundColor = "#e9ecef" ;
      document.getElementById("inUrlMaterial").setAttribute("readonly", true);
      document.getElementById("inUrlMaterial").disabled=true;
      document.getElementById("inUrlMaterial").style.backgroundColor = "#e9ecef" ;


      // Time Slot Panel
      document.getElementById("btnAddTimeSlot").style.pointerEvents= 'none';
      document.getElementById("btnAddTimeSlot").style.backgroundColor = '#e9ecef';
      document.getElementById("timeSlot-container").style.pointerEvents= 'none';
      document.getElementById("timeSlot-container").style.backgroundColor = '#e9ecef';

      // Student Panel
      document.getElementById("btnAddStudent").style.pointerEvents= 'none';
      document.getElementById("btnAddStudent").style.backgroundColor = '#e9ecef';
      document.getElementById("btnEditStudentModalUpdate").style.pointerEvents= 'none';
      document.getElementById("btnEditStudentModalUpdate").style.backgroundColor = 'grey';
      document.getElementById("btnDelStudentModalUpdate").style.pointerEvents= 'none';
      document.getElementById("btnDelStudentModalUpdate").style.backgroundColor = 'grey';

      // Tutor Panel
      document.getElementById("btnAddTeacher1").style.pointerEvents = 'none';
      document.getElementById("btnAddTeacher1").style.backgroundColor = '#e9ecef';
      document.getElementById("btnAddTeacher2").style.pointerEvents = 'none';
      document.getElementById("btnAddTeacher2").style.backgroundColor = '#e9ecef';
      document.getElementById("btnDelTeacher2").style.pointerEvents = 'none';
      document.getElementById("btnDelTeacher2").style.backgroundColor = '#e9ecef';

      // Fee Panel
      document.getElementById("inFee").setAttribute("readonly", true);
      document.getElementById("inFee").disabled=true;
      document.getElementById("inFee").style.backgroundColor = "#e9ecef" ;
      document.getElementById("feeTypePerMonthRadio").setAttribute("disabled", true);
      document.getElementById("feeTypePerHourRadio").setAttribute("disabled", true);

      // Admin Panel
      document.getElementById("inStudentLimit").setAttribute("readonly", true);
      document.getElementById("inStudentLimit").disabled=true;
      document.getElementById("inStudentLimit").style.backgroundColor = "#e9ecef" ;
      document.getElementById("firstClassDatePicker").setAttribute("readonly", true);
      document.getElementById("firstClassDatePicker").disabled=true;
      document.getElementById("firstClassDatePicker").style.backgroundColor = "#e9ecef" ;
      document.getElementById("onlineonly_check").setAttribute("disabled", true);
      document.getElementById("state_drop").disabled=true;
      document.getElementById("area_drop").disabled=true;
      document.getElementById("state_drop").style.backgroundColor = "#e9ecef" ;
      document.getElementById("area_drop").style.backgroundColor="#e9ecef" ;
      document.getElementById("level_drop").disabled=true;
      document.getElementById("subject_drop").disabled=true;
      document.getElementById("level_drop").style.backgroundColor = "#e9ecef" ;
      document.getElementById("subject_drop").style.backgroundColor="#e9ecef" ;

      document.getElementById("classTypeRadioPrivate").setAttribute("disabled", true);
      document.getElementById("classTypeRadioPublic").setAttribute("disabled", true);

      document.getElementById("stuAutoJoinEn").setAttribute("disabled", true);
      // document.getElementById("btnCopyAutoJoinLink").setAttribute("disabled", true);
      document.getElementById("btnCopyAutoJoinLink").setAttribute("onclick", "");
      document.getElementById("inAutoJoinLink").value = 'No link';
      document.getElementById("tAddRibbonEn").setAttribute("disabled", true);
      document.getElementById("inRibbonSettings").style.display = 'none';

      document.getElementById("tAddEditLessonEn").setAttribute("disabled", true);
      document.getElementById("tDelLessonEn").setAttribute("disabled", true);

      document.getElementById("classTag").setAttribute("disabled", true);

    }

    // Used when user is not Admin
    function disableAllEditsForNonAdmin() {

      if (!currentClassObj[CLASS_TUTOR_ADD_EDIT_LESSON_ENABLE]){

        // Lesson Panel
        document.getElementById("btnEditLessonModalUpdate").style.pointerEvents= 'none';
        document.getElementById("btnEditLessonModalUpdate").style.backgroundColor = 'grey';
        // document.getElementById("btnDelLessonModalUpdate").style.pointerEvents= 'none';
        // document.getElementById("btnDelLessonModalUpdate").style.backgroundColor = 'grey';
        document.getElementById("btnAddLesson").style.pointerEvents= 'none';
        document.getElementById("btnAddLesson").style.backgroundColor = '#e9ecef';

      }

      if (!currentClassObj[CLASS_TUTOR_REMOVE_LESSON_ENABLE]){
        // Lesson Panel
        // document.getElementById("btnEditLessonModalUpdate").style.pointerEvents= 'none';
        // document.getElementById("btnEditLessonModalUpdate").style.backgroundColor = 'grey';
        document.getElementById("btnDelLessonModalUpdate").style.pointerEvents= 'none';
        document.getElementById("btnDelLessonModalUpdate").style.backgroundColor = 'grey';
        // document.getElementById("btnAddLesson").style.pointerEvents= 'none';
        // document.getElementById("btnAddLesson").style.backgroundColor = '#e9ecef';
      }

      // Common settings
      document.getElementById("advancedSettingsTab").style.display = 'none';
      document.getElementById("publicTab").style.display = 'none';

      // General Panel
      // document.getElementById("inClassAnnouncement").setAttribute("readonly", true);
      // document.getElementById("inClassAnnouncement").disabled=true;
      // document.getElementById("inClassAnnouncement").style.backgroundColor = "#e9ecef" ;
      document.getElementById("inClassName").setAttribute("readonly", true);
      document.getElementById("inClassName").disabled=true;
      document.getElementById("inClassName").style.backgroundColor = "#e9ecef" ;
      // document.getElementById("inClassDesc").setAttribute("readonly", true);
      // document.getElementById("inClassDesc").disabled=true;
      // document.getElementById("inClassDesc").style.backgroundColor = "#e9ecef" ;
      // document.getElementById("inVenue").setAttribute("readonly", true);
      // document.getElementById("inVenue").disabled=true;
      // document.getElementById("inVenue").style.backgroundColor = "#e9ecef" ;
      // document.getElementById("inUrlClass").setAttribute("readonly", true);
      // document.getElementById("inUrlClass").disabled=true;
      // document.getElementById("inUrlClass").style.backgroundColor = "#e9ecef" ;
      // document.getElementById("inUrlGroup").setAttribute("readonly", true);
      // document.getElementById("inUrlGroup").disabled=true;
      // document.getElementById("inUrlGroup").style.backgroundColor = "#e9ecef" ;
      // document.getElementById("inUrlMaterial").setAttribute("readonly", true);
      // document.getElementById("inUrlMaterial").disabled=true;
      // document.getElementById("inUrlMaterial").style.backgroundColor = "#e9ecef" ;


      // Time Slot Panel
      // document.getElementById("btnAddTimeSlot").style.pointerEvents= 'none';
      // document.getElementById("btnAddTimeSlot").style.backgroundColor = '#e9ecef';
      // document.getElementById("timeSlot-container").style.pointerEvents= 'none';
      // document.getElementById("timeSlot-container").style.backgroundColor = '#e9ecef';

      // Student Panel
      document.getElementById("btnAddStudent").style.pointerEvents= 'none';
      document.getElementById("btnAddStudent").style.backgroundColor = '#e9ecef';
      document.getElementById("btnEditStudentModalUpdate").style.pointerEvents= 'none';
      document.getElementById("btnEditStudentModalUpdate").style.backgroundColor = 'grey';
      document.getElementById("btnDelStudentModalUpdate").style.pointerEvents= 'none';
      document.getElementById("btnDelStudentModalUpdate").style.backgroundColor = 'grey';

      // Tutor Panel
      document.getElementById("btnAddTeacher1").style.pointerEvents = 'none';
      document.getElementById("btnAddTeacher1").style.backgroundColor = '#e9ecef';
      document.getElementById("btnAddTeacher2").style.pointerEvents = 'none';
      document.getElementById("btnAddTeacher2").style.backgroundColor = '#e9ecef';
      document.getElementById("btnDelTeacher2").style.pointerEvents = 'none';
      document.getElementById("btnDelTeacher2").style.backgroundColor = '#e9ecef';

      // Fee Panel
      document.getElementById("inFee").setAttribute("readonly", true);
      document.getElementById("inFee").disabled=true;
      document.getElementById("inFee").style.backgroundColor = "#e9ecef" ;
      document.getElementById("feeTypePerMonthRadio").setAttribute("disabled", true);
      document.getElementById("feeTypePerHourRadio").setAttribute("disabled", true);

    }


    // Check the student limit
    // TODO: Use settings from Settings > v1 > Profile > ...
    function checkStudentLimit(){

      let stuLimit = document.getElementById("inStudentLimit").value;
      let fixedStuLimit = 999;

      // if (current_accountStatus === DEACTIVATED_ACCOUNT_STATUS_KEY ||
      //   current_accountStatus === SUSPENDED_ACCOUNT_STATUS_KEY ||
      //   current_accountStatus === ACTIVE_ACCOUNT_STATUS_KEY  ){
      //   fixedStuLimit = ProfileSettingsValue_Active[ProfileSettings.indexOf('aStudentNum')];
      //   // document.getElementById("inStudentLimit").value = (stuLimit > fixedStuLimit) ? fixedStuLimit : stuLimit;
      // }
      // else
      // {
      //   fixedStuLimit = ProfileSettingsValue_Premium[ProfileSettings.indexOf('aStudentNum')];
      //   // document.getElementById("inStudentLimit").value = (stuLimit > fixedStuLimit) ? fixedStuLimit : stuLimit;
      // }

      if (stuLimit > fixedStuLimit){
        document.getElementById("inStudentLimit").value = fixedStuLimit;
      }else if (stuLimit < 1){
        document.getElementById("inStudentLimit").value = 1;
      }else {
        document.getElementById("inStudentLimit").value = stuLimit;
      }
    }


    // Reload the page after edited something
    function reload(){

      var docRef = db.collection("Class")
        .doc("v1")
        .collection("Class")
        .doc(currentClassObj[CLASS_ID]);

      // Reload Invoice data
      docRef
      .get()
      .then((doc) => {

        if (doc.exists) {
          // console.log("Reload document");
          // console.log(doc.data());

          // sessionStorage.setItem(SESSION_STORAGE_CLASS_CURRENT_DOC_KEY, JSON.stringify(doc.data()));

          // Reload page view
          getClassObj(cid);

        }
        else {
          window.location = "./"
          console.log("No such document!");
        }

      })
      .catch((error) => {
        console.log("Error getting document:", error);
      });
    }

    // Init Time picker
    function initTimePicker(){
      $('.clockpicker').clockpicker()
      .find('input').change(function(){
        // Time changed
        // console.log(this.value);
      });

    }

    function tConvert (time) {
      // Check correct time format and split into components
      // 18:00:00 => "6:00:00PM"
      // 18:00 => "6:00PM"
      // 00:00 => "12:00AM"
      // 11:59:01 => "11:59:01AM"
      // 12:00:00 => "12:00:00PM"
      // 13:01:57 => "1:01:57PM"
      // 24:00 => "24:00"
      // sdfsdf => "sdfsdf"
      // 12:61:54 => "12:61:54"

      time = time.toString ().match (/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];

      if (time.length > 1) { // If time format correct
        time = time.slice (1);  // Remove full string match value
        time[5] = +time[0] < 12 ? 'AM' : 'PM'; // Set AM/PM
        time[0] = +time[0] % 12 || 12; // Adjust hours
      }
      return time.join (''); // return adjusted time or original string
    }

    // https://ekoopmans.github.io/html2pdf.js/
    function generatePDFeKoopmans(id){

      element = document.getElementById(id);
      var cln = element.cloneNode(true);

      // Lesson header
      let lesson_header = cln.querySelector(".lesson-header").children;
      // Lesson header: Change the header detail to col-md-12
      lesson_header[0].className = "col-md-12";
      // Lesson header: Remove the Action col
      lesson_header[1].remove();


      // Lesson item
      let lesson_wrapper = cln.querySelectorAll(".lesson-wrapper");
      // Loop through each item
      lesson_wrapper.forEach((row, index) => {
        let lesson_wrapper_children = row.children;
        // Lesson item: Change the header detail to col-md-12
        lesson_wrapper_children[0].className = "col-md-12";
        // Lesson item: Remove the Action col
        lesson_wrapper_children[1].remove();

      })

      // Header Block
      let className_temp = currentClassObj[CLASS_NAME]
      let inTeacher = "";
      if (currentClassObj[CLASS_TUTOR_NAME_ARR][1] == null || currentClassObj[CLASS_TUTOR_NAME_ARR][1] == ""){
        inTeacher= currentClassObj[CLASS_TUTOR_NAME_ARR][0];
      }else {
        inTeacher= currentClassObj[CLASS_TUTOR_NAME_ARR][0] + ", " +  currentClassObj[CLASS_TUTOR_NAME_ARR][1];
      }

      let header_html = `
        <div class="col-md-12 text-center">
          <h3 id="">`+className_temp+`</h3>
        </div>
        <div class="col-md-12 text-center" >
          <h4 id="">Progress Report</h4>
        </div>
        <div class="col-md-12 text-center">
          <p id="" style="font-size: 14px; font-weight: 300; color: gray; margin-bottom: 12px;">`+inTeacher+`</p>
        </div>
        <div class="col-md-12 text-center">
          <p id="" style="font-size: 14px; font-weight: 300; color: gray; margin-bottom: 12px;">Date Generated: `+new Date().toLocaleDateString("en-gb")+`</p>
        </div>
      `;
      let header_div = document.createElement("div");
      header_div.className = "row";
      header_div.innerHTML = header_html;

      // Footer Block
      let footer_html = `
        <div class="col-md-12 text-center">
          <p style="margin-bottom: 0;">Powered by
            <span>
              <a href="https://golearn.com.my/" class="simple-text logo-mini">
                <img src="../../assets/img/golearn-plain.svg" style="width: 108px; height: auto; " alt=""></img>
              </a>
            </span>
          </p>
        </div>
      `;
      let footer_div = document.createElement("div");
      footer_div.className = "row";
      footer_div.setAttribute("style", "margin-top: 3rem")
      footer_div.innerHTML = footer_html;

      // Combine everything
      let report = document.createElement("div");
      report.setAttribute("style", "margin: 0.5rem")
      report.appendChild(header_div);
      report.appendChild(cln);
      report.appendChild(footer_div);

      var opt = {
        margin:       0,
        filename:     'progress_report.pdf',
        pagebreak:    { before: '.beforeClass', after: ['#after1', '#after2'], avoid: 'img' },
        image:        { type: 'jpeg', quality: 0.95 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };

      html2pdf().set(opt).from(report).save();
    }

  </script>

  <!-- Script -->
  <script>


    // Edit Lesson Modal
    // Extract info from data-* attributes
    var ID = "";
    var DATE = "";
    var START = "";
    var END = "";
    var DESC = "";
    var FEEDBACK = "";
    var RATE = "";
    // Class_Student Submodule
    var STUDENT_CLASS_ID = '';
    var CLASS_STUDENT_DOC_ID = '';
    var STUDENT_NAME = '';
    var GUARDIAN_ID = '';

    var STUDENT_ENROLLMENT_STATUS = '';
    var CURRENT_LESSON_ID = '';
    var CURRENT_LESSON_DATE = '';
    $( document ).ready(function() {

      // Populate Subject based on selected education level
      $('#level_drop').on('change', function(){
        // Initialization
        // Reasign subject after the level change. It suppose to be defaulted to "Select subject"
        subjectId = '';
        subject = '';

        // Get the text of the selected item
        let LevelId_selected = $(this).val(); // Value of the selected item
        let LevelTxt = $(this).find("option:selected").text();
        categoryId = LevelId_selected;
        category = LevelTxt;

        // Clear the area option first, except the first one. 100 is a just a huge number
        var subject_drop = document.getElementById("subject_drop");
        for(i=1; i <= 100; i++){
          subject_drop.remove(1);
        }

        if  (!(categoryId == "" || categoryId == null )){
          let subjectInfo = selectSubjectListBasedOnLevelId(LevelId_selected);// Get the subject info
          let options = subjectInfo[0];
          let optionIds = subjectInfo[1];

          for (let i = 0; i < options.length; i++) {
            let opt = options[i];
            let optId = optionIds[i];
            let el = document.createElement("option");
            el.textContent = opt;
            el.value = optId;
            subject_drop.appendChild(el);
          }
        }
      });


      // ------Subject Dropdown Start------- //
      $('#subject_drop').on('change', function(){
        // Get the val and text of the selected item
        subjectId = $(this).val()
        subject = $(this).find("option:selected").text();
      });
      // ------Subject Dropdown End------- //

      $('#onlineonly_check').on('change', function(){
        // Get the checkbox
        var onlineonly_check = document.getElementById("onlineonly_check");
        gOnlineOnly = onlineonly_check.checked;
        // If the checkbox is checked, display the output text
        if (onlineonly_check.checked == true){
          document.getElementById("state_drop").disabled=true;
          document.getElementById("area_drop").disabled=true;
          document.getElementById("state_drop").style.backgroundColor = "#e9ecef" ;
          document.getElementById("area_drop").style.backgroundColor="#e9ecef" ;
        } else {
          document.getElementById("state_drop").disabled=false;
          document.getElementById("area_drop").disabled=false;
          document.getElementById("state_drop").style.backgroundColor = "#fff" ;
          document.getElementById("area_drop").style.backgroundColor="#fff" ;
        }
        // checkSelection(onlineonly_check.checked);
       });


      // Populate Area based on selected State
      $('#state_drop').on('change', function(){
        // Initialization
        // Reasign area after the statre change. It suppose to be defaulted to "Select area"
        gArea = '';
        gAreaName = '';

        // Get the val and txt of the selected state
        let StateId = $(this).val();
        let StateName = $(this).find("option:selected").text();
        gState = StateId;
        gStateName = StateName

        let select_area = document.getElementById("area_drop");
        // Clear the area option first, except the first one. 100 is just a magic number
        for(i=1; i <= 100; i++){
            select_area.remove(1);
        }

        // Generate all cities based on stateId
        if  (!(StateId == "" || StateId == null )){
          let stateInfo = selectCityListBasedOnStateId (gState);
          for (let i = 0; i < stateInfo[0].length; i++) {
            let el = document.createElement("option");
            el.textContent = stateInfo[0][i];
            el.value = stateInfo[1][i];;
            select_area.appendChild(el);
          }
        }
      });

      // ------Area Dropdown Start------- //
      $('#area_drop').on('change', function(){
          gArea = $(this).val()
          gAreaName = $(this).find("option:selected").text();
      });

      // Populate Time Slot
      $('#btnAddTimeSlot').on('click', function(e) {

        e.preventDefault();

        // create empty timeslot placeholder
        addTimeSlot('','','');

        // Reinit the time picker
        initTimePicker();
      });

      // Add / Edit Lesson Modal
      $('#addLessonModal').on('show.bs.modal', function (event) {
        // var button = $(event.relatedTarget) // Button that triggered the modal
        // KEY = button.data('key') // Extract info from data-* attributes
        // DATETIME = button.data('datetime') // Extract info from data-* attributes

        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        // var modal = $(this)
        // modal.find('.modal-title').text(DATETIME)
        // modal.find('.modal-body input').val(KEY);

      });

      // Add Lesson Modal: Add new lesson
      $('#btnAddLessonModalUpdate').on('click', function (event) {
        let validateField = ValidateFields('addLessonModal');
        if (validateField){
          let newLessonId = UploadToDBLesson();

          $('#addLessonModal').modal('hide');

        }else{
          // Do nothing
        }
      });

      // Add Lesson Modal: Clear fields
      $('#addLessonModal').on('hide.bs.modal', function (event) {
        document.getElementById('datepicker').value = '';
        document.getElementById('addLessonStart').value = '';
        document.getElementById('addLessonEnd').value = '';
        document.getElementById('addLessonDesc').value = '';
        document.getElementById('addLessonFeedback').value = '';
        $('#addLessonRate').rating('reset').val();
        $('#btnAddLessonModalUpdate').prop('disabled', true);
      });

      $('#datepicker').on('change', function(){
        // console.log($(this).val().length)
        if( $(this).val().length === 0 || $('#addLessonStart').val().length === 0 || $('#addLessonEnd').val().length === 0) {
          $('#btnAddLessonModalUpdate').prop('disabled', true);
        }else{
          $('#btnAddLessonModalUpdate').prop('disabled', false);
        }
      });
      $('#addLessonStart').on('change', function(){
        if( $(this).val().length === 0 || $('#addLessonEnd').val().length === 0 || $('#datepicker').val().length === 0 ) {
          $('#btnAddLessonModalUpdate').prop('disabled', true);
        }else{
          $('#btnAddLessonModalUpdate').prop('disabled', false);
        }
      });
      $('#addLessonEnd').on('change', function(){
        if( $(this).val().length === 0 || $('#addLessonStart').val().length === 0 || $('#datepicker').val().length === 0) {
          $('#btnAddLessonModalUpdate').prop('disabled', true);
        }else{
          $('#btnAddLessonModalUpdate').prop('disabled', false);
        }
      });

      // Edit Lesson Modal: Update lesson
      $('#btnEditLessonModalUpdate').on('click', function (event) {
        let validateField = ValidateFields('editLessonModal');
        if (validateField){
          UploadChangesToDBLesson();
          // if (!(UploadChangesToDBLesson())){
          //   alert('Error: Edit lesson failed. Please try again.')
          // }else{
          //   // Do nothing
          // }
          $('#editLessonModal').modal('hide');
        }else{
          // Do nothing
        }
      });

      // Edit Lesson Modal: Assign values
      $('#editLessonModal').on('show.bs.modal', function (event) {
        let button = $(event.relatedTarget) // Button/Components that triggered the modal
        // Extract info from data-* attributes
        ID = button.data('id')
        DATE = button.data('date')
        START = button.data('start')
        END = button.data('end')
        DESC = button.data('desc')
        FEEDBACK = button.data('feedback')
        RATE = button.data('rate')
        // Load Desription
        document.getElementById("editLessonId").setAttribute('value', ID);
        document.getElementById("editLessonDatepicker").value = DATE;
        document.getElementById("editLessonStart").value = START;
        document.getElementById("editLessonEnd").value = END;
        document.getElementById("editLessonDesc").value = DESC;
        document.getElementById("editLessonFeedback").value = FEEDBACK;
        document.getElementById("editLessonRate").value = RATE;
        $('#editLessonRate').rating('update', parseFloat(RATE));
      });

      // Edit Lesson Modal: Clear key and fields in modal when modal dismiss
      $('#editLessonModal').on('hide.bs.modal', function (event) {
        ID = "";
        DATE = "";
        START = "";
        END = "";
        DESC = "";
        FEEDBACK = "";
        RATE = "";

        $('#btnEditLessonModalUpdate').prop('disabled', true);
        // document.getElementById("modalClassAnnouncement").textContent = "";
      });

      $('#editLessonStart').on('change', function(){
        if( $(this).val().length === 0 || $('#editLessonEnd').val().length === 0 || $('#editLessonDatepicker').val().length === 0 ) {
          $('#btnEditLessonModalUpdate').prop('disabled', true);
        }else{
          $('#btnEditLessonModalUpdate').prop('disabled', false);
        }
      });
      $('#editLessonEnd').on('change', function(){
        if( $(this).val().length === 0 || $('#editLessonStart').val().length === 0 || $('#editLessonDatepicker').val().length === 0) {
          $('#btnEditLessonModalUpdate').prop('disabled', true);
        }else{
          $('#btnEditLessonModalUpdate').prop('disabled', false);
        }
      });

      $('#editLessonDesc').on('input', function(){
        $('#btnEditLessonModalUpdate').prop('disabled', false);
      });

      $('#editLessonFeedback').on('input', function(){
        $('#btnEditLessonModalUpdate').prop('disabled', false);
      });

      $('#editLessonRate').on('change', function(){
        $('#btnEditLessonModalUpdate').prop('disabled', false);
      })

      $('#editLessonRate').on('change', function(){
        // $('#addLessonModal').modal('hide');
      })

      // Show Remove Lesson Modal
      $('#delLessonModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        CURRENT_LESSON_ID = button.data('id') // Extract info from data-* attributes
        CURRENT_LESSON_DATE = button.data('lessondate') // Extract info from data-* attributes

        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        var modal = $(this)
        modal.find('.modal-title').text('Deleting lesson on '+ CURRENT_LESSON_DATE)
        document.getElementById("deleteLessonId").setAttribute('value', CURRENT_LESSON_ID);

      });

      // Remove Lesson from class
      $('#btnDelLessonModalUpdate').on('click', function (event) {
        let lessonId =  document.getElementById("deleteLessonId").getAttribute('value');
        RemoveLesson();

      });

      // Remove Lesson Modal: Clear key and fields in modal when modal dismiss
      $('#delLessonModal').on('hide.bs.modal', function (event) {
        CURRENT_LESSON_ID = "";
        CURRENT_LESSON_DATE = "";
      });

      // General Panel: Character limitations
      $('#inClassName').on('input', function(){
        document.getElementById("countClassName").textContent = this.value.length + '/40'
      });

      $('#inClassDesc').on('input', function(){
        document.getElementById("countClassDesc").textContent = this.value.length + '/400'
      });

      $('#inVenue').on('input', function(){
        document.getElementById("countClassVenue").textContent = this.value.length + '/250'
      });

      $('#inUrlClass').on('change', function(){

        if (isValidHttpUrl(this.value)){
          let uri = checkDomainNameException(this.value)
          document.getElementById("inUrlClassIcon").src = uri;
          document.getElementById("inUrlClassIconWrapper").setAttribute("onclick", "RedirectTo('"+this.value+"')");
        }else{
          document.getElementById("inUrlClassIcon").src = "../../assets/img/broken-link.png";
          document.getElementById("inUrlClassIconWrapper").setAttribute("onclick", "");
        }
      });

      $('#inUrlGroup').on('keyup', function(){

        if (isValidHttpUrl(this.value)){
          let uri = checkDomainNameException(this.value)
          document.getElementById("inUrlGroupIcon").src = uri;
          document.getElementById("inUrlGroupIconWrapper").setAttribute("onclick", "RedirectTo('"+this.value+"')");
        }else{
          document.getElementById("inUrlGroupIcon").src = "../../assets/img/broken-link.png";
          document.getElementById("inUrlGroupIconWrapper").setAttribute("onclick", "");
        }
      });

      $('#inUrlMaterial').on('change', function(){

        if (isValidHttpUrl(this.value)){
          let uri = checkDomainNameException(this.value)
          document.getElementById("inUrlMaterialIcon").src = uri;
          // document.getElementById("inUrlMaterialIcon").src = "http://www.google.com/s2/favicons?domain="+this.value;
          document.getElementById("inUrlMaterialIconWrapper").setAttribute("onclick", "RedirectTo('"+this.value+"')");
        }else{
          document.getElementById("inUrlMaterialIcon").src = "../../assets/img/broken-link.png";
          document.getElementById("inUrlMaterialIconWrapper").setAttribute("onclick", "");
        }
      });


      // General Panel: Script to trigger the select image
      $('#tutorImgUrl').click(function(){
        if (document.getElementById("classStatusRadioActive").checked){
          $('#select_image').trigger('click');
        }
      });


      // Load all Admin Students
      $('#addStudentModal').on('show.bs.modal', function (event) {
        latestAdminStuDoc = null;
        allStuModuleDoc = []; // Init All Students Doc array
        stuAdminLoadmore.addEventListener('click', stuAdminLoadMoreHandleClick );
        loadAllAdminStudents();
      });

      // Remove all Admin Students when the Add Student Modal close
      $('#addStudentModal').on('hidden.bs.modal', function (event) {
        // NOTE: div:gt(4) - get the 5th div child in the parent node.
        $('#add-student-modal-container div:gt(4)').remove();

        // Clear All Students Doc array
        allStuModuleDoc = [];

      });

     // Remove Student from class Modal show
     $('#delStudentModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        STUDENT_CLASS_ID = button.data('id') // Extract info from data-* attributes
        CLASS_STUDENT_DOC_ID = button.data('stuid') // Extract info from data-* attributes
        STUDENT_NAME = button.data('stuname') // Extract info from data-* attributes
        GUARDIAN_ID = button.data('gurid') // Extract info from data-* attributes

        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        var modal = $(this)
        modal.find('.modal-title').text('Deleting '+ STUDENT_NAME)
        document.getElementById("deleteStudentClassId").setAttribute('value', STUDENT_CLASS_ID);
        document.getElementById("deleteStudentName").setAttribute('value', STUDENT_NAME);
        document.getElementById("deleteStudentId").setAttribute('value', CLASS_STUDENT_DOC_ID);
        document.getElementById("deleteGuardianId").setAttribute('value', GUARDIAN_ID);

      });

     // Remove Student from class
     $('#btnDelStudentModalUpdate').on('click', function (event) {
        let studentClassId =  document.getElementById("deleteStudentClassId").getAttribute('value');
        let studentName =  document.getElementById("deleteStudentName").getAttribute('value');
        let studentId =  document.getElementById("deleteStudentId").getAttribute('value');
        let guardianId =  document.getElementById("deleteGuardianId").getAttribute('value');
        // console.log(studentClassId, studentName, studentId, guardianId );
        removeStudent(studentClassId, studentName, studentId, guardianId );

      });

     // Remove Student Modal: Clear key and fields in modal when modal dismiss
     $('#delStudentModal').on('hide.bs.modal', function (event) {
        CLASS_STUDENT_DOC_ID = "";
        STUDENT_NAME = "";
      });

     // Edit Students
     $('#editStudentModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        CLASS_STUDENT_DOC_ID = button.data('id') // CLASS_STUDENT_ID
        STUDENT_NAME = button.data('stuname') // CLASS_STUDENT_STU_NAME
        STUDENT_ENROLLMENT_STATUS = button.data('enrollmentstatus') // CLASS_STUDENT_ENROLLMENT_STATUS
        // console.log(CLASS_STUDENT_DOC_ID);
        // console.log(STUDENT_NAME);
        // console.log(STUDENT_ENROLLMENT_STATUS);
        // console.log(allClassStuDoc);

        // Find the right students from allClassStuDoc based on the student id
        let selectedClassStuDoc = null;

        allClassStuDoc.forEach((doc) => {
          // console.log(doc);
          if (CLASS_STUDENT_DOC_ID === doc.id){
            selectedClassStuDoc = doc;
          }
        });

        document.getElementById("editClassStudentDocId").setAttribute('value', CLASS_STUDENT_DOC_ID);
        document.getElementById("editStudentId").setAttribute('value', selectedClassStuDoc[CLASS_STUDENT_STU_ID]);
        document.getElementById("editGuardianId").setAttribute('value', selectedClassStuDoc[CLASS_STUDENT_GUR_ID]);
        document.getElementById("editStudentEnrollmentStatus").setAttribute('value', STUDENT_ENROLLMENT_STATUS);
        document.getElementById("stuName").value = selectedClassStuDoc[CLASS_STUDENT_STU_NAME];
        document.getElementById("stuPhone").value = selectedClassStuDoc[CLASS_STUDENT_STU_PHONE];
        document.getElementById("stuEmail").value = selectedClassStuDoc[CLASS_STUDENT_STU_EMAIL];
        document.getElementById("stuGenderMale").checked = selectedClassStuDoc[CLASS_STUDENT_STU_GENDER] === 0 ? true : false;
        document.getElementById("stuGenderFemale").checked = selectedClassStuDoc[CLASS_STUDENT_STU_GENDER] === 1 ? true : false;
        document.getElementById("gurName").value = selectedClassStuDoc[CLASS_STUDENT_GUR_NAME];
        document.getElementById("gurPhone").value = selectedClassStuDoc[CLASS_STUDENT_GUR_PHONE];
        document.getElementById("gurEmail").value = selectedClassStuDoc[CLASS_STUDENT_GUR_EMAIL];
        document.getElementById("gurAddr").value = selectedClassStuDoc[CLASS_STUDENT_GUR_ADDR];
        document.getElementById("stuFeedback").value = selectedClassStuDoc[CLASS_STUDENT_FEEDBACK];

        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        var modal = $(this)

        if (STUDENT_ENROLLMENT_STATUS === CLASS_STUDENT_ENROLLMENT_STATUS_PENDING){
          modal.find('.modal-title').text('New Student: '+STUDENT_NAME)
          document.getElementById("btnEditStudentModalUpdate").setAttribute('class', 'btn btn-warning');
          document.getElementById("btnEditStudentModalUpdate").textContent = 'Approve New Student'
        }else if (STUDENT_ENROLLMENT_STATUS === CLASS_STUDENT_ENROLLMENT_STATUS_ACTIVE){
          modal.find('.modal-title').text(STUDENT_NAME)
          document.getElementById("btnEditStudentModalUpdate").setAttribute('class', 'btn btn-primary');
          document.getElementById("btnEditStudentModalUpdate").textContent = 'Update'
        }else{
          modal.find('.modal-title').text(STUDENT_NAME)
          document.getElementById("btnEditStudentModalUpdate").setAttribute('class', 'btn btn-primary');
          document.getElementById("btnEditStudentModalUpdate").textContent = 'Update'
        }

      });

      // Update Student's Feedback from class
      $('#btnEditStudentModalUpdate').on('click', function (event) {
        let classStudentDocId =  document.getElementById("editClassStudentDocId").getAttribute('value');
        let studentId =  document.getElementById("editStudentId").getAttribute('value');
        let guardianId =  document.getElementById("editGuardianId").getAttribute('value');
        let studentName = document.getElementById("stuName").value;
        let studentFeedback =  document.getElementById("stuFeedback").value;
        let studenEnrollmentStatus=  document.getElementById("editStudentEnrollmentStatus").getAttribute('value');

        updateStudent(classStudentDocId, studentId, guardianId, studentName, studentFeedback, studenEnrollmentStatus);

      });

      // Remove Student Modal: Clear key and fields in modal when modal dismiss
      $('#editStudentModal').on('hide.bs.modal', function (event) {
        CLASS_STUDENT_DOC_ID = "";
        STUDENT_NAME = "";
        STUDENT_ENROLLMENT_STATUS = "";

        document.getElementById("editClassStudentDocId").setAttribute('value', "");
        document.getElementById("editStudentId").setAttribute('value', "");
        document.getElementById("editGuardianId").setAttribute('value', "");
        document.getElementById("editStudentEnrollmentStatus").setAttribute('value', "");
        document.getElementById("stuName").value = "";
        document.getElementById("stuPhone").value = "";
        document.getElementById("stuEmail").value = "";
        document.getElementById("stuGenderMale").checked = false;
        document.getElementById("stuGenderFemale").checked = false;
        document.getElementById("gurName").value = "";
        document.getElementById("gurPhone").value = "";
        document.getElementById("gurEmail").value = "";
        document.getElementById("gurAddr").value = "";
        document.getElementById("stuFeedback").value = "";

      });


      // Load All Admin's Teachers
      $('#myTeacherModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        tutorBtnNum = parseInt(button.data('num')); // Extract info from data-* attributes
        latestAdminTutorDoc = null;
        loadAllAdminTeachers(tutorBtnNum);

        // Specific to myself
        // const btnSelectMyself = document.getElementById('btnSelectMyself');
        // btnSelectMyself.setAttribute('onclick', "AddNewTutorToDB("+ tutorBtnNum+", '"+ ent_id+"', `"+ent_name+"`, '"+ent_phone+"', `"+ent_imgUrl+"`)");

      });

      // Remove all Admin's Teachers when the List Teacher Modal close
      $('#myTeacherModal').on('hidden.bs.modal', function (event) {
        // NOTE: div:gt(5) - get the 6th div child in the parent node.
        // NOTE: div:gt(7) - get the 7th div child in the parent node. (myself)
        // $('#add-tutor-modal-container div:gt(12)').remove();

        $('#add-tutor-modal-container div:gt(5)').remove();
        tutorBtnNum = 0;
      });

      // Remove Teacher 2
      $('#btnDelTutor2ModalUpdate').on('click', function (event) {
        removeTutor2FromDB();
      });

      // Advanced Panel
      $('#classTypeRadioPublic').on('change', function (event) {
        if (this.checked){
          document.getElementById("levelSubjectTop").style.display = 'flex';
          document.getElementById("onlineOnlyTop").style.display = 'flex';
          document.getElementById("areaStateTop").style.display = 'flex';
          document.getElementById("publicTab").style.display = 'flex';

          // Go To Public Tab
          //set all steps before clicked (and clicked too) to active
          setActiveStep(7);
          //open active panel
          setActivePanel(7);

        }else{
          document.getElementById("levelSubjectTop").style.display = 'none';
          document.getElementById("onlineOnlyTop").style.display = 'none';
          document.getElementById("areaStateTop").style.display = 'none';
          document.getElementById("publicTab").style.display = 'none';
        }
      });

      $('#classTypeRadioPrivate').on('change', function (event) {
        if (this.checked){
          document.getElementById("levelSubjectTop").style.display = 'none';
          document.getElementById("onlineOnlyTop").style.display = 'none';
          document.getElementById("areaStateTop").style.display = 'none';
          document.getElementById("publicTab").style.display = 'none';
        }else{
          document.getElementById("levelSubjectTop").style.display = 'flex';
          document.getElementById("onlineOnlyTop").style.display = 'flex';
          document.getElementById("areaStateTop").style.display = 'flex';
          document.getElementById("publicTab").style.display = 'flex';
        }
      });

      // Advanced panel: Class Status
      $('#classStatusRadioInactive').on('change', function (event) {
        if (this.checked){
          disableAllEdits()
        }
      });

      $('#classStatusRadioActive').on('change', function (event) {
        if (this.checked){
          enableAllEdits()
        }
      });

      $('#stuAutoJoinEn').on('change', function (event) {
        if (this.checked){
          document.getElementById("inAutoJoinLinkTop").style.display = 'initial';
          document.getElementById("btnAutoJoinLink2").className = "btn btn-success";
          document.getElementById("btnAutoJoinLink2").style.pointerEvents= 'auto';

        }else{
          document.getElementById("inAutoJoinLinkTop").style.display = 'none';
          document.getElementById("btnAutoJoinLink2").className = "btn btn-default";
          document.getElementById("btnAutoJoinLink2").style.pointerEvents= 'none';
        }
      });


      // Advanced panel: Reactivate Class btn clicked
      $('#btnReactivateModalUpdate').on('click', function (event) {
        ReactivateClass(currentClassObj[CLASS_ID]);
      });

      // Advanced panel: Delete Class
      $('#delClassModalIn').on('input', function(){
        if (this.value === 'DELETE'){
          $('#btnDelClassModalUpdate').prop('disabled', false);
        }
        else{
          $('#btnDelClassModalUpdate').prop('disabled', true);
        }
      });

      // Advanced panel: Delete Class btn clicked
      $('#btnDelClassModalUpdate').on('click', function (event) {
        DeleteClass(currentClassObj[CLASS_ID]);
      });

      // Update data - Save btn clicked
      $('#btnSaveModalUpdate').on('click', function (event) {
        getAllTimeSlots();
        UpdateClass(currentClassObj[CLASS_ID]);
      });

      // Ribbon
      $('#inLabelColor').on('blur', function (event) {
        let color = $('#inLabelColor').val()
        document.getElementById("inLabelSample").style.background = color;
      });

      $('#inLabelText').on('blur', function (event) {
        let color = $('#inLabelText').val()
        document.getElementById("inLabelSample").textContent = $(this).val();
      });

      $('#tAddRibbonEn').on('change', function (event) {
        if (this.checked){
          document.getElementById("inRibbonSettings").style.display = '';
        }else{
          document.getElementById("inRibbonSettings").style.display = 'none';
        }
      });

    });

  </script>

  <!-- Multiform-specific script -->
  <script>
    //DOM elements
    const DOMstrings = {
      stepsBtnClass: 'multitabs-form__progress-btn',
      stepsBtns: document.querySelectorAll(`.multitabs-form__progress-btn`),
      stepsBar: document.querySelector('.multitabs-form__progress'),
      stepsForm: document.querySelector('.multitabs-form__form'),
      stepsFormTextareas: document.querySelectorAll('.multitabs-form__textarea'),
      stepFormPanelClass: 'multitabs-form__panel',
      stepFormPanels: document.querySelectorAll('.multitabs-form__panel'),
      stepPrevBtnClass: 'js-btn-prev',
      stepNextBtnClass: 'js-btn-next',
      stepSendBtnClass: 'js-btn-send' };

    //remove class from a set of items
    const removeClasses = (elemSet, className) => {

      elemSet.forEach(elem => {

        elem.classList.remove(className);

      });

    };

    //return exect parent node of the element
    const findParent = (elem, parentClass) => {

      let currentNode = elem;

      while (!currentNode.classList.contains(parentClass)) {
        currentNode = currentNode.parentNode;
      }

      return currentNode;

    };

    //get active button step number
    const getActiveStep = elem => {
      return Array.from(DOMstrings.stepsBtns).indexOf(elem);
    };

    //set all steps before clicked (and clicked too) to active
    const setActiveStep = activeStepNum => {

      //remove active state from all the state
      removeClasses(DOMstrings.stepsBtns, 'js-active');

      //set picked items to active
      DOMstrings.stepsBtns.forEach((elem, index) => {

        if (index == activeStepNum) {
          elem.classList.add('js-active');
        }

      });
    };

    //get active panel
    const getActivePanel = () => {

      let activePanel;

      DOMstrings.stepFormPanels.forEach(elem => {

        if (elem.classList.contains('js-active')) {

          activePanel = elem;

        }

      });

      return activePanel;

    };

    //open active panel (and close unactive panels)
    const setActivePanel = activePanelNum => {

      //remove active class from all the panels
      removeClasses(DOMstrings.stepFormPanels, 'js-active');

      //show active panel
      DOMstrings.stepFormPanels.forEach((elem, index) => {
        if (index === activePanelNum) {

          elem.classList.add('js-active');

          setFormHeight(elem);

        }
      });

    };

    //set form height equal to current panel height
    const formHeight = activePanel => {

      const activePanelHeight = activePanel.offsetHeight;

      DOMstrings.stepsForm.style.height = `${activePanelHeight}px`;

    };

    const setFormHeight = () => {
      const activePanel = getActivePanel();

      formHeight(activePanel);
    };

    //STEPS BAR CLICK FUNCTION
    DOMstrings.stepsBar.addEventListener('click', e => {

      //check if click target is a step button
      const eventTarget = e.target;

      if (!eventTarget.classList.contains(`${DOMstrings.stepsBtnClass}`)) {
        return;
      }



      //get active button step number
      const activeStep = getActiveStep(eventTarget);

      //set all steps before clicked (and clicked too) to active
      setActiveStep(activeStep);

      //open active panel
      setActivePanel(activeStep);
    });

    //PREV/NEXT BTNS CLICK
    DOMstrings.stepsForm.addEventListener('click', e => {

      const eventTarget = e.target;

      //check if we clicked on `PREV` or NEXT` buttons
      if (eventTarget.classList.contains(`${DOMstrings.stepSendBtnClass}`))
      {
        // Create Class btn is clicked
        // /Class/v1/Class/ZGeLtRmzIaOPuBkbhHTH
        var docRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .doc();

        // Notice that I use .add(..), instead of .set(..). This is because the docRef do not specify the docId.

        // func.showNotification('top','center', 'success', 'check_circle', "Class created.");
      }
      else if (eventTarget.classList.contains(`${DOMstrings.stepPrevBtnClass}`) || eventTarget.classList.contains(`${DOMstrings.stepNextBtnClass}`))
      {
        // Proceed to move to next / prev page
      }else{
        // Do nothing and return
        return;

      }

      //find active panel
      const activePanel = findParent(eventTarget, `${DOMstrings.stepFormPanelClass}`);

      let activePanelNum = Array.from(DOMstrings.stepFormPanels).indexOf(activePanel);
      getAllTimeSlots()
      //set active step and active panel onclick
      if (eventTarget.classList.contains(`${DOMstrings.stepPrevBtnClass}`)) {
        activePanelNum--;

        setActiveStep(activePanelNum);
        setActivePanel(activePanelNum);
      } else {

        if (!validateForm(activePanelNum)){

        }else{
          activePanelNum++;
          setActiveStep(activePanelNum);
          setActivePanel(activePanelNum);
        }
      }
      // setActiveStep(activePanelNum);
      // setActivePanel(activePanelNum);
    });

    //SETTING PROPER FORM HEIGHT ONLOAD
    window.addEventListener('load', setFormHeight, false);

    //SETTING PROPER FORM HEIGHT ONRESIZE
    window.addEventListener('resize', setFormHeight, false);

    //changing animation via animation select !!!YOU DON'T NEED THIS CODE (if you want to change animation type, just change form panels data-attr)

    const setAnimationType = newType => {
      DOMstrings.stepFormPanels.forEach(elem => {
        elem.dataset.animation = newType;
      });
    };

    //selector onchange - changing animation
    // const animationSelect = document.querySelector('.pick-animation__select');

    // animationSelect.addEventListener('change', () => {
    //   const newAnimationType = animationSelect.value;

    //   setAnimationType(newAnimationType);
    // });


    // <!--General form panel-->
    // <div class="multitabs-form__panel shadow p-4 rounded bg-white js-active" data-animation="scaleIn">
    //   <h4 class="multitabs-form__title">General Info</h4>
    //   <div class="multitabs-form__content">
    //     <div class="col-md-12">

    //       <div class="form-group" style="margin-top: 2rem;">
    //         <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Class Name*</span>
    //         <input type="text" class="form-control" id="inClassName">
    //       </div>


    function validateForm(activePanelNum) {
      // This function deals with validation of the form fields with data-compulsory = 'true'
      var x, y, i, valid = true;
      x = document.getElementsByClassName("multitabs-form__panel");
      // y = x[activePanelNum].getElementsByTagName("input") && x[activePanelNum].querySelectorAll('[type="text"]');
      y =x[activePanelNum].querySelectorAll('[data-compulsory="true"]');

      // A loop that checks every input field in the current tab:
      for (i = 0; i < y.length; i++) {
        // console.log(y[i].value)
        // If a field is empty...
        if (y[i].value == "") {
          // add an "invalid" class to the field:
          y[i].className += " invalid";
          // and set the current valid status to false:
          valid = false;
        }
      }
      // If the valid status is true, mark the step as finished and valid:
      if (valid) {
        // document.getElementsByClassName("step")[activePanelNum].className += " finish";
      }
      return valid; // return the valid status
    }

    // function getAllTimeSlots() {
    //   dayOfWeekArr = [];
    //   startTimeArr = [];
    //   endTimeArr = [];
    //   // This function deals with validation of the form fields with data-compulsory = 'true'
    //   var x, y, i, valid = true;
    //   x = document.getElementById("timeSlotTop");
    //   console.log(x)
    //   // y = x[activePanelNum].getElementsByTagName("input") && x[activePanelNum].querySelectorAll('[type="text"]');
    //   y =x.querySelectorAll('[data-compulsory="true"]');

    //   // A loop that checks every input field in the current tab:
    //   for (i = 0; i < y.length; i++) {

    //     if (i % 3 === 0){
    //       dayOfWeekArr.push(y[i].value)
    //     }
    //     if (i % 3 === 1){
    //       startTimeArr.push(y[i].value)
    //     }
    //     if (i % 3 === 2){
    //       endTimeArr.push(y[i].value)
    //     }


    //     // If a field is empty...
    //     if (y[i].value == "") {
    //       // add an "invalid" class to the field:
    //       // y[i].className += " invalid";
    //       // and set the current valid status to false:
    //       valid = false;
    //     }
    //   }

    //   // console.log(dayOfWeekArr)
    //   // console.log(startTimeArr)
    //   // console.log(endTimeArr)
    //   return valid; // return the valid status
    // }


  </script>


  <!-- ClockPicker script 2 -->
  <script type="text/javascript">
    $('.clockpicker').clockpicker()
      .find('input').change(function(){
        // TODO: time changed
        // console.log(this.value);
      });

    // Date picjer
    // Source: https://mcdatepicker.netlify.app/docs/
    const calendarTheme = {
      theme_color: '#2e74b6', //#19212b
      main_background: '#FBFBFB',
      active_text_color: 'rgba(62,85,110,0.85)',
      inactive_text_color: '#cfe6ff',
      picker_header: {
        active: '#8ea5bd'
      },
      weekday: {
        foreground: '#2e74b6' //rgba(35,68,97,0.8)
      },
      display: {
        foreground: '#8ea5bd'
      },
      date: {
        active: {
          picked: {
            background: '#2e74b6'
          }
        },
        marcked: {
          foreground: '#53a6fa'
        }
      },
      button: {
        danger: {
          foreground: '#af002a'
        },
        success: {
          foreground: '#2e74b6'
        }
      }
    };

    const addLessonModalDatePicker = MCDatepicker.create({
      el: '#datepicker',
      bodyType: 'inline',
      // autoClose: true,
      // closeOnBlur: true,
      dateFormat: 'dd/mm/yyyy', //dateFormat: 'dddd, dd mmmm yyyy',
      // disableDates: [new Date(2021, 1, 12), new Date(2021, 4, 15)],
      selectedDate: new Date(),
      firstWeekday: 1,
      minDate: new Date(2020, 0, 1),
      // maxDate: new Date(2023, 3, 22),
      // markDates: [new Date(2021, 2, 21), new Date(2021, 3, 1)],
      // disableYears: [2020],
      // disableMonths: [8],
      customClearBTN: '',
      theme: calendarTheme
    });
    const editLessonModalDatePicker = MCDatepicker.create({
      el: '#editLessonDatepicker',
      bodyType: 'inline',
      dateFormat: 'dd/mm/yyyy',
      selectedDate: new Date(),
      firstWeekday: 1,
      minDate: new Date(2020, 0, 1),
      customClearBTN: '',
      theme: calendarTheme
    });

    const firstClassDatePicker = MCDatepicker.create({
      el: '#firstClassDatePicker',
      bodyType: 'inline',
      dateFormat: 'dd/mm/yyyy',
      selectedDate: new Date(),
      firstWeekday: 1,
      minDate: new Date(2020, 0, 1),
      customClearBTN: '',
      theme: calendarTheme
    });

    editLessonModalDatePicker.onSelect((date, formatedDate) => {
      if($('#editLessonStart').val().length === 0 || $('#editLessonEnd').val().length === 0) {
        $('#btnEditLessonModalUpdate').prop('disabled', true);
      }else{
        $('#btnEditLessonModalUpdate').prop('disabled', false);
      }

    });

    // Close the datepicker if we clicked on other components
    document.querySelector('#addLessonModal').addEventListener('click', e => {
      const eventTarget = e.target;
      if (!(eventTarget.id == "datepicker"))// || eventTarget.id == "datepicker_btn"))
      {
        addLessonModalDatePicker.close();
      }
      else{
      }
    });
    // Close the datepicker if we clicked on other components
    document.querySelector('#editLessonModal').addEventListener('click', e => {
      const eventTarget = e.target;
      if (!(eventTarget.id == "editLessonDatepicker"))// || eventTarget.id == "datepicker_btn"))
      {
        editLessonModalDatePicker.close();
      }
      else{
      }
    });

  </script>

  <!-- Upload Class Icon -->
  <script>

    var fileinput = document.getElementById('select_image');

    var form = document.getElementById('tutorImgUrl');

    // === RESIZE ====
    var max_height = 1024;
    var max_width = 1024;
    var width = 0;
    var height = 0;

    function uploadImage( file, type, id, size, width, height ){

      if(file != null) {
        $('#uploadModal').modal('show');

        // Create a root reference
        var storageRef = firebase.storage().ref("uploads");
        // Create a reference to 'ent_id.<imgType>'
        var metadata = {
          contentType: type, // Predefined by firestore
          customMetadata: {
            'id': id,
            'size': size,
            'width': width,
            'height': height
          }
        };

        // Upload file and metadata to the object 'images/mountains.jpg'
        var uploadTask = storageRef.child('class_icon/' + currentClassObj[CLASS_ID]).putString(file, 'data_url', metadata);

        var elem = document.getElementById("myBar");
        // Listen for state changes, errors, and completion of the upload.
        uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
          (snapshot) => {
            // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
            elem.style.width = progress + "%";

            switch (snapshot.state) {
              case firebase.storage.TaskState.PAUSED: // or 'paused'
                console.log('Upload is paused');
                func.showNotification('top','center', 'danger', 'error_outline', "Upload is paused. Please try again." );

                break;
              case firebase.storage.TaskState.RUNNING: // or 'running'
                console.log('Upload is running');
                break;
            }

          },
          (error) => {
            // A full list of error codes is available at
            // https://firebase.google.com/docs/storage/web/handle-errors
            switch (error.code) {
              case 'storage/unauthorized':
                // User doesn't have permission to access the object
                // alert("Upload failed. Please try again.")
                func.showNotification('top','center', 'danger', 'error_outline', "You do not have permission to upload. Please contact us." );

                $('#uploadModal').modal('hide');
                break;
              case 'storage/canceled':
                // User canceled the upload
                // alert("Upload canceled.")
                func.showNotification('top','center', 'danger', 'error_outline', "Upload canceled." );

                $('#uploadModal').modal('hide');
                break;

              // ...

              case 'storage/unknown':
                // alert("Upload failed. Please try again.");
                func.showNotification('top','center', 'danger', 'error_outline', "Upload failed. Please try again." );

                $('#uploadModal').modal('hide');
                // Unknown error occurred, inspect error.serverResponse
                break;
            }
          },
          () => {
            // Upload completed successfully, now we can get the download URL
            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {

              imgUrl_temp = downloadURL;

              // Once uploaded, update the new url
              let docRef = db.collection("Class").doc('v2').collection("Class").doc(currentClassObj[CLASS_ID]);
              let docRefWithMerge = docRef.set({
                [CLASS_IMG_URL]: imgUrl_temp
              }, { merge: true });


              $('#uploadModal').modal('hide');
              func.showNotification('top','center', 'success', 'check_circle', "New class icon added." );
            });
          }
        );

      }
    }

    function processfile(file) {

        if( !( /image/i ).test( file.type ) )
            {
                alert( "File "+ file.name +" is not an image." );
                return false;
            }

        // read the files
        var reader = new FileReader();
        reader.readAsArrayBuffer(file);

        reader.onload = function (event) {
          // blob stuff
          var blob = new Blob([event.target.result]); // create blob...
          window.URL = window.URL || window.webkitURL;
          var blobURL = window.URL.createObjectURL(blob); // and get it's URL

          // helper Image object
          var image = new Image();
          image.src = blobURL;
          //preview.appendChild(image); // preview commented out, I am using the canvas instead
          image.onload = function() {
            // have to wait till it's loaded
            var resized = resizeMe(image); // send it to canvas
            // var newinput = document.createElement("input");
            // newinput.type = 'hidden';
            // newinput.name = 'images[]';
            // newinput.value = resized; // put result from canvas into new hidden input
            form.src = resized;
            var head = 'data:image/jpeg;base64,';
            // console.log(Math.round((resized.length - head.length)*3/4));
            size = Math.round((resized.length - head.length)*3/4)

            // Set classId = '' because we dont created it yet
            uploadImage(resized, 'image/jpeg', currentClassObj[CLASS_ID], size, width, height);
          }
        };
    }

    function readfiles(files) {

        // remove the existing canvases and hidden inputs if user re-selects new pics
        var existinginputs = document.getElementsByName('images[]');
        var existingcanvases = document.getElementsByTagName('canvas');
        while (existinginputs.length > 0) { // it's a live list so removing the first element each time
          // DOMNode.prototype.remove = function() {this.parentNode.removeChild(this);}
          form.removeChild(existinginputs[0]);
          // preview.removeChild(existingcanvases[0]);
        }

        for (var i = 0; i < files.length; i++) {
          // console.log(i)
          processfile(files[i]); // process each file at once
        }
        fileinput.value = ""; //remove the original files from fileinput
        // TODO remove the previous hidden inputs if user selects other files
    }

    // this is where it starts. event triggered when user selects files
    fileinput.onchange = function(){
      if ( !( window.File && window.FileReader && window.FileList && window.Blob ) ) {
        alert('The File APIs are not fully supported in this browser.');
        return false;
        }
      readfiles(fileinput.files);
    }


    function resizeMe(img) {

      var canvas = document.createElement('canvas');

      // console.log(width,height )
      width = img.width;
      height = img.height;
      // calculate the width and height, constraining the proportions
      if (width > height) {
        if (width > max_width) {
          //height *= max_width / width;
          height = Math.round(height *= max_width / width);
          width = max_width;
        }
      } else {
        if (height > max_height) {
          //width *= max_height / height;
          width = Math.round(width *= max_height / height);
          height = max_height;
        }
      }

      // resize the canvas and draw the image data into it
      canvas.width = width;
      canvas.height = height;
      var ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, width, height);

      // preview.appendChild(canvas); // do the actual resized preview

      return canvas.toDataURL("image/jpeg",0.7); // get the data from canvas as 70% JPG (can be also PNG, etc.)

    }

  </script>

  <!-- // Tag input  -->
  <!-- <script>
    $(function() {
      $('#form-tags-1').tagsInput();

      $('#form-tags-2').tagsInput({
        'onAddTag': function(input, value) {
          console.log('tag added', input, value);
        },
        'onRemoveTag': function(input, value) {
          console.log('tag removed', input, value);
        },
        'onChange': function(input, value) {
          console.log('change triggered', input, value);
        }
      });

      $('#form-tags-3').tagsInput({
        'unique': true,
        'minChars': 2,
        'maxChars': 10,
        'limit': 5,
        'validationPattern': new RegExp('^[a-zA-Z0-9_]+$')
      });

      $('#form-tags-4').tagsInput({
        'autocomplete': {
          source: [
            'apple',
            'banana',
            'orange',
            'pizza'
          ]
        }
      });

      $('#form-tags-5').tagsInput({
        'delimiter': ';'
      });

      $('#form-tags-6').tagsInput({
        'delimiter': [',', ';']
      });

      let datatag = ['a', 'b', 'c'];
      console.log(datatag[0])
      // $('#form-tags-7').val(datatag);
      $('#form-tags-7').tagsInput({
          'unique': true,
          'minChars': 2,
          'maxChars': 20,
          'limit': 5,
          'validationPattern': new RegExp('^[a-z0-9_]+$')
        }).importTags(datatag[0]);

      datatag.forEach((item)=>{
        console.log(item)
        // $('#form-tags-7').tagsInput({
        //   'unique': true,
        //   'minChars': 2,
        //   'maxChars': 20,
        //   'limit': 5,
        //   'validationPattern': new RegExp('^[a-z0-9_]+$')
        // }).importTags(item);
      });

    });



    /* jQuery Tags Input Revisited Plugin
    *
    * Copyright (c) Krzysztof Rusnarczyk
    * Licensed under the MIT license */

    (function($) {
      var delimiter = [];
      var inputSettings = [];
      var callbacks = [];

      $.fn.addTag = function(value, options) {
        options = jQuery.extend({
          focus: false,
          callback: true
        }, options);

        this.each(function() {
          var id = $(this).attr('id');

          var tagslist = $(this).val().split(_getDelimiter(delimiter[id]));
          if (tagslist[0] === '') tagslist = [];

          value = jQuery.trim(value);

          if ((inputSettings[id].unique && $(this).tagExist(value)) || !_validateTag(value, inputSettings[id], tagslist, delimiter[id])) {
            $('#' + id + '_tag').addClass('error');
            return false;
          }

          $('<span>', {class: 'tag'}).append(
            $('<span>', {class: 'tag-text'}).text(value),
            $('<button>', {class: 'tag-remove'}).click(function() {
              return $('#' + id).removeTag(encodeURI(value));
            })
          ).insertBefore('#' + id + '_addTag');

          tagslist.push(value);

          $('#' + id + '_tag').val('');
          if (options.focus) {
            $('#' + id + '_tag').focus();
          } else {
            $('#' + id + '_tag').blur();
          }

          $.fn.tagsInput.updateTagsField(this, tagslist);

          if (options.callback && callbacks[id] && callbacks[id]['onAddTag']) {
            var f = callbacks[id]['onAddTag'];
            f.call(this, this, value);
          }

          if (callbacks[id] && callbacks[id]['onChange']) {
            var i = tagslist.length;
            var f = callbacks[id]['onChange'];
            f.call(this, this, value);
          }
        });

        return false;
      };

      $.fn.removeTag = function(value) {
        value = decodeURI(value);

        this.each(function() {
          var id = $(this).attr('id');

          var old = $(this).val().split(_getDelimiter(delimiter[id]));

          $('#' + id + '_tagsinput .tag').remove();

          var str = '';
          for (i = 0; i < old.length; ++i) {
            if (old[i] != value) {
              str = str + _getDelimiter(delimiter[id]) + old[i];
            }
          }

          $.fn.tagsInput.importTags(this, str);

          if (callbacks[id] && callbacks[id]['onRemoveTag']) {
            var f = callbacks[id]['onRemoveTag'];
            f.call(this, this, value);
          }
        });

        return false;
      };

      $.fn.tagExist = function(val) {
        var id = $(this).attr('id');
        var tagslist = $(this).val().split(_getDelimiter(delimiter[id]));
        return (jQuery.inArray(val, tagslist) >= 0);
      };

      $.fn.importTags = function(str) {
        var id = $(this).attr('id');
        $('#' + id + '_tagsinput .tag').remove();
        $.fn.tagsInput.importTags(this, str);
      };

      $.fn.tagsInput = function(options) {
        var settings = jQuery.extend({
          interactive: true,
          placeholder: 'Add a tag',
          minChars: 0,
          maxChars: null,
          limit: null,
          validationPattern: null,
          width: 'auto',
          height: 'auto',
          autocomplete: null,
          hide: true,
          delimiter: ',',
          unique: true,
          removeWithBackspace: true
        }, options);

        var uniqueIdCounter = 0;

        this.each(function() {
          if (typeof $(this).data('tagsinput-init') !== 'undefined') return;

          $(this).data('tagsinput-init', true);

          if (settings.hide) $(this).hide();

          var id = $(this).attr('id');
          if (!id || _getDelimiter(delimiter[$(this).attr('id')])) {
            id = $(this).attr('id', 'tags' + new Date().getTime() + (++uniqueIdCounter)).attr('id');
          }

          var data = jQuery.extend({
            pid: id,
            real_input: '#' + id,
            holder: '#' + id + '_tagsinput',
            input_wrapper: '#' + id + '_addTag',
            fake_input: '#' + id + '_tag'
          }, settings);

          delimiter[id] = data.delimiter;
          inputSettings[id] = {
            minChars: settings.minChars,
            maxChars: settings.maxChars,
            limit: settings.limit,
            validationPattern: settings.validationPattern,
            unique: settings.unique
          };

          if (settings.onAddTag || settings.onRemoveTag || settings.onChange) {
            callbacks[id] = [];
            callbacks[id]['onAddTag'] = settings.onAddTag;
            callbacks[id]['onRemoveTag'] = settings.onRemoveTag;
            callbacks[id]['onChange'] = settings.onChange;
          }

          var markup = $('<div>', {id: id + '_tagsinput', class: 'tagsinput'}).append(
            $('<div>', {id: id + '_addTag'}).append(
              settings.interactive ? $('<input>', {id: id + '_tag', class: 'tag-input', value: '', placeholder: settings.placeholder}) : null
            )
          );

          $(markup).insertAfter(this);

          $(data.holder).css('width', settings.width);
          $(data.holder).css('min-height', settings.height);
          $(data.holder).css('height', settings.height);

          if ($(data.real_input).val() !== '') {
            $.fn.tagsInput.importTags($(data.real_input), $(data.real_input).val());
          }

          // Stop here if interactive option is not chosen
          if (!settings.interactive) return;

          $(data.fake_input).val('');
          $(data.fake_input).data('pasted', false);

          $(data.fake_input).on('focus', data, function(event) {
            $(data.holder).addClass('focus');

            if ($(this).val() === '') {
              $(this).removeClass('error');
            }
          });

          $(data.fake_input).on('blur', data, function(event) {
            $(data.holder).removeClass('focus');
          });

          if (settings.autocomplete !== null && jQuery.ui.autocomplete !== undefined) {
            $(data.fake_input).autocomplete(settings.autocomplete);
            $(data.fake_input).on('autocompleteselect', data, function(event, ui) {
              $(event.data.real_input).addTag(ui.item.value, {
                focus: true,
                unique: settings.unique
              });

              return false;
            });

            $(data.fake_input).on('keypress', data, function(event) {
              if (_checkDelimiter(event)) {
                $(this).autocomplete("close");
              }
            });
          } else {
            $(data.fake_input).on('blur', data, function(event) {
              $(event.data.real_input).addTag($(event.data.fake_input).val(), {
                focus: true,
                unique: settings.unique
              });

              return false;
            });
          }

          // If a user types a delimiter create a new tag
          $(data.fake_input).on('keypress', data, function(event) {
            if (_checkDelimiter(event)) {
              event.preventDefault();

              $(event.data.real_input).addTag($(event.data.fake_input).val(), {
                focus: true,
                unique: settings.unique
              });

              return false;
            }
          });

          $(data.fake_input).on('paste', function () {
            $(this).data('pasted', true);
          });

          // If a user pastes the text check if it shouldn't be splitted into tags
          $(data.fake_input).on('input', data, function(event) {
            if (!$(this).data('pasted')) return;

            $(this).data('pasted', false);

            var value = $(event.data.fake_input).val();

            value = value.replace(/\n/g, '');
            value = value.replace(/\s/g, '');

            var tags = _splitIntoTags(event.data.delimiter, value);

            if (tags.length > 1) {
              for (var i = 0; i < tags.length; ++i) {
                $(event.data.real_input).addTag(tags[i], {
                  focus: true,
                  unique: settings.unique
                });
              }

              return false;
            }
          });

          // Deletes last tag on backspace
          data.removeWithBackspace && $(data.fake_input).on('keydown', function(event) {
            if (event.keyCode == 8 && $(this).val() === '') {
              event.preventDefault();
              var lastTag = $(this).closest('.tagsinput').find('.tag:last > span').text();
              var id = $(this).attr('id').replace(/_tag$/, '');
              $('#' + id).removeTag(encodeURI(lastTag));
              $(this).trigger('focus');
            }
          });

          // Removes the error class when user changes the value of the fake input
          $(data.fake_input).keydown(function(event) {
            // enter, alt, shift, esc, ctrl and arrows keys are ignored
            if (jQuery.inArray(event.keyCode, [13, 37, 38, 39, 40, 27, 16, 17, 18, 225]) === -1) {
              $(this).removeClass('error');
            }
          });
        });

        return this;
      };

      $.fn.tagsInput.updateTagsField = function(obj, tagslist) {
        var id = $(obj).attr('id');
        $(obj).val(tagslist.join(_getDelimiter(delimiter[id])));
      };

      $.fn.tagsInput.importTags = function(obj, val) {
        $(obj).val('');

        var id = $(obj).attr('id');
        var tags = _splitIntoTags(delimiter[id], val);

        for (i = 0; i < tags.length; ++i) {
          $(obj).addTag(tags[i], {
            focus: false,
            callback: false
          });
        }

        if (callbacks[id] && callbacks[id]['onChange']) {
          var f = callbacks[id]['onChange'];
          f.call(obj, obj, tags);
        }
      };

      var _getDelimiter = function(delimiter) {
        if (typeof delimiter === 'undefined') {
          return delimiter;
        } else if (typeof delimiter === 'string') {
          return delimiter;
        } else {
          return delimiter[0];
        }
      };

      var _validateTag = function(value, inputSettings, tagslist, delimiter) {
        var result = true;

        if (value === '') result = false;
        if (value.length < inputSettings.minChars) result = false;
        if (inputSettings.maxChars !== null && value.length > inputSettings.maxChars) result = false;
        if (inputSettings.limit !== null && tagslist.length >= inputSettings.limit) result = false;
        if (inputSettings.validationPattern !== null && !inputSettings.validationPattern.test(value)) result = false;

        if (typeof delimiter === 'string') {
          if (value.indexOf(delimiter) > -1) result = false;
        } else {
          $.each(delimiter, function(index, _delimiter) {
            if (value.indexOf(_delimiter) > -1) result = false;
            return false;
          });
        }

        return result;
      };

      var _checkDelimiter = function(event) {
        var found = false;

        if (event.which === 13) {
          return true;
        }

        if (typeof event.data.delimiter === 'string') {
          if (event.which === event.data.delimiter.charCodeAt(0)) {
            found = true;
          }
        } else {
          $.each(event.data.delimiter, function(index, delimiter) {
            if (event.which === delimiter.charCodeAt(0)) {
              found = true;
            }
          });
        }

        return found;
      };

      var _splitIntoTags = function(delimiter, value) {
        if (value === '') return [];

        if (typeof delimiter === 'string') {
          return value.split(delimiter);
        } else {
          var tmpDelimiter = '';
          var text = value;

          $.each(delimiter, function(index, _delimiter) {
            text = text.split(_delimiter).join(tmpDelimiter);
          });

          return text.split(tmpDelimiter);
        }

        return [];
      };
    })(jQuery);

  </script> -->


  <!-- Tag input  -->
  <script>

    var substringMatcher = function(strs) {
      return function findMatches(q, cb) {
        var matches, substringRegex;

        // an array that will be populated with substring matches
        matches = [];

        // regex used to determine if a string contains the substring `q`
        substrRegex = new RegExp(q, 'i');

        // iterate through the pool of strings and for any string that
        // contains the substring `q`, add it to the `matches` array
        $.each(strs, function(i, str) {
          if (substrRegex.test(str)) {
            matches.push(str);
          }
        });

        cb(matches);
      };
    };

    // var states = ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California',
    //   'Colorado', 'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii',
    //   'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana',
    //   'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota',
    //   'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire',
    //   'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota',
    //   'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island',
    //   'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont',
    //   'Virginia', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming'
    // ];
    // var states2 =[ { "value": 1 , "text": "Amsterdam"   , "continent": "Europe"    },
    //   { "value": 2 , "text": "London"      , "continent": "Europe"    },
    //   { "value": 3 , "text": "Paris"       , "continent": "Europe"    },
    //   { "value": 4 , "text": "Washington"  , "continent": "America"   },
    //   { "value": 5 , "text": "Mexico City" , "continent": "America"   },
    //   { "value": 6 , "text": "Buenos Aires", "continent": "America"   },
    //   { "value": 7 , "text": "Sydney"      , "continent": "Australia" },
    //   { "value": 8 , "text": "Wellington"  , "continent": "Australia" },
    //   { "value": 9 , "text": "Canberra"    , "continent": "Australia" },
    //   { "value": 10, "text": "Beijing"     , "continent": "Asia"      },
    //   { "value": 11, "text": "New Delhi"   , "continent": "Asia"      },
    //   { "value": 12, "text": "Kathmandu"   , "continent": "Asia"      },
    //   { "value": 13, "text": "Cairo"       , "continent": "Africa"    },
    //   { "value": 14, "text": "Cape Town"   , "continent": "Africa"    },
    //   { "value": 15, "text": "Kinshasa"    , "continent": "Africa"    }
    // ]

    // $('#the-basics .typeahead').typeahead({
    //   hint: true,
    //   highlight: true,
    //   minLength: 1
    // },
    // {
    //   name: 'states',
    //   source: substringMatcher(states)
    // });

    // // local

    // // constructs the suggestion engine
    // var states2 = new Bloodhound({
    //   datumTokenizer: Bloodhound.tokenizers.whitespace,
    //   // datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
    //   queryTokenizer: Bloodhound.tokenizers.whitespace,
    //   // `states` is an array of state names defined in "The Basics"
    //   local: states
    //   // ,
    //   //   filter: function(list) {
    //   //       return $.map(list, function(cityname) {
    //   //         return { name: cityname }; });
    //   //     }
    // });

    // $('#bloodhound .typeahead').typeahead({
    //   hint: true,
    //   highlight: true,
    //   minLength: 1
    // },
    // {
    //   name: 'statesa',
    //   source: states2
    // });


    // // Prefetch

    // var countries = new Bloodhound({
    //   datumTokenizer: Bloodhound.tokenizers.whitespace,
    //   queryTokenizer: Bloodhound.tokenizers.whitespace,
    //   // url points to a json file that contains an array of country names, see
    //   // https://github.com/twitter/typeahead.js/blob/gh-pages/data/countries.json
    //   prefetch: '../../assets/citynames.json'
    // });

    // $('#prefetch .typeahead').typeahead(null, {
    //   name: 'countries',
    //   source: countries
    // });



    // // Typehead specific
    // var cities = [ "Amsterdam",
    //   "London",
    //   "Paris",
    //   "Washington",
    //   "New York",
    //   "Los Angeles",
    //   "Sydney",
    //   "Melbourne",
    //   "Canberra",
    //   "Beijing",
    //   "New Delhi",
    //   "Kathmandu",
    //   "Cairo",
    //   "Cape Town",
    //   "Kinshasa"
    // ]
    // var cities = new Bloodhound({
    //   datumTokenizer: Bloodhound.tokenizers.obj.whitespace('text'),
    //   // datumTokenizer: Bloodhound.tokenizers.whitespace,
    //   queryTokenizer: Bloodhound.tokenizers.whitespace,
    //   prefetch: '../../assets/citynames.json',
    //   filter: function(list) {
    //       return $.map(list, function(cityname) {
    //         return { name: cityname }; });
    //     }
    //   // local: states
    // });
    // cities.initialize();


    // console.log('')
    // var elt = $('input');
    // elt.tagsinput({
    //   itemValue: 'value',
    //   itemText: 'text',
    //   typeaheadjs: {
    //     name: 'cities',
    //     displayKey: 'text',
    //     source: cities.ttAdapter()
    //   }
    // });

    // console.log(citynames)

  // reference:
  // http://twitter.github.io/typeahead.js/examples/
  // http://bootstrap-tagsinput.github.io/bootstrap-tagsinput/examples/
  $('#classTag').tagsinput({
    allowDuplicates: false,
    maxTags: 5,
    maxChars: 20,
    typeaheadjs: {
      name: 'citynames',
      // displayKey: 'name',
      // valueKey: 'name',
      source: substringMatcher(ClassTag) // ClassTag in const.js
      // name: 'cities',
      // source: states2.ttAdapter()
      // source :  ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado']
    },
  });

  </script>
  <!-- Coloris -->
  <script>
    Coloris({
      el: '.coloris',
      swatches: [
        '#264653',
        '#2a9d8f',
        '#e9c46a',
        '#f4a261',
        '#e76f51',
        '#d62828',
        '#023e8a',
        '#0077b6',
        '#0096c7',
        '#00b4d8',
        '#48cae4'
      ]
    });
  </script>
</body>

</html>